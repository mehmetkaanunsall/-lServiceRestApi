<?xml version="1.0" encoding="UTF-8"?>
<beans
    xmlns:sec="http://www.springframework.org/schema/security"
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xmlns="http://www.springframework.org/schema/beans"
    xsi:schemaLocation="
       http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/security
       http://www.springframework.org/schema/security/spring-security-4.2.xsd">
      

    <sec:http  auto-config="true" use-expressions="true"  >  
        <sec:session-management session-authentication-strategy-ref="sas"   />
        <sec:intercept-url pattern="/login" access="permitAll"  />
        <sec:intercept-url pattern="/pages/login.xhtml" access="permitAll"  />
        <sec:intercept-url pattern="/pages/service/sendsale.xhtml" access="permitAll"  />
        <sec:intercept-url pattern="/pages/service/sendmposinformation.xhtml" access="permitAll"  />
        <sec:intercept-url pattern="/pages/service/synchronize.xhtml" access="permitAll"  />
        <sec:intercept-url pattern="/Marwiz" access="isAuthenticated()" />
        <sec:intercept-url pattern="/pages/marwiz.xhtml" access="isAuthenticated()" />
        <sec:intercept-url pattern="/Accessdenied" access="isAuthenticated()" />

        <sec:intercept-url pattern="/pages/**" access="denyAll" />
        <sec:access-denied-handler error-page="/Accessdenied" />
        <sec:form-login  login-page="/Login"   /> 
        <sec:logout  logout-success-url="/pages/login.xhtml?faces-redirect=true"  invalidate-session="true" delete-cookies="true"/> 
        <sec:csrf disabled="true"/>
        <sec:custom-filter ref="sessionManagementFilter" before="SESSION_MANAGEMENT_FILTER" />	
    </sec:http>    
    

    <sec:authentication-manager alias="authenticationManager">
        <sec:authentication-provider user-service-ref="userDetailService" >
            <sec:password-encoder  ref="encoder" />
        </sec:authentication-provider> 
    </sec:authentication-manager> 
    
    <!-- bcrypt şifreleme için-->
    <bean id="encoder" class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder">
        <constructor-arg name="strength" value="11" />
    </bean>
        
    <bean id="sas" class="org.springframework.security.web.authentication.session.CompositeSessionAuthenticationStrategy">
        <constructor-arg>
            <list>
                <bean class="org.springframework.security.web.authentication.session.ConcurrentSessionControlAuthenticationStrategy">
                    <constructor-arg ref="sessionRegistry"/>
                    <property name="maximumSessions" value="2" />
                    <property name="exceptionIfMaximumExceeded" value="true" /> 
                </bean>
                
                <bean class="org.springframework.security.web.authentication.session.SessionFixationProtectionStrategy">
                    <property name="migrateSessionAttributes" value="true"/>
                </bean>
                
                <bean class="org.springframework.security.web.authentication.session.RegisterSessionAuthenticationStrategy">
                    <constructor-arg ref="sessionRegistry"/>
                </bean>
                
            </list>
        </constructor-arg>
    </bean>
    
    
    <bean id="sessionManagementFilter" class="org.springframework.security.web.session.SessionManagementFilter">
        <constructor-arg name="securityContextRepository" ref="httpSessionSecurityContextRepository" />
        <!-- <property name="invalidSessionStrategy"  ref="jsfRedirectStrategy" /> -->
    </bean> 
    
    <bean    id="jsfRedirectStrategy"  class="com.mepsan.marwiz.general.pattern.JsfRedirectStrategy">
        <constructor-arg name="invalidSessionUrl" value="/Login" /> 
    </bean>
    
    
    <bean id="httpSessionSecurityContextRepository" class="org.springframework.security.web.context.HttpSessionSecurityContextRepository"  />
    
    <bean id="sessionRegistry" class="org.springframework.security.core.session.SessionRegistryImpl"  />
    
    <bean id="userDetailService" class="com.mepsan.marwiz.general.login.business.UserDetailService"   >
    </bean>
        
</beans>
