<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions" 
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:include  src="/pages/inventory/stocktaking/newstocktaking.xhtml"   >
        <ui:param name="bean" value='#{stockTakingProcessBean}' />

    </ui:include>

    <div class="EmptyBox10"></div>

    <p:tabView id="tbvStockTakingProc" activeIndex="#{marwiz.tabIndex}" scrollable="true" rendered="#{stockTakingProcessBean.getRendered(10, 1)}" dynamic="true" cache="true">
        <p:ajax event="tabChange" listener="#{stockTakingProcessBean.onTabChange}" update="pngIncomeBook"/>


        <p:tab id="tab10" title="#{loc.stocks}" rendered="#{stockTakingProcessBean.getRendered(10, 1)}">
            <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
                <ui:include src="/pages/inventory/stocktaking/stocktakingstocktab.xhtml"/>
            </c:if>
        </p:tab>

        <p:tab id="tab81" title="#{loc.history}" rendered="#{stockTakingProcessBean.getRendered(81, 1)}" >
            <c:if test="#{stockTakingProcessBean.activeIndex == 81}">
                <ui:include src="/pages/general/common/historydatatable.xhtml" >
                    <ui:param name="bean" value='#{historyTabBean}' />
                    <c:set var="createdPerson" value="#{stockTakingProcessBean.selectedObject.userCreated.fullName}- #{stockTakingProcessBean.selectedObject.userCreated.username}" scope="request"/>
                    <c:set var="createdTime" value='#{sessionBean.convertDateTime(stockTakingProcessBean.selectedObject.dateCreated)}'  scope="request"/>
                    <c:set var="rowId" value="#{stockTakingProcessBean.selectedObject.id}" scope="request" /> 
                    <c:set var="tableName" value="inventory.stocktaking" scope="request" /> 
                </ui:include>
            </c:if>
        </p:tab>

    </p:tabView>   

    <p:dialog id="dlgStockTakingStockControl" class="dialogWithTitle" header="#{loc.entryexitafterstocktaking}" widgetVar="dlg_StockTakingStockControl" resizable="false" transient="true" focus="dlgStockTakingStockControl" responsive="true"  closeOnEscape="true" width="50%" >
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <ui:include src="/pages/inventory/stocktaking/stocktakingsalecontrol.xhtml"/>  
        </c:if>
    </p:dialog>

    <p:dialog id="dlgUncountedStocks" class="dialogWithTitle" header="#{loc.uncountedstocks}" widgetVar="dlg_UncountedStocks" resizable="false" transient="true" focus="dlgUncountedStocks" responsive="true" closeOnEscape="true" width="50%" modal="true" >
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <ui:include src="/pages/inventory/stocktaking/stocktakinguncountedstocks.xhtml"/>  
        </c:if>
    </p:dialog>

    <p:dialog id="dlgStockTakingEmployee" class="dialogWithTitle" header="#{loc.employees}" widgetVar="dlg_StockTakingEmployee" resizable="false" transient="true" focus="dlgStockTakingEmployee" responsive="true" dynamic="true" closeOnEscape="true" width="30%" modal="true" >
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <ui:include src="/pages/inventory/stocktaking/stocktakingemployee.xhtml"/>  
        </c:if>
    </p:dialog>

    <p:dialog id="dlgStockTakingMinusStock" class="dialogWithTitleWith20Perc" header="#{loc.checkstocktaking}" widgetVar="dlg_StockTakingMinusStock" resizable="false" transient="true" focus="dlgStockTakingEmployee" responsive="true" closeOnEscape="true" width="50%" modal="true" >
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <ui:include src="/pages/inventory/stocktaking/stocktakingminusstocks.xhtml"/>  
        </c:if>
    </p:dialog>



    <h:panelGroup id="pngIncomeBook">
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <p:overlayPanel id="olpIncomeExpense" widgetVar="olp_IncomeExpense" showEvent="none" modal="true" transient="true" for="frmAproval:txtDifferencePrice" at="left bottom" dismissable="true" hideEffect="blind" showCloseIcon="true" class="Wid30">
                <ui:include src="/pages/general/common/incomeexpensebook.xhtml">
                    <ui:param name="updateBean" value='#{stockTakingEmployeeBean}' />
                    <ui:param name="type" value='#{stockTakingEmployeeBean.beanName}' />
                    <ui:param name="parameters" value='#{[stockTakingEmployeeBean.isIncomeExpense, sessionBean.user.lastBranch]}' /> 
                    <ui:param name="form" value='frmIncomeExpenseBookFilter' /> 

                </ui:include>
            </p:overlayPanel>
        </c:if>
    </h:panelGroup>


    <p:dialog id="dlgConfirmStockTaking"  widgetVar="dlg_ConfirmStockTaking"  resizable="false" transient="true" focus="dlgConfirmStockTaking" closeOnEscape="true" responsive="true"  width="20%" modal="true" >
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <h:form id="frmAproval">
                <div class="ui-g" >
                    <h:panelGroup rendered="#{stockTakingEmployeeBean.isDifference}">
                        <div class="ui-g-12 ui-md-12 ui-lg-12 TexAlCenter">
                            <h:outputText class="FontBold Fs14" value="#{stockTakingEmployeeBean.isDirection ? loc.excessoccurredafterstocktaking : loc.deficitoccurredafterstocktaking}" />
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12">

                            <p:outputLabel value="#{loc.differenceprice}"   for="txtDifferencePrice" class="FontBold Fs12"/>
                            <p:inputNumber id="txtDifferencePrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? '.': ','}"  
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? ',': '.'}" 
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" readonly="true"
                                           value="#{stockTakingEmployeeBean.stockTaking.differencePrice}" 
                                           symbolPosition="#{sessionBean.locale=='tr' ? 's': 'p'}" symbol="#{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id, 0)}"  
                                           class="TexAlRight" >
                            </p:inputNumber>
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-6">
                            <p:outputLabel value="#{loc.employeeamount}" for="txtEmployeePrice" class="FontBold Fs12"/>
                            <p:inputNumber id="txtEmployeePrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? '.': ','}"  
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? ',': '.'}" 
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                           value="#{stockTakingEmployeeBean.employeePrice}" minValue="0"
                                           symbolPosition="#{sessionBean.locale=='tr' ? 's': 'p'}" symbol="#{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id, 0)}"  
                                           class="TexAlRight" >
                                <p:ajax event="change" global="false" listener="#{stockTakingEmployeeBean.changeEmployeePrice()}"/>
                            </p:inputNumber>
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-6">

                            <p:outputLabel value="#{stockTakingEmployeeBean.isDirection ? loc.transferusertoexcessamount : loc.chargeuser}"   for="txtUser" class="FontBold Fs12"/>
                            <div style="display: flex !important">
                                <p:inputText id="txtUser" readonly="true" value="#{stockTakingEmployeeBean.selectedUser}" >
                                </p:inputText>
                                <p:commandLink rendered="#{stockTakingEmployeeBean.isDirection}" title="#{loc.transferusertoexcessamount}" class="clmInputGroup" resetValues="true" process="@this" update="dlgStockTakingEmployee" oncomplete="PF('dlg_StockTakingEmployee').show()" >
                                    <i class="Fs14 fa fa-user-plus tlbrBackBtn" /><!--Fazlalığı kullanıcıya aktar-->
                                </p:commandLink>
                                <p:commandLink rendered="#{!stockTakingEmployeeBean.isDirection}" title="#{loc.chargeuser}" class="clmInputGroup" resetValues="true" process="@this" update="dlgStockTakingEmployee" oncomplete="PF('dlg_StockTakingEmployee').show()" >
                                    <i class="Fs14 fa fa-user-times  tlbrBackBtn" /><!--Kullanıcıyı borçlandır-->
                                </p:commandLink>
                            </div>
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-6">
                            <p:outputLabel value="#{stockTakingEmployeeBean.isDirection ? loc.incomeamount : loc.expenseamount}" for="txtIncomeExpensePrice" class="FontBold Fs12"/>
                            <p:inputNumber id="txtIncomeExpensePrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? '.': ','}"  
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? ',': '.'}" 
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                           value="#{stockTakingEmployeeBean.incomeExpensePrice}" minValue="0"
                                           symbolPosition="#{sessionBean.locale=='tr' ? 's': 'p'}" symbol="#{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id, 0)}"  
                                           class="TexAlRight" >
                                <p:ajax event="change" global="false" listener="#{stockTakingEmployeeBean.changeIncomeExpensePrice()}"/>
                            </p:inputNumber>
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-6">

                            <p:outputLabel value="#{stockTakingEmployeeBean.isDirection ? loc.createincome : loc.createexpense}"   for="txtIncomeExpense" class="FontBold Fs12"/>
                            <div style="display: flex !important">
                                <p:inputText id="txtIncomeExpense" readonly="true" value="#{stockTakingEmployeeBean.incomeExpense.name}" >
                                </p:inputText>
                                <p:commandLink rendered="#{stockTakingEmployeeBean.isDirection}" title="#{loc.createincome}" class="clmInputGroup" resetValues="true" process="@this" update="frmIncomeExpenseBookFilter"  oncomplete="PF('olp_IncomeExpense').loadContents();">
                                    <i class="Fs14 fa fa-arrow-down tlbrBackBtn" /><!--Gelir oluştur-->
                                    <p:ajax listener="#{incomeExpenseBookFilterBean.findFilterList([true, sessionBean.user.lastBranch],'frmIncomeExpenseBookFilter','olp_IncomeExpense', stockTakingEmployeeBean.beanName)}"  />
                                </p:commandLink>
                                <p:commandLink rendered="#{!stockTakingEmployeeBean.isDirection}" title="#{loc.createexpense}" class="clmInputGroup" resetValues="true" process="@this" update="frmIncomeExpenseBookFilter"  oncomplete="PF('olp_IncomeExpense').loadContents();" >
                                    <i class="Fs14 fa fa-arrow-up tlbrBackBtn" /><!--Gider oluştur-->
                                    <p:ajax listener="#{incomeExpenseBookFilterBean.findFilterList([false, sessionBean.user.lastBranch],'frmIncomeExpenseBookFilter','olp_IncomeExpense', stockTakingEmployeeBean.beanName)}" />
                                </p:commandLink>
                            </div>
                        </div>
                    </h:panelGroup>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <p:outputLabel value="#{loc.stocktakingapprovalemployee}"   for="slcApprovalEmployee" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcApprovalEmployee" value="#{stockTakingEmployeeBean.stockTaking.approvalEmployee.id}"  filter="true" >
                            <f:selectItems value="#{stockTakingProcessBean.accountList}"  var="accountList" itemLabel="#{accountList.name} #{accountList.title}" itemValue="#{accountList.id}" />
                        </p:selectOneMenu>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12 TexAlCenter">
                        <p:commandButton value="#{loc.finishstocktaking}"  process="@form"  delay="200" actionListener="#{stockTakingEmployeeBean.finish()}"  />
                        <p:commandButton value="#{loc.cancel}"  onclick="PF('dlg_ConfirmStockTaking').hide()" actionListener="#{stockTakingEmployeeBean.cancel()}"/>
                    </div>
                </div>
                <p:remoteCommand name="finish" delay="200" process="@this" actionListener="#{stockTakingEmployeeBean.goToGrid()}"  />
            </h:form>
        </c:if>
    </p:dialog>

    <p:confirmDialog global="true" class="deleteConfirm"  widgetVar="dlg_ConfirmReset" showEffect="fade" hideEffect="fade"  closeOnEscape="true" responsive="true">
        <c:if test="#{stockTakingProcessBean.activeIndex==10}" >
            <f:facet name="message">
                <h:outputText value="#{loc.areyousureyouwanttoresetthequantityofselectedstocks}"  style="white-space: pre-wrap;">
                    <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
                </h:outputText>
            </f:facet>
            <p:commandButton value="#{loc.yes}" actionListener="#{stockTakingUncountedStocksBean.reset()}"  onclick="PF('dlg_ConfirmReset').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
            <p:commandButton value="#{loc.no}"  onclick="PF('dlg_ConfirmReset').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
        </c:if>
    </p:confirmDialog>

    <p:confirmDialog global="true" class="deleteConfirm"  widgetVar="dlg_ConfirmStatus" showEffect="fade" hideEffect="fade"  closeOnEscape="true" responsive="true">
        <f:facet name="message">
            <h:outputText value="#{loc.whenyouopentheapprovedstocktakingbackallrelatedactionswillberolledback}"  style="white-space: pre-wrap;">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
            <br/>
            <h:outputText value="#{loc.areyousureyouwanttocontinue}"  style="white-space: pre-wrap;">
            </h:outputText>
        </f:facet>
        <p:commandButton value="#{loc.yes}" actionListener="#{stockTakingProcessBean.openStokTaking()}"  onclick="PF('dlg_ConfirmStatus').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
        <p:commandButton value="#{loc.no}"  onclick="PF('dlg_ConfirmStatus').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>

    <p:confirmDialog global="true" class="deleteConfirm"  widgetVar="dlg_ConfirmUpdate" showEffect="fade" hideEffect="fade"  closeOnEscape="true" responsive="true">
        <f:facet name="message">
            <h:outputText value="#{loc.asthecategoryofthestocktakingchangesthestocksthatarenotinthenewcategorywillbedeleted}"  style="white-space: pre-wrap;">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
            <br/>
            <h:outputText value="#{loc.areyousureyouwanttocontinue}"  style="white-space: pre-wrap;">
            </h:outputText>
        </f:facet>
        <p:commandButton value="#{loc.yes}" actionListener="#{stockTakingProcessBean.saveConfirm()}"  onclick="PF('dlg_ConfirmUpdate').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
        <p:commandButton value="#{loc.no}"  onclick="PF('dlg_ConfirmUpdate').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>

    <!-- Sayımı silerken çıkan uyarı dilogu -->
    <p:confirmDialog id="dlgConfirmDeleteStockTaking"  class="deleteConfirm controlDelete"  widgetVar="dlgConfirmDeleteStockTaking" closable="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.stocktakingwillbedeletedanditcannotbetakebreak}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.areyousureyouwanttocontinue}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.yes}" action="#{stockTakingProcessBean.delete()}" onclick="PF('dlgConfirmDeleteStockTaking').hide()" process="@this" styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.no}" type="button" onclick="PF('dlgConfirmDeleteStockTaking').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>

    <p:dialog id="dlgCategoryStock" widgetVar="dlg_CategoryStock" resizable="false" transient="true" focus="dlgCategoryStock" responsive="true" dynamic="true" closeOnEscape="true" width="40%">
        <ui:include src="/pages/inventory/stocktaking/stocktakingstockcontrol.xhtml" >
            <ui:param name="bean" value='#{stockTakingProcessBean}' />
            <ui:param name="btnName" value="#{loc.save}" />
        </ui:include>
    </p:dialog>

</ui:composition>
