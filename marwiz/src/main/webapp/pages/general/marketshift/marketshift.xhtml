<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">


    <h:form id="frmMarketShiftDate">

        <h:panelGroup id="pgrMarketShift" layout="block" transient="true">
            <ui:include src="/pages/general/common/toolbarreport.xhtml" >
                <ui:param name="outputtext" value="#{loc.marketshift}"/>
                <ui:param name="bean" value='#{marketShiftBean}' />
                <ui:param name="update" value="pgrMarketShiftDatatable" />
            </ui:include>

            <h:panelGroup id="pgrMarketShiftDate" layout="block" transient="true">  
                <div class="ui-g divContent">
                    <div class="panelToggle ui-g-12">
                           
                            <div class='ui-g-12 ui-md-6 ui-lg-2'>
                                <p:outputLabel value="#{loc.startdate}" for="cldStartDate" styleClass="Fs12 FontBold"/>
                                <p:calendar  id="cldStartDate" value="#{marketShiftBean.beginDate}" required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" showOn="button" timeControlType="select"  showButtonPanel="true" placeholder="#{loc.startdate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                                    <p:ajax event="change" update="cldStartDate" resetValues="true" global="false"/>
                                </p:calendar>
                            </div>

                            <div class='ui-g-12 ui-md-6 ui-lg-2'>
                                <p:outputLabel value="#{loc.enddate}" for="cldEndDate" styleClass="Fs12 FontBold"/>
                                <p:calendar  id="cldEndDate" value="#{marketShiftBean.endDate}" required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" timeControlType="select"  showOn="button" showButtonPanel="true" placeholder="#{loc.enddate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                                    <p:ajax event="change" update="cldEndDate" resetValues="true" global="false"/>
                                </p:calendar>
                            </div>

                    </div>
                </div>

            </h:panelGroup>
        </h:panelGroup>
    </h:form>
    <div class="EmptyBox20"/>

  <h:panelGroup id="pgrMarketShiftDatatable" > 
    <ui:include src="/pages/general/common/datagridtoolbar.xhtml" >
        <ui:param name="bean" value="#{marketShiftBean}"/> 
        <ui:param name="update" value="dlgNewShiftConfirm"/>
        <ui:param name="btnNewId" value="#{marketShiftBean.getRendered(49, 0)}"/>
        <ui:param name="datatable" value="frmMarketShift:dtbMarketShift" /> 
        <ui:param name="dtbWidgetVar" value="marketShiftPF" /> 
        <ui:param name="fileName" value="#{loc.marketshift}"/>,
        <ui:param name="renderedFilter" value='true'/>
        <ui:param name="renderedToggler" value='true'/>
        <ui:param name="renderedExel" value='true'/>
        <ui:param name="renderedPdf" value='true'/>
        <ui:param name="renderedAdd" value='true'/>
        <ui:param name="renderedCheckBox" value="true"/>
        <ui:param name="labelForCheckBox" value="#{loc.showunapprovedshifts}"/>
    </ui:include>

    <h:form id="frmMarketShift">

        <p:dataTable  id="dtbMarketShift" widgetVar="marketShiftPF" selectionMode="single" var="shift" rowKey="#{shift.id}" value="#{marketShiftBean.listOfObjects}"
                      selection="#{marketShiftBean.selectedObject}" emptyMessage="#{loc.norecordsfound}"
                      paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                      paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" 
                      reflow="true" lazy="true" rowStyleClass="#{shift.status.id == 7 ? 'ColumnColorGreen' : null}" rowsPerPageTemplate="#{sessionBean.user.gridSize}" rows="#{sessionBean.user.defualtGridSize}" >

            <p:ajax event="#{sessionBean.user.gridRowSelect}"  listener="#{marketShiftBean.closeShift()}" global="false" update="dlgCloseShiftConfirm"/>
            <p:ajax event="colReorder" listener="#{marketShiftBean.reorder}" update="frmGridToolbar:toggle" />     
            <p:ajax event="colResize"  listener="#{marketShiftBean.onResize}" />

            <p:column id="clmShiftNo" headerText="#{loc.shiftno}" sortable="true" sortBy="#{shift.shf.shiftno}"  visible="#{marketShiftBean.toogleList[0]}" exportable="#{marketShiftBean.toogleList[0]}">
                <h:outputText value="#{shift.shiftNo}"/> 
            </p:column>

            <p:column id="clmShiftName" headerText="#{loc.shiftname}" sortable="true" sortBy="#{shift.shf.name}"  visible="#{marketShiftBean.toogleList[1]}" exportable="#{marketShiftBean.toogleList[1]}">
                <h:outputText value="#{shift.name}"/> 
            </p:column>
            <p:column id="clmStartDate" headerText="#{loc.startdate}" sortable="true" sortBy="#{shift.shf.begindate}" visible="#{marketShiftBean.toogleList[2]}"   exportable="#{marketShiftBean.toogleList[2]}">
                <h:outputText value="#{shift.beginDate}"  >
                    <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                </h:outputText>
            </p:column>
            <p:column id="clmEndDate" headerText="#{loc.enddate}" sortable="true" sortBy="#{shift.shf.enddate}" visible="#{marketShiftBean.toogleList[3]}"   exportable="#{marketShiftBean.toogleList[3]}">
                <h:outputText value="#{shift.endDate}"  >
                    <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                </h:outputText>
            </p:column>
            <p:column id="clmSalePrice" headerText="#{loc.totalsalesamount}" visible="#{marketShiftBean.toogleList[4]}"   exportable="#{marketShiftBean.toogleList[4]}">
                <h:outputText value="#{marketShiftBean.readXml(1, shift.totalSaleAmountString, 1)}"  class="Fright"/>

            </p:column>
            <p:column id="clmSubmittedSalesAmount" headerText="#{loc.submittedsalesamount}" visible="#{marketShiftBean.toogleList[5]}"   exportable="#{marketShiftBean.toogleList[5]}">
                <h:outputText value="#{marketShiftBean.readXml(1, shift.actualPriceString, 2)}"  class="Fright"/>
            </p:column>
            <p:column id="clmDifference" headerText="#{loc.difference}"  visible="#{marketShiftBean.toogleList[6]}"   exportable="#{marketShiftBean.toogleList[6]}">
                <h:outputText value="#{marketShiftBean.calculateDifference(shift.shiftNo)}"  class="Fright"/>
            </p:column>
            <p:column id="clmStatus" headerText="#{loc.statu}" visible="#{marketShiftBean.toogleList[7]}" exportable="#{marketShiftBean.toogleList[7]}">
                <h:outputText value="#{marketShiftBean.compare == -1 ? loc.surplus : marketShiftBean.compare == 1 ? loc.deficit : marketShiftBean.compare == 0 ? loc.complete : ''}" />
            </p:column>
            <p:column id="clmShiftPerson" headerText="#{loc.employeeofshift}" visible="#{marketShiftBean.toogleList[8]}"   exportable="#{marketShiftBean.toogleList[8]}">
                <h:outputText value="#{marketShiftBean.readXml(2, shift.shiftPerson, 3)}"/>
            </p:column>
            <p:column id="clmDetail" style="text-align: center !important; width: 80px;" headerText="#{loc.detail}" visible="#{marketShiftBean.toogleList[9]}"  exportable="false">
                <p:commandLink title="#{loc.detail}" action="#{marketShiftBean.goToShiftDetail()}">
                    <i class="fa fa-search Fs16"/>   
                    <f:setPropertyActionListener value="#{shift}"  target="#{marketShiftBean.selectedConfirmShift}"  />
                    <p:ajax />
                </p:commandLink> 
            </p:column>
            <p:column id="clmConfirmation" headerText="#{loc.approval}" style="text-align: center !important;  width: 80px;" visible="#{marketShiftBean.toogleList[10]}" exportable="false">
                <p:commandLink title="#{loc.shifttransferprocesses}" action="#{marketShiftBean.goToShiftPaymentProcess()}" process="@this" rendered="#{!shift.is_Confirm and shift.status.id==8}">
                    <i class="fa fa-pencil-square-o Fs16" style="color: #dc3a3a"/>   
                    <f:setPropertyActionListener value="#{shift}"  target="#{marketShiftBean.selectedConfirmShift}"  />
                </p:commandLink> 
                <p:commandLink title="#{loc.shifttransferprocesses}" action="#{marketShiftBean.goToShiftPaymentProcess()}" rendered="#{shift.is_Confirm}">
                    <i class="fa fa-check Fs16" style="color: #2b9843"/>   
                    <f:setPropertyActionListener value="#{shift}"  target="#{marketShiftBean.selectedConfirmShift}"  />
                </p:commandLink> 
            </p:column>

        </p:dataTable>  
    </h:form>


  </h:panelGroup> 
  
  
    <p:confirmDialog id="dlgCloseShiftConfirm"  class="deleteConfirm"  widgetVar="dlgCloseShiftConfirm" closable="false" width="20%" showEffect="fade" hideEffect="fade"  responsive="true">
        <f:facet name="message">
            <div class="ui-g-12 ui-md-12 ui-lg-12">
                <h:outputText value="#{marketShiftBean.selectedObject.shiftNo}"/>
            </div>
            <div class="ui-g-12 ui-md-12 ui-lg-12">
                <h:outputText value="#{loc.areyousureyouwanttoclosethisshift}" style="white-space: pre-wrap; color: black !important"/>
            </div>
        </f:facet>
        <p:commandButton actionListener="#{marketShiftBean.pressYesButtonForCloseShift()}" onclick="PF('dlgCloseShiftConfirm').hide()"  process="@this" value="#{loc.yes}"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
        <p:commandButton value="#{loc.no}"  type="button" onclick="PF('dlgCloseShiftConfirm').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>


    <p:dialog id="dlgNewShiftConfirm"  widgetVar="dlgNewShiftConfirm"  resizable="false" transient="true" focus="dlgNewShiftConfirm" closeOnEscape="true" responsive="true"  width="20%" modal="true" >
        <h:form id="frmNewShiftName">
            <div class="ui-g TexAlCenter" >
                <div class="ui-g-12 ui-md-12 ui-lg-12 ">
                    <h:outputText value="#{marketShiftBean.openShift.shiftNo} #{loc.isopen}" style=" color: #ca5959;" rendered="#{marketShiftBean.haveOpenShift}"/>
                </div>  

                <div class="ui-g-12 ui-md-12 ui-lg-12">
                    <h:outputText value="#{marketShiftBean.message}" style="white-space: pre-wrap; color: black !important"/>
                </div>

                <h:panelGroup rendered="#{!marketShiftBean.selectedConfirmShift.is_Confirm}">
                    <div class="ui-g-12 ui-md-12 ui-lg-12 TexAlLeft">
                        <p:outputLabel value="#{loc.shiftname}" for="txtNewShiftName" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtNewShiftName" value="#{marketShiftBean.newShiftName}" placeholder="#{loc.shiftname}" required="true"/>                    
                    </div>  
                </h:panelGroup>

                <div class="ui-g-12 ui-md-12 ui-lg-6 TexAlCenter">
                    <p:commandButton actionListener="#{marketShiftBean.pressYesButtonForNewShift()}" update="frmNewShiftName"  process="@form" value="#{loc.yes}"    styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                </div>
                <div class="ui-g-12 ui-md-12 ui-lg-6 TexAlLeft">
                    <p:commandButton value="#{loc.no}"  type="button" onclick="PF('dlgNewShiftConfirm').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                </div>
            </div>
        </h:form>
    </p:dialog>
 <p:dialog id="dlgNonTransferableOfflineSales" widgetVar="dlg_nontransferableofflinesales" modal="true" resizable="false" width="40%" focus="dlgNonTransferableOfflineSales" responsive="true" dynamic="true" closeOnEscape="true">
        <ui:include src="nontransferableofflinesales.xhtml">
        <ui:param name="bean" value='#{marketShiftBean}' />
        </ui:include>
    </p:dialog>

</ui:composition>
