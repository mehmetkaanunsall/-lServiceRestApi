<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:outputScript name="js/d3.min#{sessionBean.user.lastBranch.decimalsymbol == 1 ?'':'-tr' }.js" library="sentinel-layout"  />
    <h:outputScript name="js/nv.d3.min.js" library="sentinel-layout"  />
    <h:outputStylesheet name="css/nv.d3.min.css" library="sentinel-layout" />

    <h:form id="frmMarketShiftTransfer">
        <ui:include src="/pages/general/common/processtoolbar.xhtml" >
            <ui:param name="outputtext" value="#{loc.marketshifttransferprocesses}"/>
            <ui:param name="bean" value='#{marketShiftTransferBean}' />
            <ui:param name="update" value="" />
            <ui:param name="btnSaveId" value="false" />     
            <ui:param name="renderback" value='true'/>
            <ui:param name="createExcelBeforeAsk" value='#{marketShiftTransferBean.tempShift.is_Confirm}'/>
            <ui:param name="createPdfBeforeAsk" value='#{marketShiftTransferBean.tempShift.is_Confirm}'/>
            <ui:param name="createShiftPreview" value='#{marketShiftTransferBean.tempShift.is_Confirm}'/>

            <ui:param name="btnDeleteId" value='#{!marketShiftTransferBean.selectedShift.isAvailableSale}' />
            <ui:param name="labelCreateExcelBeforeAsk" value="#{loc.shiftsummary}"/>
            <ui:param name="labelCreatePdfBeforeAsk" value="#{loc.shiftsummary}"/>
        </ui:include>
        <h:panelGroup id="pgrMarketShiftTransfer" layout="block" transient="true" >  
            <div class="ui-g divContent">
                <div class="ui-g-12 panelToggle">
                    <div class="EmptyBox10"/>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <div class="ui-g-12 ui-md-12 ui-lg-3">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{loc.shiftno}" class="FontBold Fs15"/>
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText style="text-align: left !important;" value="#{marketShiftTransferBean.selectedShift.shiftNo}"/>
                            </div>
                        </div>

                        <div class="ui-g-12 ui-md-12 ui-lg-3">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{loc.shiftname}" class="FontBold Fs15"/>
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <p:inputText id="txtNewShiftName" onblur="#{marketShiftTransferBean.updateShiftName()}" value="#{marketShiftTransferBean.selectedShift.name}" placeholder="#{loc.shiftname}" >
                                    <p:ajax event="blur" update="frmMarketShiftTransfer" listener="#{marketShiftTransferBean.updateShiftName()}"  ></p:ajax>
                                </p:inputText>

                            </div>
                        </div>    
                        <div class="ui-g-12 ui-md-12 ui-lg-3">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{loc.startdate}" class="FontBold Fs15"/>
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{marketShiftTransferBean.selectedShift.beginDate}">
                                    <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                                </h:outputText>
                            </div>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-3">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText value="#{loc.enddate}" class="FontBold Fs15" />
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{marketShiftTransferBean.selectedShift.endDate}">
                                    <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                                </h:outputText>
                            </div>
                        </div>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <div class="ui-g-12 ui-md-12 ui-lg-4">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <p:commandLink value="#{loc.countofremovedstock}" class="FontBold Fs15 cmdRelatedRecord" process="@this" actionListener="#{marketShiftTransferBean.openDialogRemovedStock()}"/>
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{marketShiftTransferBean.selectedShift.sumOfRemovedStock}">
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="type" value="" />
                                </h:outputText>
                            </div>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-4">
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText value="#{loc.totalsalesamount}" class="FontBold Fs15" />
                            </div>
                            <div class="ui-g-12 ui-md-12 ui-lg-12" style="text-align: center">
                                <h:outputText   value="#{marketShiftTransferBean.readXml(marketShiftTransferBean.selectedShift.totalSaleAmountString)}"/>
                            </div>
                        </div>

                        <div class="ui-g-12 ui-md-12 ui-lg-4">
                            <div class="ui-g-12 ui-md-12 ui-lg-12 Fright">
                                <p:commandButton id="btnShiftProcess" value="#{marketShiftTransferBean.tempShift.is_Confirm ? loc.openshiftapproved : loc.approveshift}" rendered="#{marketShiftTransferBean.selectedShift.status.id==8}" process="@this" class="Fright" actionListener="#{marketShiftTransferBean.approveProcessShift()}"/>  
                            </div>
                        </div>
                    </div>



                </div>
            </div>
        </h:panelGroup>
        <div class="EmptyBox20" />



        <div class="ui-g-12 ui-md-12 ui-lg-12" style="padding-right: 0px; padding-left: 0px">
            <p:dataTable id="dtbDistribution" var="shiftPayment" value="#{marketShiftTransferBean.listOfShiftPayment}"  selectionMode="single" emptyMessage="#{loc.norecordsfound}"
                         rowKey="#{shiftPayment.id}" selection="#{marketShiftTransferBean.selectedShiftPayment}"
                         class="rowGroupTable" sortBy="#{shiftPayment.account.id}" expandableRowGroups="true" editable="true" editMode="cell" >

                <p:ajax event="cellEdit" listener="#{marketShiftTransferBean.onCellEdit}" global="false" oncomplete="updateDatatable()"/>


                <p:headerRow>
                    <p:column colspan="2">
                        <h:outputText value="#{shiftPayment.account.name} / #{loc.sum} : #{marketShiftTransferBean.calculateTotalMoneyForAccount(shiftPayment.account.id)}"/>
                    </p:column>
                </p:headerRow> 

                <p:column id="clmSalesType" headerText="#{loc.salestype}" >
                    <h:outputText value="#{shiftPayment.saleType.tag}" />
                </p:column>
                <p:column id="clmMovementPosition" headerText="#{loc.movementposition}" >
                    <h:outputText value="#{shiftPayment.bankAccount.id!=0 ? shiftPayment.bankAccount.name : shiftPayment.safe.id!=0 ? shiftPayment.safe.name : ''}" />
                </p:column>
                <p:column id="clmTransfer" headerText="#{loc.inheritedamount}" >
                    <p:cellEditor rendered="#{!marketShiftTransferBean.tempShift.is_Confirm and shiftPayment.saleType.id ==17}">
                        <f:facet name="output">
                            <h:outputText value="#{shiftPayment.inheritedMoney}" style="float: right" >
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="type" value="currency" />
                                <f:attribute name="currency" value="#{shiftPayment.currency}"/>
                            </h:outputText>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{shiftPayment.inheritedMoney}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                           decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                           decimalPlaces="#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}"
                                           roundMethod="D" emptyValue="">  
                            </p:inputNumber>
                        </f:facet>
                    </p:cellEditor>
                    <h:outputText value="#{shiftPayment.inheritedMoney}" style="float: right" rendered="#{!(!marketShiftTransferBean.tempShift.is_Confirm and shiftPayment.saleType.id ==17)}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="currency" />
                        <f:attribute name="currency" value="#{shiftPayment.currency}"/>
                    </h:outputText>
                </p:column>
                <p:column id="clmSalesAmount" headerText="#{loc.amounttobedeliver}" >
                    <h:outputText value="#{shiftPayment.salesPrice}" class="Fright" >
                        <f:converter converterId="currencyConverter"  />
                        <f:attribute name="currency"  value="#{shiftPayment.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>

                <p:column id="clmActualSalesAmount" headerText="#{loc.amounttobedelivered}">
                    <p:cellEditor rendered="#{!shiftPayment.isAvaialbelFinancingDocument and !marketShiftTransferBean.tempShift.is_Confirm and shiftPayment.saleType.id !=19 and shiftPayment.saleType.id !=77 and shiftPayment.saleType.id !=105 and shiftPayment.saleType.id !=106 and shiftPayment.saleType.id !=107}">
                        <f:facet name="output">
                            <h:outputText value="#{shiftPayment.actualSalesPrice}" style="float: right" >
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="type" value="currency" />
                                <f:attribute name="currency" value="#{shiftPayment.currency}"/>
                            </h:outputText>
                        </f:facet>

                        <f:facet name="input">

                            <p:inputNumber value="#{shiftPayment.actualSalesPrice}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                           decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                           decimalPlaces="#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}"
                                           roundMethod="D" emptyValue="">  
                            </p:inputNumber>
                        </f:facet>
                    </p:cellEditor>
                    <h:outputText value="#{shiftPayment.actualSalesPrice}" rendered="#{shiftPayment.isAvaialbelFinancingDocument or marketShiftTransferBean.tempShift.is_Confirm or shiftPayment.saleType.id ==19 or shiftPayment.saleType.id ==77 or shiftPayment.saleType.id ==105 or shiftPayment.saleType.id ==106 or shiftPayment.saleType.id ==107}" style="float: right" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="currency" />
                        <f:attribute name="currency" value="#{shiftPayment.currency}"/>
                    </h:outputText>

                </p:column>
                <p:column id="clmDifference" headerText="#{loc.difference}" >

                    <h:outputText value="#{marketShiftTransferBean.calculateDifference(shiftPayment.salesPrice ,shiftPayment.actualSalesPrice, shiftPayment.id)}" class="Fright" >
                        <f:converter converterId="currencyConverter"  />
                        <f:attribute name="currency"  value="#{shiftPayment.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>



                <p:column id="clmProcess" headerText="#{loc.process}" class="TexAlCenter">

                    <p:commandLink title="#{loc.createfinancingdocument}" actionListener="#{marketShiftTransferBean.createFinancingDocumentInSameTime(shiftPayment.id)}" update="dlgCreateFinancingDocumentInSameTime" resetValues="true" process="@this" >
                        <i class="Fs14 #{marketShiftTransferBean.isCreateFinancingDocument and shiftPayment.saleType.id !=19 and shiftPayment.saleType.id !=77 ? 'MarLeft5' : 'MarLeft-5'} #{marketShiftTransferBean.isCreateFinancingDocument and shiftPayment.saleType.id !=19 and shiftPayment.saleType.id !=77 ? 'fa fa-pencil-square-o' :''}" /> 
                    </p:commandLink>

                </p:column>
                <p:column id="clmResult" headerText="#{loc.result}" style="text-align: center;">
                    <i class="Fs16 #{shiftPayment.is_check ? 'icon-ok green' : marketShiftTransferBean.isBigger ? 'fa fa-exclamation' : marketShiftTransferBean.isClosed==false ? 'icon-cancel red' : ''}" style="#{marketShiftTransferBean.isBigger and !shiftPayment.is_check ? 'color:#0006ff !important;' : ''}" title="#{(marketShiftTransferBean.isBigger and !shiftPayment.is_check) ? loc.excessshift : marketShiftTransferBean.isClosed ? loc.processdone : shiftPayment.is_check ? loc.processdone : marketShiftTransferBean.isClosed==false ? loc.itsopen : ''}"/> 
                </p:column>


            </p:dataTable>


        </div>

        <p:commandButton id="updateDatatable" style="display: none"  process="@this" update="frmMarketShiftTransfer" global="false"/>
        <h:commandLink id="btnSecretExcel" style="display: none"   immediate="true"  actionListener="#{marketShiftTransferBean.createExcelFile}"  >
            <i class="icon-file-excel tlbrExcelBtn Fs22"/>                 
        </h:commandLink>
        <h:commandLink id="btnSecretPdf" style="display: none"  immediate="true"  actionListener="#{marketShiftTransferBean.creatPdfFile}">
            <i class="icon-file-pdf tlbrPdfBtn Fs22"/>                 
        </h:commandLink>

        <p:remoteCommand name="bringExcel" async="false"   oncomplete="transferExcel();" />
        <p:remoteCommand name="bringPdf"   async="false"   oncomplete="transferPdf();" />
        <p:remoteCommand name="goToPreview" process="@this"  async="false"  actionListener="#{marketShiftTransferBean.showPreview()}" />

    </h:form>

    <h:form>
        <h:panelGroup rendered="#{marketShiftTransferBean.listOfShiftPayment.size()>0}">
            <div class="EmptyBox20" />
            <ui:include src="/pages/general/common/tabgridtoolbar.xhtml" >
                <ui:param name="outputtext" value="#{loc.marketshiftgraphics}"/>
                <ui:param name="bean" value='#{marketShiftTransferBean}' />
                <ui:param name="update"  value="" />
            </ui:include>
            <div class="ui-g divContent">  
                <div class="EmptyBox10"/>
                <div class="ui-g-12 ui-md-6">
                    <p:panel>
                        <div id="chartshiftpayment" class="TexAlCenter"  style="min-height: 255px; max-height: 350px; width: 99%;position:relative;"   >
                            <svg style="height: 250px;"></svg>
                        </div>
                    </p:panel>
                </div>
                <div class="ui-g-12 ui-md-6">
                    <p:panel>
                        <div id="chartpreviouscomparison" class="TexAlCenter"  style="min-height: 255px; max-height: 350px; width: 99%;position:relative;"   >
                            <svg style="height: 250px;"></svg>
                        </div>
                    </p:panel>
                </div>
            </div>
        </h:panelGroup>
    </h:form>


    <!--Kaldırılan Ürün-->
    <p:dialog id="dlgRemovedStock" widgetVar="dlg_RemovedStock" resizable="false" width="60%" focus="dlgRemovedStock" responsive="true" dynamic="true" modal="true" closeOnEscape="true">
        <h:form id="frmRemovedStock">
            <ui:include src="/pages/general/common/tabgridtoolbar.xhtml">

                <ui:param name="bean" value="#{marketShiftTransferBean}"/>
                <ui:param name="btnNewId" value="false"/>
                <ui:param name="update" value="" />
                <ui:param name="outputtext" value="#{loc.removedstocks}" />

            </ui:include>
            <p:dataTable  id="dtbRemovedStock" var="removestock" class="tabDatatable"   value="#{marketShiftTransferBean.listOfRemovedStock}" selectionMode="single" emptyMessage="#{loc.norecordsfound}"
                          rowKey="#{removestock.id}">

                <p:column id="clmName" headerText="#{loc.employee}" >
                    <h:outputText value="#{removestock.userData.fullName}" />
                </p:column >
                <p:column id="clmDate" headerText="#{loc.processdate}">
                    <h:outputText value="#{removestock.processDate}" >
                        <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                    </h:outputText>
                </p:column >
                <p:column id="clmStock" headerText="#{loc.stock}">
                    <h:outputText value="#{removestock.stock.name}" />
                </p:column >
                <p:column id="clmBarcode" headerText="#{loc.barcode}">
                    <h:outputText value="#{removestock.stock.barcode}" />
                </p:column >
                <p:column id="clmOldValue" headerText="#{loc.oldamount}">
                    <h:outputText value="#{removestock.oldValue}" class="Fright">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="unit" value="#{removestock.stock.unit}"/>
                        <f:attribute name="type" value="unit" />
                    </h:outputText>
                </p:column >
                <p:column id="clmNewValue" headerText="#{loc.newamount}">
                    <h:outputText value="#{removestock.newValue}" class="Fright">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="unit" value="#{removestock.stock.unit}"/>
                        <f:attribute name="type" value="unit" />
                    </h:outputText>
                </p:column >
                <p:column id="clmRemovalAmount" headerText="#{loc.removedamount}">
                    <h:outputText value="#{removestock.removedValue}" class="Fright">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="unit" value="#{removestock.stock.unit}"/>
                        <f:attribute name="type" value="unit" />
                    </h:outputText>
                </p:column >
                <p:column id="clmUnitPrice" headerText="#{loc.unitprice}">
                    <h:outputText value="#{removestock.unitPrice}" class="Fright"> 
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{removestock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column >
                <p:column id="clmSumRemovedTotal" headerText="#{loc.removedtotalprice}">
                    <h:outputText value="#{removestock.removedTotalPrice}" class="Fright"> 
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{removestock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column >
            </p:dataTable>
        </h:form>
    </p:dialog>

    <!--Finansman Belgesi-->
    <p:dialog id="dlgFinancingDocument" widgetVar="dlg_FinancingDocument" resizable="false" width="50%" focus="dlgFinancingDocument" responsive="true" dynamic="true" modal="true" closeOnEscape="true">
        <ui:include src="/pages/finance/financingdocument/financingdocumentformovement.xhtml" >
            <ui:param name="financingDocument" value="#{marketShiftTransferBean.financingDocument}"/>
            <ui:param name="bean" value='#{marketShiftTransferBean}' />
            <ui:param name="type" value='marketShift' />
        </ui:include>
    </p:dialog>

    <p:overlayPanel id="olpIncomeExpense" widgetVar="olp_IncomeExpense" showEvent="none" modal="true" transient="true" for="frmCreateFinanacingDocument:txtDifferencePrice" at="left bottom" dismissable="true" hideEffect="blind" showCloseIcon="true" class="Wid30">
        <ui:include src="/pages/general/common/incomeexpensebook.xhtml">
            <ui:param name="updateBean" value='#{marketShiftTransferBean}' />
            <ui:param name="type" value='#{marketShiftTransferBean.beanName}' />
            <ui:param name="parameters" value='#{[marketShiftTransferBean.isIncomeExpense, sessionBean.user.lastBranch]}' /> 
            <ui:param name="form" value='frmIncomeExpenseBookFilter' /> 
        </ui:include>
    </p:overlayPanel>

    <!-- <p:confirmDialog global="true" class="deleteConfirm MaxWid500"   id="dlgApproveOrOpenShift" widgetVar="dlg_ApproveOrOpenShift"  closeOnEscape="true" responsive="true">
         <f:facet name="message">
             <h:outputText value="#{marketShiftTransferBean.message}"  style="white-space: pre-wrap;"/>
         </f:facet>
         <p:commandButton value="#{loc.yes}" actionListener="#{marketShiftTransferBean.transferShiftPaymentToMainSafe()}" onclick="PF('dlg_ApproveOrOpenShift').hide()" process="@this" styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
         <p:commandButton value="#{loc.no}" type="button" onclick="PF('dlg_ApproveOrOpenShift').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
     </p:confirmDialog>
    -->

    <p:dialog id="dlgApproveOrOpenShift"  widgetVar="dlg_ApproveOrOpenShift"  resizable="false" transient="true" focus="dlgApproveOrOpenShift" closeOnEscape="true" responsive="true"  width="20%" modal="true" >
        <p:ajax event="close" listener="#{marketShiftTransferBean.resetApproveDialog()}" global="false"/>
        <h:form id="frmAproval">  
            <div class="ui-g" >
                <div class="ui-g-12 ui-md-12 ui-lg-12">
                    <h:outputText class="FontBold Fs14" style="white-space: pre-wrap; color: #ca5959;"  value="#{marketShiftTransferBean.message}"  />
                </div>   

                <div class="ui-g-12 ui-md-12 ui-lg-12">
                    <p:selectBooleanCheckbox value="#{marketShiftTransferBean.createExcel}" rendered="#{marketShiftTransferBean.tempType == 0}" style="text-align: center; display: block;" itemLabel="#{loc.createexcel}" class="Fleft" styleClass="Fs13 FontBold checkboxDarkBorder">
                        <p:ajax global="false" listener="#{marketShiftTransferBean.fileProcess(1)}" />
                    </p:selectBooleanCheckbox>
                </div>  
                <div class="ui-g-12 ui-md-12 ui-lg-12">
                    <p:selectBooleanCheckbox value="#{marketShiftTransferBean.createPdf}" rendered="#{marketShiftTransferBean.tempType == 0}" style="text-align: center; display: block; padding-right: 7px;" itemLabel="#{loc.iscreatedpdf}" class="Fleft" styleClass="Fs13 FontBold checkboxDarkBorder">
                        <p:ajax global="false" listener="#{marketShiftTransferBean.fileProcess(2)}"  />
                    </p:selectBooleanCheckbox>
                </div>  
                <div class="ui-g-12 ui-md-12 ui-lg-12">
                    <p:selectBooleanCheckbox value="#{marketShiftTransferBean.showPreview}" rendered="#{marketShiftTransferBean.tempType == 0}" style="text-align: center; display: block; padding-left: 26px;" itemLabel="#{loc.ispreviewshowed}" class="Fleft" styleClass="Fs13 FontBold checkboxDarkBorder">
                        <p:ajax global="false" />
                    </p:selectBooleanCheckbox>
                </div>  
                <div class="ui-g-12 ui-md-12 ui-lg-6 TexAlCenter">
                    <p:commandButton value="#{loc.yes}" actionListener="#{marketShiftTransferBean.transferShiftPaymentToMainSafe()}"  process="@form" styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                </div>       
                <div class="ui-g-12 ui-md-12 ui-lg-6 TexAlLeft">
                    <p:commandButton value="#{loc.no}" type="button" onclick="PF('dlg_ApproveOrOpenShift').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                </div>
            </div>
        </h:form>
    </p:dialog>

    <p:dialog id="dlgCreateFinancingDocumentInSameTime"  widgetVar="dlg_CreateFinancingDocumentInSameTime"  resizable="false" transient="true" focus="dlgCreateFinancingDocumentInSameTime" closeOnEscape="true" responsive="true"  width="40%" modal="true" >

        <h:form id="frmCreateFinanacingDocument">
            <div class="ui-g-12 ui-md-6 ui-lg-6">
                <p:outputLabel value="#{loc.differenceprice}"   for="txtDifferencePrice" class="FontBold Fs12"/>
                <p:inputNumber id="txtDifferencePrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? '.': ','}"  
                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? ',': '.'}" 
                               decimalPlaces="#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}" readonly="true"
                               value="#{marketShiftTransferBean.differenceAmount}" 
                               symbolPosition="#{sessionBean.locale=='tr' ? 's': 'p'}" symbol="#{sessionBean.currencySignOrCode(marketShiftTransferBean.shiftPaymentFinancingDocumentCon.shiftPayment.currency.id, 0)}"  
                               class="TexAlRight" >
                </p:inputNumber>
            </div>
            <div class="ui-g-12 ui-md-6 ui-lg-6">
                <p:outputLabel value="#{loc.remainingprice}"   for="txtRemainingPrice" class="FontBold Fs12"/>
                <p:inputNumber id="txtRemainingPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? '.': ','}"  
                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1? ',': '.'}" 
                               decimalPlaces="#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}" readonly="true"
                               value="#{marketShiftTransferBean.remainingAmount}" 
                               symbolPosition="#{sessionBean.locale=='tr' ? 's': 'p'}" symbol="#{sessionBean.currencySignOrCode(marketShiftTransferBean.shiftPaymentFinancingDocumentCon.shiftPayment.currency.id, 0)}"  
                               class="TexAlRight" >
                </p:inputNumber>
            </div>
            <div class="ui-g-12 ui-md-6 ui-lg-6">
                <p:fieldset legend="#{loc.employee}" class="shiftCashFieldSet">
                    <div  class="ui-g-12 ui-md-6 ui-lg-6">
                        <p:outputLabel value="#{loc.employee}"  for="txtEmployee" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtEmployee" value="#{marketShiftTransferBean.shiftPaymentFinancingDocumentCon.shiftPayment.account.name}" readonly="true"/>
                    </div>
                    <div  class="ui-g-12 ui-md-6 ui-lg-6">
                        <p:outputLabel value="#{loc.total}" for="txtTotalBank" styleClass="Fs12 FontBold"/>
                        <p:inputNumber id="txtTotalBank" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}" 
                                       roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}" minValue="0"
                                       value="#{marketShiftTransferBean.employeePrice}"  class="Wid97 TexAlRight"  placeholder="#{loc.total}" required="true">
                            <p:ajax event="keyup" global="false" />
                        </p:inputNumber>
                    </div>
                    <div  class="ui-g-12 ui-md-6 ui-lg-9"></div>
                    <div  class="ui-g-12 ui-md-6 ui-lg-3">
                        <p:commandButton value="#{loc.save}" process="@this" action="#{marketShiftTransferBean.saveShiftPaymentFinancingDocCon(1)}"  global="false" class="Fright" rendered="#{!marketShiftTransferBean.selectedShift.is_Confirm and !marketShiftTransferBean.shiftPaymentFinancingDocumentCon.shiftPayment.is_check}">

                        </p:commandButton>                                                             
                    </div>
                </p:fieldset>
            </div>
            <div class="ui-g-12 ui-md-6 ui-lg-6">
                <p:fieldset legend="#{loc.incomeexpense}" class="shiftCashFieldSet">
                    <div  class="ui-g-12 ui-md-6 ui-lg-6">
                        <h:panelGroup id="pngIncomeExpense">
                            <p:outputLabel value="#{marketShiftTransferBean.isIncomeForCon ? loc.income : loc.expense}" for="#{marketShiftTransferBean.isIncomeForCon ? 'slcIncome' : 'slcExpense'}" styleClass="Fs12 FontBold"/>

                            <h:panelGroup rendered="#{!marketShiftTransferBean.isIncomeForCon}">
                                <p:inputText id="slcExpense" required="true" onclick="showIncomeExpenseBookShift()"  value="#{marketShiftTransferBean.shiftPaymentFinancingDocumentCon.financingDocument.incomeExpense.name}" class="inputPositionForBookFilter"  readonly="true"  placeholder="#{loc.expense}" >

                                </p:inputText>
                                <p:commandLink process="@this" class="commandLinkPositionForBookFilter" oncomplete="PF('olp_IncomeExpense').loadContents();">
                                    <i class="fa fa-book Fs16 iconPositionForBookFilter"></i>
                                    <p:ajax listener="#{incomeExpenseBookFilterBean.findFilterList([false, sessionBean.user.lastBranch],'frmIncomeExpenseBookFilter','olp_IncomeExpense',marketShiftTransferBean.beanName)}" />
                                </p:commandLink>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{marketShiftTransferBean.isIncomeForCon}">
                                <p:inputText id="slcIncome" required="true" onclick="showIncomeExpenseBookShift()"  value="#{marketShiftTransferBean.shiftPaymentFinancingDocumentCon.financingDocument.incomeExpense.name}" class="inputPositionForBookFilter"  readonly="true"  placeholder="#{loc.income}" >

                                </p:inputText>
                                <p:commandLink process="@this" class="commandLinkPositionForBookFilter" oncomplete="PF('olp_IncomeExpense').loadContents();">
                                    <i class="fa fa-book Fs16 iconPositionForBookFilter"></i>
                                    <p:ajax listener="#{incomeExpenseBookFilterBean.findFilterList([true, sessionBean.user.lastBranch],'frmIncomeExpenseBookFilter','olp_IncomeExpense',marketShiftTransferBean.beanName)}" />
                                </p:commandLink>
                            </h:panelGroup>
                        </h:panelGroup>
                    </div>
                    <div  class="ui-g-12 ui-md-6 ui-lg-6">
                        <p:outputLabel value="#{loc.total}" for="txtTotalIncomeExpense" styleClass="Fs12 FontBold"/>
                        <p:inputNumber id="txtTotalIncomeExpense" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}" 
                                       roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}" minValue="0"
                                       value="#{marketShiftTransferBean.incomeExpensePrice}"  class="Wid97 TexAlRight"  placeholder="#{loc.total}" required="true">
                            <p:ajax event="keyup" global="false" />
                        </p:inputNumber>
                    </div>
                    <div  class="ui-g-12 ui-md-6 ui-lg-9"></div>
                    <div  class="ui-g-12 ui-md-6 ui-lg-3">
                        <p:commandButton value="#{loc.save}" process="@this" action="#{marketShiftTransferBean.saveShiftPaymentFinancingDocCon(2)}"  global="false" class="Fright" rendered="#{!marketShiftTransferBean.selectedShift.is_Confirm and !marketShiftTransferBean.shiftPaymentFinancingDocumentCon.shiftPayment.is_check}">
                        </p:commandButton> 
                    </div>
                </p:fieldset>
            </div>
            <div  class="ui-g-12 ui-md-12 ui-lg-12">
                <p:dataTable id="dtbPayment" value="#{marketShiftTransferBean.listOfPaymentFinancingDocCon}" rowKey="#{shiftPaymentFinancingDocCon.id}" emptyMessage="#{loc.norecordsfound}"
                             selection="#{marketShiftTransferBean.selectedFinancingDocumentForDialog}" selectionMode="single" var="shiftPaymentFinancingDocCon" >

                    <p:ajax event="#{sessionBean.user.gridRowSelect}"  listener="#{marketShiftTransferBean.getfinancingDocument()}" global="false" update="dlgFinancingDocument" resetValues="true"/>


                    <p:column headerText="#{loc.processtype}">
                        <h:outputText value="#{shiftPaymentFinancingDocCon.financingDocument.incomeExpense.id==0 ? loc.employeemovement : shiftPaymentFinancingDocCon.financingDocument.incomeExpense.isIncome ? loc.income : loc.expense}" />
                    </p:column>
                    <p:column headerText="#{loc.movementplace}"  >
                        <h:outputText value="#{shiftPaymentFinancingDocCon.financingDocument.incomeExpense.id==0 ? marketShiftTransferBean.shiftPaymentFinancingDocumentCon.shiftPayment.account.name : shiftPaymentFinancingDocCon.financingDocument.incomeExpense.name}" />
                    </p:column>

                    <p:column headerText="#{loc.processamount}">
                        <h:outputText value="#{shiftPaymentFinancingDocCon.financingDocument.price}" style="float:right;" >
                            <f:converter converterId="currencyConverter"  />
                            <f:attribute name="currency"  value="#{shiftPaymentFinancingDocCon.financingDocument.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>
                </p:dataTable>
            </div>
            <p:remoteCommand name="showIncomeExpenseBookShift" process="@this" oncomplete="PF('olp_IncomeExpense').loadContents();" 
                             actionListener="#{incomeExpenseBookFilterBean.findFilterList([marketShiftTransferBean.isIncomeForCon, sessionBean.user.lastBranch],'frmIncomeExpenseBookFilter','olp_IncomeExpense',marketShiftTransferBean.beanName)}" />
        </h:form>
    </p:dialog>

    <!--Excel, pdf e basınca açılan dialog -->
    <p:dialog id="dlgAskBeforeImport"  widgetVar="dlg_AskBeforeImport" class="dialogWithTitleWith20Perc dialogScroll" header="#{loc.selectthefieldsyouwanttosee}" resizable="false" transient="true" focus="dlgAskBeforeImport" closeOnEscape="true" responsive="true"  width="20%" modal="true" >
        <h:form id="frmAskBeforeImport">  
            <p:panel class="divContent">
                <div class="ui-g">
                    <p:selectManyCheckbox value="#{marketShiftTransferBean.selectedOptions}" layout="responsive" columns="1">
                        <f:selectItems value="#{marketShiftTransferBean.importOptionsList}" var="option" itemLabel="#{option.tableName}" itemValue="#{option.id}" />
                        <p:ajax global="false"/>
                    </p:selectManyCheckbox>
                </div>
            </p:panel>
            <div  class="ui-g-12 ui-md-6 ui-lg-6 Fright">
                <p:commandButton value="#{loc.okey}" action="#{marketShiftTransferBean.importExcelPdf()}" onclick="PF('dlg_AskBeforeImport').hide()" process="@this" class="Fright" icon="ui-icon-check fa fa-check Fs14 white"   />
            </div>
        </h:form>
    </p:dialog>

    <style>
        .verticalSeparator {
            height: 31px !important;
        }
    </style>


    <script type="text/javascript">
        function transferExcel() {
            document.getElementById("frmMarketShiftTransfer:btnSecretExcel").click();
        }
        function transferPdf() {
            document.getElementById("frmMarketShiftTransfer:btnSecretPdf").click();
        }
        function updateDatatable() {
            document.getElementById("frmMarketShiftTransfer:updateDatatable").click();
        }

        var step1 = function () {
            transferExcel(function () {
                alert('test')
                transferPdf(function () {
                    goToPreview();
                })
            });
        };



        var datashiftpayment, datapreviousshift;
        var chrtshiftpayment = nv.models.multiBarChart(), chrtpreviousshift = nv.models.multiBarChart();
        var valueformat = ',.#{sessionBean.user.lastBranchSetting.shiftCurrencyRounding}f';
        var locsalesprice = '#{loc.salesprice}';
        var nodata = '#{loc.norecordsfound}';

        /*Ödeme Tipine Göre vardiya ödemeleri*/
        function  shiftpaymenttotype(dataStr) {
            datashiftpayment = dataStr;
            var jsondata = [];
            var key;
            var isThere = false;

            var list = $.parseJSON(dataStr);
            for (var i in list) {
                isThere = false;
                for (var a in jsondata) {
                    if (jsondata[a].key === list[i].name2) {
                        isThere = true;
                        key = jsondata[a].key;
                        break;
                    }
                }
                /*Listede Yok İse Listeye Ekle*/
                if (!isThere) {
                    var data = {};
                    var values = [];
                    values.push({
                        x: list[i].name1,
                        y: list[i].number1
                    });

                    data.key = list[i].name2;
                    data.values = values;
                    jsondata.push(data);
                } else {
                    for (var j in jsondata) {
                        if (key === jsondata[j].key) {
                            var values = {
                                'x': list[i].name1,
                                'y': list[i].number1
                            };
                            jsondata[j].values.push(values);
                            break;
                        }
                    }
                }
            }
            nv.addGraph(function () {
                chrtshiftpayment = nv.models.multiBarChart();
                chrtshiftpayment.multibar.stacked(false); // default to stacked
                chrtshiftpayment.showControls(false); // don't show controls
                chrtshiftpayment.groupSpacing(0.1);
                chrtshiftpayment.yAxis.axisLabel(locsalesprice).axisLabelDistance(-5);
                chrtshiftpayment.yAxis.tickFormat(d3.format(valueformat));//formatlı yazdırm
                chrtshiftpayment.xAxis
                        .tickFormat(function (d) {
                            return d.substring(d.indexOf("-") + 1, d.length)

                        });
                chrtshiftpayment.margin({right: 25, left: 80})
                chrtshiftpayment.noData(nodata);
                chrtshiftpayment.color(['#9bccdc', '#9ba7dc', '#303460'])
                d3.select('#chartshiftpayment svg')
                        .datum(jsondata)
                        .transition().duration(500).call(chrtshiftpayment);
                xTicksRemove('chartshiftpayment', 0, 15);

                nv.utils.windowResize(updatechrtshiftpayment);
                return chrtshiftpayment;
            });
        }
        function updatechrtshiftpayment() {
            chrtshiftpayment.update()
            xTicksRemove('chartshiftpayment', 0, 15);
        }

        /*Ödeme Tipine Göre vardiya ödemeleri*/
        function  comparepreviousshift(dataStr) {
            datapreviousshift = dataStr;
            var jsondata = [];
            var key;
            var isThere = false;

            var list = $.parseJSON(dataStr);
            for (var i in list) {
                isThere = false;
                for (var a in jsondata) {
                    if (jsondata[a].key === list[i].name2) {
                        isThere = true;
                        key = jsondata[a].key;
                        break;
                    }
                }
                /*Listede Yok İse Listeye Ekle*/
                if (!isThere) {
                    var data = {};
                    var values = [];
                    values.push({
                        x: list[i].name1,
                        y: list[i].number1
                    });

                    data.key = list[i].name2;
                    data.values = values;
                    jsondata.push(data);
                } else {
                    for (var j in jsondata) {
                        if (key === jsondata[j].key) {
                            var values = {
                                'x': list[i].name1,
                                'y': list[i].number1
                            };
                            jsondata[j].values.push(values);
                            break;
                        }
                    }
                }
            }
            nv.addGraph(function () {
                chrtpreviousshift = nv.models.multiBarChart();
                chrtpreviousshift.multibar.stacked(false); // default to stacked
                chrtpreviousshift.showControls(false); // don't show controls
                chrtpreviousshift.groupSpacing(0.1);
                chrtpreviousshift.yAxis.axisLabel(locsalesprice).axisLabelDistance(-5);
                chrtpreviousshift.yAxis.tickFormat(d3.format(valueformat));//formatlı yazdırm
                chrtpreviousshift.xAxis
                        .tickFormat(function (d) {
                            return d.substring(d.indexOf("-") + 1, d.length)

                        });
                chrtpreviousshift.margin({right: 25, left: 80})
                chrtpreviousshift.noData(nodata);
                chrtpreviousshift.color(['#e8b1b1', '#b1e8d3', '#9bdcfb'])
                d3.select('#chartpreviouscomparison svg')
                        .datum(jsondata)
                        .transition().duration(500).call(chrtpreviousshift);
                xTicksRemove('chartpreviouscomparison', 0, 15);

                nv.utils.windowResize(updatechrtcomparepreviousshift);
                return chrtpreviousshift;
            });

        }
        function updatechrtcomparepreviousshift() {
            chrtpreviousshift.update()
            xTicksRemove('chartpreviouscomparison', 0, 15);
        }

        /*Bu Fonskiyon X Ekseninde Gizlenmek İstenen Karakter Kadar Gizmle Yapar.*/
        function xTicksRemove(widgetname, begin, end) {
            var xTicks = d3.select('#' + widgetname + ' svg .nv-x.nv-axis > g').selectAll('g');
            xTicks.selectAll('text').select(function () {
                if (this.textContent != null) {
                    return this.textContent = this.textContent.substring(begin, end);
                }
            });
        }
    </script>

</ui:composition>



