<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <h:form id="frmBankReport">
        <ui:include src="/pages/general/common/toolbarreport.xhtml" >
            <ui:param name="outputtext" value="#{loc.bankextract}"/>
            <ui:param name="bean" value='#{bankExtractBean}' />
            <ui:param name="update" value=" pgBankReport pgrBankReportDatatable" />
        </ui:include>

        <h:panelGroup id="pgBankReport" class="divContent ui-g" layout="block" transient="true">  
            <div class="panelToggle  ui-g-12">

                <h:panelGroup id="pnlWhereBranch"  >
                    <h:panelGroup   >
                        <div class="ui-g-12 ui-md-6 ui-lg-2 ">
                            <p:outputLabel value="#{loc.branch}" for="slcBranch" class="FontBold Fs12"/>
                            <p:selectCheckboxMenu  id="slcBranch"  value="#{bankExtractBean.selectedBranchList}" 
                                                   filter="true" filterMatchMode="contains" converter="entityConverter" widgetVar="slcBranchCheckBox"  
                                                   label="#{bankExtractBean.selectedBranchList.size()!=0 ? bankExtractBean.selectedBranchList.size() :loc.all} #{bankExtractBean.selectedBranchList.size()!=0 ? loc.branch : ''} #{bankExtractBean.selectedBranchList.size()!=0 ? loc.selected : ''}" styleClass="Wid90" >
                                <f:selectItems value="#{bankExtractBean.listOfBranch}" itemLabel="#{branch.name}" itemValue="#{branch}" var="branch" />       
                                <p:ajax oncomplete="PF('slcBranchCheckBox').show()" listener="#{bankExtractBean.changeBranch()}" global="false" update="pgBankReport slcBranch"/>
                                <p:ajax event="toggleSelect" update="pgBankReport slcBranch" listener="#{bankExtractBean.changeBranch()}" oncomplete="PF('slcBranchCheckBox').show()" global="false"/>
                            </p:selectCheckboxMenu>
                        </div>    
                    </h:panelGroup>
                </h:panelGroup>


                <div  class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.bankaccount}" for="slcBank" styleClass="Fs12 FontBold"/>
                    <p:selectCheckboxMenu  id="slcBank"  value="#{bankExtractBean.listOfSelectedBank}" filter="true" 
                                           filterMatchMode="contains" converter="entityConverter" widgetVar="slc_bankCheckBox"  
                                           label="#{bankExtractBean.listOfSelectedBank.size()!=0 ? bankExtractBean.listOfSelectedBank.size() :loc.all} #{bankExtractBean.listOfSelectedBank.size()!=0 ? loc.bank : ''} #{bankExtractBean.listOfSelectedBank.size()!=0 ? loc.selected : ''}" styleClass="Wid90" >
                        <f:selectItems value="#{bankExtractBean.listOfBank}" itemLabel="#{bank.name}" itemValue="#{bank}" var="bank" />       
                        <p:ajax update="slcBank , bankReportDates, pnlWhereBranch" oncomplete="PF('slc_bankCheckBox').show()" global="false" />
                        <p:ajax event="toggleSelect" update="slcBank,bankReportDates, pnlWhereBranch" oncomplete="PF('slc_bankCheckBox').show()" global="false"/>
                    </p:selectCheckboxMenu>
                </div>

                <h:panelGroup id="bankReportDates" >
                    <h:panelGroup rendered="#{(bankExtractBean.listOfSelectedBank.size() == 1 and bankExtractBean.selectedBranchList.size() == 1) or (bankExtractBean.selectedBranchList.isEmpty() ? bankExtractBean.listOfBranch.size()>1 and bankExtractBean.listOfSelectedBank.size()==1 : bankExtractBean.selectedBranchList.size()>1 and bankExtractBean.listOfSelectedBank.size()==1)}">
                        <div class="ui-g-12 ui-md-6 ui-lg-2">
                            <p:outputLabel value="#{loc.startdate}" for="cldStartDate" styleClass="Fs12 FontBold"/>
                            <p:calendar  id="cldStartDate" class="datepicker" value="#{bankExtractBean.beginDate}" required="true" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" timeControlType="select" showOn="button" showButtonPanel="true" placeholder="#{loc.startdate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                                <p:ajax event="change" update="cldStartDate" resetValues="true" global="false"/>
                            </p:calendar>
                        </div>
                        <div class="ui-g-12 ui-md-6 ui-lg-2">
                            <p:outputLabel value="#{loc.enddate}" for="cldEndDate" styleClass="Fs12 FontBold"/>
                            <p:calendar  id="cldEndDate" class="datepicker" value="#{bankExtractBean.endDate}" required="true" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" timeControlType="select" showOn="button" showButtonPanel="true" placeholder="#{loc.enddate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                                <p:ajax event="change" update="cldEndDate" resetValues="true" global="false"/>
                            </p:calendar>
                        </div>
                    </h:panelGroup>
                </h:panelGroup>


            </div>
        </h:panelGroup>

    </h:form>
    <div class="EmptyBox20" />

    <h:panelGroup id="pgrBankReportDatatable" >
        <h:panelGroup rendered="#{bankExtractBean.isFind}">   


            <h:panelGroup id="pngDetail2">

                <div class="EmptyBox10"/>
                <c:if test="#{!((bankExtractBean.listOfSelectedBank.size()==1 and bankExtractBean.selectedBranchList.size() == 1) or (bankExtractBean.selectedBranchList.isEmpty() ? bankExtractBean.listOfBranch.size()>1 and bankExtractBean.listOfSelectedBank.size()==1 : bankExtractBean.selectedBranchList.size()>1 and bankExtractBean.listOfSelectedBank.size()==1))}">
                    <ui:include src="/pages/general/common/datagridtoolbarreport.xhtml" >
                        <ui:param name="bean" value="#{bankExtractBean}"/>   <!-- Bean -->
                        <ui:param name="datatable" value="frmBankReportDatatableDetail:dtbBankDetail" /> 
                        <ui:param name="fileName" value="#{loc.bankextract}"/>
                        <ui:param name="renderedToggler" value='true'/>
                        <ui:param name="renderedExcel" value='true'/>
                        <ui:param name="renderedPdf" value='true'/>
                        <ui:param name="renderedPrint" value='true'/>
                        <ui:param name="renderedGraphic" value='false'/>
                        <ui:param name="renderedOutputText" value="true"/>
                        <ui:param name="outputText" value="#{loc.lastsituation}"/>
                    </ui:include>
                </c:if> 



                <h:form id="frmBankReportDatatableDetail">
                    <c:if test="#{(bankExtractBean.listOfSelectedBank.size()==1 and bankExtractBean.selectedBranchList.size() == 1) or (bankExtractBean.selectedBranchList.isEmpty() ? bankExtractBean.listOfBranch.size()>1 and bankExtractBean.listOfSelectedBank.size()==1 : bankExtractBean.selectedBranchList.size()>1 and bankExtractBean.listOfSelectedBank.size()==1)}">
                        <p:toolbar style="height: 28px;" >
                            <f:facet name="left"> 
                                <p:commandLink title="#{loc.back}" class="Fleft" rendered="#{bankExtractBean.isBack}"   immediate="true"  >
                                    <i class="icon-reply-outline Fs20 tlbrBackBtn"/>    
                                    <f:actionListener  binding="#{bankExtractBean.goToBack()}"/>
                                </p:commandLink>
                                <h:outputText value="#{loc.lastsituation}" class="outputTextFont Fleft MarRight8" ></h:outputText>
                            </f:facet>
                        </p:toolbar>      
                    </c:if>     
                    <p:dataTable  id="dtbBankDetail"  var="BankDetail"  value="#{bankExtractBean.listOfBankMovement}" selectionMode="single"  widgetVar="BankDetailReportPF" emptyMessage="#{loc.norecordsfound}" selection="#{bankExtractBean.selectedBankMovement}"
                                  rows="#{sessionBean.user.defualtGridSize}" rowKey="#{BankDetail.id}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                                  rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" reflow="true" lazy="false" 
                                  class="dtbReport" >

                        <p:ajax event="#{sessionBean.user.gridRowSelect}" listener="#{bankExtractBean.seeBankExtractDetail()}" />
                        <p:ajax event="colReorder" listener="#{stockBean.reorder}" update="frmGridToolbar:toggle" />     
                        <p:ajax event="colResize"  listener="#{stockBean.onResize}" />


                        <p:column id="clmBranch" headerText="#{loc.branch}" visible="#{bankExtractBean.toogleList[0]}" exportable="#{bankExtractBean.toogleList[0]}">
                        <h:outputText  value="#{BankDetail.branch.name}"/>
                    </p:column>
                        <p:column id="clmBank" headerText="#{loc.bankname}" visible="#{bankExtractBean.toogleList[1]}" exportable="#{bankExtractBean.toogleList[1]}">
                            <h:outputText value="#{BankDetail.bankAccount.name}" />
                        </p:column>

                        <p:column id="clmIncoming" headerText="#{loc.sum} #{loc.incoming}" visible="#{bankExtractBean.toogleList[2]}" exportable="#{bankExtractBean.toogleList[2]}">
                            <p:column>
                                <h:outputText value="#{BankDetail.totalIncoming}" style="float: right;">
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{BankDetail.bankAccount.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </p:column>
                            <p:column rendered="true" >
                                <li  class="Fleft BordRad10" style="float: right;margin-right: 10px">
                                    <i class="fa fa-plus green"></i>
                                </li>
                            </p:column>
                        </p:column>

                        <p:column id="clmOutcoming" headerText="#{loc.sum} #{loc.outcoming}" visible="#{bankExtractBean.toogleList[3]}" exportable="#{bankExtractBean.toogleList[3]}">
                            <p:column>
                                <h:outputText value="#{BankDetail.totalOutcoming}" style="float: right;">
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{BankDetail.bankAccount.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </p:column>
                            <p:column rendered="true" >
                                <li  class="Fleft BordRad10" style="float: right;margin-right: 10px">
                                    <i class="fa fa-minus red"></i>
                                </li>
                            </p:column>
                        </p:column>

                        <p:column id="clmBalance" headerText="#{loc.balance}" visible="#{bankExtractBean.toogleList[4]}" exportable="#{bankExtractBean.toogleList[4]}">

                            <h:outputText value="#{BankDetail.bankAccount.balance}" style="float: right;">
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="currency" value="#{BankDetail.bankAccount.currency}"/>
                                <f:attribute name="type" value="currency" />
                            </h:outputText>
                        </p:column>

                        <p:columnGroup id="clmColumGroup" rendered="#{bankExtractBean.listOfBankMovement.size()>0 and !(bankExtractBean.listOfSelectedBank.size()==1 and bankExtractBean.selectedBranchList.size() == 1)}"  type="footer" >
                            <p:column visible="#{bankExtractBean.toogleList[0]}" exportable="#{bankExtractBean.toogleList[0]}">
                                <f:facet name="footer"  >
                                    <h:outputText value="" class="FontBold" />
                                </f:facet>
                            </p:column>
                            
                            <p:column visible="#{bankExtractBean.toogleList[1]}" exportable="#{bankExtractBean.toogleList[1]}">
                                <f:facet name="footer"  >
                                    <h:outputText value="#{loc.sum}" class="FontBold" />
                                </f:facet>
                            </p:column>

                            <p:column  visible="#{bankExtractBean.toogleList[2]}" exportable="#{bankExtractBean.toogleList[2]}">
                                <f:facet name="footer"  >
                                    <h:outputText value="#{bankExtractBean.subTotalIncome}" class="Fright FontBold"/>
                                </f:facet>
                            </p:column>

                            <p:column visible="#{bankExtractBean.toogleList[3]}" exportable="#{bankExtractBean.toogleList[3]}">
                                <f:facet name="footer"  >
                                    <h:outputText value="#{bankExtractBean.subTotalOutcome}" class="Fright FontBold"/>
                                </f:facet>
                            </p:column>

                            <p:column visible="#{bankExtractBean.toogleList[4]}" exportable="#{bankExtractBean.toogleList[4]}">
                                <f:facet name="footer"  >
                                    <h:outputText value="#{bankExtractBean.subTotalBalance}" class="Fright FontBold"/>
                                </f:facet>
                            </p:column>
                        </p:columnGroup>

                    </p:dataTable>  
                </h:form>
            </h:panelGroup>

            <div class="EmptyBox10"/>

            <h:panelGroup id="pngMovement">
                <c:if test="#{(bankExtractBean.listOfSelectedBank.size()==1 and bankExtractBean.selectedBranchList.size() == 1) or (bankExtractBean.selectedBranchList.isEmpty() ? bankExtractBean.listOfBranch.size()>1 and bankExtractBean.listOfSelectedBank.size()==1 : bankExtractBean.selectedBranchList.size()>1 and bankExtractBean.listOfSelectedBank.size()==1)}">

                    <ui:include src="/pages/general/common/datagridtoolbarreport.xhtml" >
                        <ui:param name="bean" value="#{bankAccountMovementTabBean}"/>
                        <ui:param name="datatable" value="frmBankReportDatatable:dtbBankReport" />
                        <ui:param name="fileName" value="#{loc.bankextract}"/>
                        <ui:param name="renderedToggler" value='false'/>
                        <ui:param name="renderedExcel" value='true'/>
                        <ui:param name="renderedPdf" value='true'/>
                        <ui:param name="renderedPrint" value='true'/>
                        <ui:param name="renderedGraphic" value='false'/>
                    </ui:include>

                    #{bankAccountMovementTabBean.init()}
                    <ui:include src="/pages/general/common/movementtabdatatable.xhtml">
                        <ui:param name="bean" value='#{bankAccountMovementTabBean}' />
                        <ui:param name="currency" value='#{bankExtractBean.listOfSelectedBank.get(0).currency}' />
                        <ui:param name="type" value="bankExtract"/>
                        <ui:param name="renderedBranch" value="#{true}"/>
                    </ui:include>

                </c:if>
            </h:panelGroup>

        </h:panelGroup>
    </h:panelGroup>


    <!--Print butonuna basınca movement için çalışan kısım-->
    <p:panel id="printerContainer" style="display: none"  >
        <p:panelGrid id="printerPanel" >

        </p:panelGrid>
    </p:panel> 

    <script type="text/javascript">
        function print_page() {
            var divContents = $("#printerPanel").html();
            var printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<div style="text-align:center; font-weight:bold; font-family:sans-serif;">#{loc.bankextract}</div>');
            printWindow.document.write('<div id="printerDiv">');
            printWindow.document.write(divContents);
            printWindow.document.write('</div>');
            printWindow.document.close();
            printWindow.print();

        }

    </script>

    <script type="text/javascript">
        function print_pageMovement() {
            var divContents = $("#printerPanel").html();
            var printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<div style="text-align:center; font-weight:bold; font-family:sans-serif;">#{loc.bankaccountmovements}</div>');
            printWindow.document.write('<div id="printerDiv">');
            printWindow.document.write(divContents);
            printWindow.document.write('</div>');
            printWindow.document.close();
            printWindow.print();

        }
    </script>

</ui:composition>