<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">



    <h:form id="frmAccountProcess">
        <ui:include src="/pages/general/common/processtoolbar.xhtml" >
            <ui:param name="outputtext" value="#{accountProcessBean.selectedObject.isEmployee?loc.employeeprocess:loc.accountprocesses}"/>
            <ui:param name="bean" value='#{accountProcessBean}' />
            <ui:param name="update" value="pgrAccountProcess" />
            <ui:param name="btnSaveId" value="#{(accountProcessBean.selectedObject.id==1) 
                                                or (!sessionBean.user.lastBranchSetting.isProcessPassiveAccount and accountProcessBean.selectedObject.status.id == 6) 
                                                or (accountProcessBean.selectedObject.centeraccount_id!=0) or (accountProcessBean.selectedObject.paymenttype_id != 0) ? 'false' : 
                                                marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(57, 0) : accountProcessBean.getRendered(60, 0)}" />     
            <ui:param name="renderback" value='true'/>
            <c:if test="#{accountProcessBean.processType==2}">
                <ui:param name="renderSelectedObject" value='true'/>
                <ui:param name="selectedObjectName" value="#{accountProcessBean.selectedObject.name}"/>
                <ui:param name="btnDeleteId" value="#{(accountProcessBean.selectedObject.id==1) or
                                                      (!sessionBean.user.lastBranchSetting.isProcessPassiveAccount and accountProcessBean.selectedObject.status.id == 6) 
                                                      or (accountProcessBean.selectedObject.centeraccount_id!=0) or (accountProcessBean.selectedObject.paymenttype_id != 0 and sessionBean.user.lastBranchSetting.isCentralIntegration) ? 'false' :
                                                      marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(58, 0) : accountProcessBean.getRendered(61, 0)}" />
                <ui:param name="btnTestBeforeDeleteId" value="#{accountProcessBean.selectedObject.id==1 ? 'false' : 'true'}" />
            </c:if>
        </ui:include>
        <h:panelGroup id="pgrAccountProcess" layout="block">
            <div class="ui-g divContent">
                <div class="ui-g panelToggle">

                    <ui:include  src="/pages/general/account/newaccount.xhtml">
                        <ui:param name="bean" value='#{accountProcessBean}' />
                    </ui:include>

                </div>
            </div>
        </h:panelGroup>
    </h:form>



    <div class="EmptyBox10" />

    <p:tabView id="tbvAccountProc" rendered="#{accountProcessBean.processType==2 and (marwiz.pageIdOfGoToPage==11 ? (accountProcessBean.getRendered(11, 1) or accountProcessBean.getRendered(71, 1) or accountProcessBean.getRendered(12, 1)
                                               or accountProcessBean.getRendered(13, 1) or accountProcessBean.getRendered(14, 1) or accountProcessBean.getRendered(15, 1) or accountProcessBean.getRendered(16, 1)
                                               or accountProcessBean.getRendered(66, 1) or accountProcessBean.getRendered(60, 1) or accountProcessBean.getRendered(17, 1)) : (accountProcessBean.getRendered(18, 1) or accountProcessBean.getRendered(72, 1) or accountProcessBean.getRendered(19, 1) or accountProcessBean.getRendered(20, 1)
                                               or accountProcessBean.getRendered(21, 1) or accountProcessBean.getRendered(67, 1) or accountProcessBean.getRendered(61, 1) or accountProcessBean.getRendered(22, 1)))
                                               }" scrollable="true" dynamic="true" cache="true">
        <p:ajax event="tabChange" listener="#{accountProcessBean.onTabChange}" update="pngAccountBook" />

        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab11' : 'tab18'}" title="#{loc.movements}" 
               rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(11, 1) :  accountProcessBean.getRendered(18, 1)}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==11 : accountProcessBean.activeIndex==18}"> 
                <ui:include src="/pages/general/account/accountmovementtab.xhtml" />
            </c:if>
        </p:tab>
        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab71' : 'tab72'}" title="#{loc.branches}" rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(71, 1) and sessionBean.user.lastBranch.isCentral :  accountProcessBean.getRendered(72, 1) and sessionBean.user.lastBranch.isCentral}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==71 : accountProcessBean.activeIndex==72}" > 
                <ui:include src="/pages/general/account/accountbranchtab.xhtml" />
            </c:if>
        </p:tab>
        <p:tab id="tab19" title="#{loc.detail}" rendered="#{accountProcessBean.selectedObject.isEmployee and accountProcessBean.getRendered(19, 1)}">
            <c:if test="#{accountProcessBean.activeIndex==19}"> 
                <ui:include src="/pages/general/account/personeldetailtab.xhtml" >
                </ui:include>
            </c:if>
        </p:tab>

        <p:tab id="tab12" title="#{loc.detail}" rendered="#{!accountProcessBean.selectedObject.isEmployee and accountProcessBean.getRendered(12, 1)}">
            <c:if test="#{accountProcessBean.activeIndex==12}"> 
                <ui:include src="/pages/general/account/accountdetailtab.xhtml" >
                </ui:include>
            </c:if>
        </p:tab>
        <p:tab id="tab13" title="#{loc.responsibles}" rendered="#{!accountProcessBean.selectedObject.isEmployee and accountProcessBean.getRendered(13, 1)}">
            <c:if test="#{accountProcessBean.activeIndex==13}" > 
                <ui:include src="/pages/general/responsible/responsible.xhtml" >
                    <ui:param name="btnNewId" value="#{responsibleBean.getRendered(72, 0)}"/>
                </ui:include>
            </c:if>
        </p:tab>
        <p:tab id="tab14" title="#{loc.vehicles}" rendered="#{!accountProcessBean.selectedObject.isEmployee and accountProcessBean.getRendered(14, 1)}">
            <c:if test="#{accountProcessBean.activeIndex==14}"> 
                <ui:include src="/pages/general/account/accountvehicletab.xhtml" >
                </ui:include>
            </c:if>
        </p:tab>

        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab15' : 'tab20'}" title="#{loc.cards}" rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(15, 1) :  accountProcessBean.getRendered(20, 1)}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==15 : accountProcessBean.activeIndex==20}"> 
                <ui:include src="/pages/general/account/accaountcardtab.xhtml">
                </ui:include>
            </c:if>
        </p:tab>


        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab16' : 'tab21'}" title="#{loc.categorization}" rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(16, 1) :  accountProcessBean.getRendered(21, 1)}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==16 : accountProcessBean.activeIndex==21}"> 
                <ui:include src="/pages/general/common/categorization.xhtml" >
                    <c:set var="item" value="#{accountProcessBean.selectedObject.isEmployee ? 26 : 3}" scope="request" />
                    <ui:param name="bean" value='#{accountCategorizationTabBean}' />
                    <ui:param name="updateTreeandDataList" value="tbvAccountProc:frmCategorization:treCategory tbvAccountProc:frmCategorization:dtlCategoryList" />
                    <ui:param name="updateDataList" value="tbvAccountProc:frmCategorization:dtlCategoryList" />
                    <ui:param name="updateDialog" value="tbvAccountProc:dlgCategory" />
                    <ui:param name="item" value='#{accountCategorizationTabBean.item}'/>
                    <ui:param name="renderBtnParent" value='#{marwiz.pageIdOfGoToPage==11 ? accountCategorizationTabBean.getRendered(87, 0) :  accountCategorizationTabBean.getRendered(91, 0)}'/>
                    <ui:param name="renderBtnChild" value='#{marwiz.pageIdOfGoToPage==11 ? accountCategorizationTabBean.getRendered(88, 0) :  accountCategorizationTabBean.getRendered(92, 0)}'/>
                    <ui:param name="renderBtnEdit" value='#{marwiz.pageIdOfGoToPage==11 ? accountCategorizationTabBean.getRendered(89, 0) :  accountCategorizationTabBean.getRendered(93, 0)}'/>
                    <ui:param name="renderBtnDelete" value='#{marwiz.pageIdOfGoToPage==11 ? accountCategorizationTabBean.getRendered(90, 0) :  accountCategorizationTabBean.getRendered(94, 0)}'/>
                </ui:include>
            </c:if>
        </p:tab>
        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab66' : 'tab67'}" title="#{loc.banks}" rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(66, 1) :  accountProcessBean.getRendered(67, 1)}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==66 : accountProcessBean.activeIndex==67}"> 
                <ui:include src="/pages/general/account/accountbanktab.xhtml"/>
            </c:if>
        </p:tab>
        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab60' : 'tab61'}" title="#{loc.notes}" rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(60, 1) :  accountProcessBean.getRendered(61, 1)}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==60 : accountProcessBean.activeIndex==61}"> 
                <ui:include src="/pages/general/account/accountnotetab.xhtml"/>
            </c:if>
        </p:tab>
        <p:tab id="#{marwiz.pageIdOfGoToPage==11 ? 'tab17' : 'tab22'}" title="#{loc.history}" rendered="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.getRendered(17, 1) :  accountProcessBean.getRendered(22, 1)}">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==17 : accountProcessBean.activeIndex==22}">
                <ui:include src="/pages/general/common/historydatatable.xhtml" >
                    <ui:param name="bean" value='#{historyTabBean}' />
                    <c:set var="createdPerson" value='#{accountProcessBean.selectedObject.userCreated.fullName}- #{accountProcessBean.selectedObject.userCreated.username }' scope="request"/>
                    <c:set var="createdTime" value='#{sessionBean.convertDateTime(accountProcessBean.selectedObject.dateCreated)}'  scope="request"/>
                    <c:set var="rowId" value="#{accountProcessBean.selectedObject.id}" scope="request" />
                    <c:set var="tableName" value="general.account" scope="request"/>
                </ui:include>
            </c:if>
        </p:tab>
    </p:tabView>

    <p:confirmDialog id="dlgRelatedRecordInfo" global="true"  class="deleteConfirm controlDelete" severity="alert" widgetVar="dlg_RelatedRecordInfo" closeOnEscape="true" width="20%" responsive="true">
        <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==11 : accountProcessBean.activeIndex==18}"> 
            <f:facet name="message">
                <p:panel class="divContent">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-12 ui-lg-12">
                            <h:outputText value="#{accountMovementTabBean.deleteControlMessage}" style="color:black !important"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12">
                            <h:outputText value="#{accountMovementTabBean.deleteControlMessage1}" style="color:black !important"/>
                        </div>
                        <h:panelGroup rendered="#{accountMovementTabBean.response != -106}">
                            <div class="ui-g-12 ui-md-12 ui-lg-6">
                                <h:outputText value="#{accountMovementTabBean.deleteControlMessage2}" class="Fright"/>
                            </div>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{accountMovementTabBean.response == -106}">
                            <div class="ui-g-12 ui-md-12 ui-lg-12">
                                <h:outputText value="#{accountMovementTabBean.deleteControlMessage2}"/>
                            </div>
                        </h:panelGroup>
                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                            <p:commandLink value="#{accountMovementTabBean.relatedRecord}" class="Fleft cmdRelatedRecord" title="#{loc.gotorelatedrecord}" actionListener="#{accountMovementTabBean.goToRelatedRecordBefore()}"/>
                        </div>
                    </div>
                </p:panel>
            </f:facet>
        </c:if>
    </p:confirmDialog>


    <h:panelGroup id="pngAccountBook">
        <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==11 : accountProcessBean.activeIndex==18}"> 
            <ui:include src="/pages/general/common/accountbook.xhtml" >
                <ui:param name="updateBean" value='#{accountMovementTabBean.isAccountTransfer ? customerToCustomerTransferBean: accountMovementTabBean}' />
                <ui:param name="for" value="#{accountMovementTabBean.isAccountTransfer ?'frmFinancingDocumentAccountProcess:slcOperationType':'tbvAccountProc:frmFinancingDocumentProcess:slcOperationType'}" />
                <ui:param name="type" value="#{accountMovementTabBean.bookType}" /> 
                <ui:param name="parameters" value='#{[accountMovementTabBean.isAccountTransfer ? customerToCustomerTransferBean.customerToCustomer.branch : accountMovementTabBean.selectedObject.financingDocument.branch]}' /> 
                <ui:param name="columnsize" value='2' /> 
                <ui:param name="form" value='frmAccountBookFilter' /> 
                <ui:param name="overlay" value="olp_account" />
            </ui:include>

            <p:overlayPanel id="olpIncomeExpense" widgetVar="olp_IncomeExpense" showEvent="none" modal="true" transient="true" for="tbvAccountProc:frmFinancingDocumentProcess:slcOperationType" at="left bottom" dismissable="true" hideEffect="blind" showCloseIcon="true" class="Wid30">
                <ui:include src="/pages/general/common/incomeexpensebook.xhtml">
                    <ui:param name="updateBean" value='#{accountMovementTabBean}' />
                    <ui:param name="type" value='financingDocumentBean' />
                    <ui:param name="parameters" value='#{[accountMovementTabBean.isIncomeExpense, accountMovementTabBean.selectedObject.financingDocument.branch]}' /> 
                    <ui:param name="form" value='frmIncomeExpenseBookFilter' /> 
                </ui:include>
            </p:overlayPanel>

        </c:if>
    </h:panelGroup>

    
    <c:if test="#{customerToCustomerTransferBean.processType==1}"> 
        <p:dialog id="dlgCustomerToCustomerTransferProcess" widgetVar="dlg_customertocustomerprocess" resizable="false" width="60%" focus="dlgCustomerToCustomerTransferProcess" responsive="true" dynamic="true" modal="true" closeOnEscape="true">
            <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==11 : accountProcessBean.activeIndex==18}"> 
                <ui:include src="/pages/general/account/customertocustomermovement.xhtml" >
                    <ui:param name="bean" value='#{customerToCustomerTransferBean}' />
                </ui:include>
            </c:if>
        </p:dialog>
    </c:if>
    
    <p:dialog id="dlgAccountBranch" widgetVar="dlg_AccountBranch" resizable="false" focus="dlgAccountBranch" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="30%" >
        <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==71 : accountProcessBean.activeIndex==72}">
            <ui:include src="/pages/general/account/accountbranchprocess.xhtml"/>
        </c:if>
    </p:dialog> 

    <!--araçlar tabı için açılan dialog-->
    <p:dialog id="dlgVehicleProcess" widgetVar="dlg_VehicleProcess" modal="true" resizable="false" width="20%" focus="dlgVehicleProcess" responsive="true" dynamic="true" closeOnEscape="true">
        <c:if test="#{accountProcessBean.activeIndex==14}"> 
            <ui:include src="/pages/general/account/accountvehicleprocess.xhtml"/>
        </c:if>
    </p:dialog>

    <!--kartlar tabı için açılan dialog-->
    <p:dialog id="dlgAccountCardProc" widgetVar="dlg_AccountCardProc" modal="true" resizable="false" width="30%" focus="dlgAccountCardProc" responsive="true" dynamic="true" closeOnEscape="true">
        <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==15 : accountProcessBean.activeIndex==20}"> 
            <ui:include src="/pages/general/account/accountcardprocess.xhtml"/>
        </c:if>
    </p:dialog>
    
     <!--Yetkililer tabında yeni yetkili için açılan dialog-->
    <p:dialog id="dlgResponsibleProc" widgetVar="dlg_responsibleproc" resizable="false" focus="dlgResponsibleProc" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="55%" >
        <c:if test="#{accountProcessBean.activeIndex==13}">
            <p:ajax event="close" listener="#{responsibleBean.closeDialog()}"/>
            <ui:include src="/pages/general/responsible/responsibleprocess.xhtml">
                <ui:param name="btnSaveId" value='#{responsibleBean.getRendered(73, 0)}' />
                <ui:param name="btnDeleteId" value='#{responsibleBean.processType==2 and responsibleBean.getRendered(74, 0)}' />
                <ui:param name="tabViewRendered" value="#{responsibleBean.processType==2 and responsibleBean.getRendered(23, 1)}"/>
                <ui:param name="tabRendered" value="#{responsibleBean.getRendered(23, 1)}"/>
                <ui:param name="cifRendered" value="#{responsibleBean.activeIndex==23}"/>
                <ui:param name="tabId" value="tab23"/>
                <ui:param name="btnCommunicationNewId" value="#{responsibleCommunicationBean.getRendered(75, 0)}"/>
                <c:set var="whichPage" value="#{1}" scope="request" />
            </ui:include>
        </c:if>
    </p:dialog> 
     
      <!--Yetkililer tabında communşcation için açılan dialog-->
    <p:dialog id="dlgResponsibleCommunication" widgetVar="dlg_ResponsibleCommunication" resizable="false" focus="dlgResponsibleCommunication" width="35%" responsive="true" dynamic="true" modal="true" closeOnEscape="true" onHide="Centrowiz.removeVariable()">
        <c:if test="#{accountProcessBean.activeIndex==13}">
            <h:form id="frmResponsibleCommunication" >
                <ui:include src="/pages/general/common/processtoolbarcommunication.xhtml" > 
                    <ui:param name="outputtext" value="#{loc.communicationprocesses}"/>
                    <ui:param name="bean" value='#{responsibleCommunicationBean}'/>
                    <ui:param name="update" value="grdCommunication tbvResponsibleProc:frmResponsibleCommunicationTab:dtbCommunication" />
                    <ui:param name="btnSaveId" value="#{responsibleCommunicationBean.getRendered(76, 0)}" />
                    <ui:param name="btnDeleteId" value='false' />
                    <ui:param name="dialog" value='dlg_ResponsibleCommunication' />
                    <c:if test="#{responsibleCommunicationBean.communicationProcessType==2}">
                        <ui:param name="btnDeleteId" value="#{responsibleCommunicationBean.getRendered(77, 0)}" />
                    </c:if>
                </ui:include>

                <ui:include src="/pages/general/common/communicationprocess.xhtml">
                    <ui:param name="bean" value='#{responsibleCommunicationBean}'/>  
                    <ui:param name="updateGrid" value="grdCommunication"/> 
                    <ui:param name="form" value="frmResponsibleCommunication"/>
                </ui:include>

            </h:form>
        </c:if>
    </p:dialog> 
      
      <!--notlar tabı için açılan dialog-->
      <p:dialog id="dlgNoteProcess" widgetVar="dlg_NoteProcess" modal="true" resizable="false" width="30%" focus="dlgNoteProcess" responsive="true" dynamic="true" closeOnEscape="true">
          <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==60 : accountProcessBean.activeIndex==61}"> 
              <ui:include src="/pages/general/account/accountnoteprocess.xhtml"/>
          </c:if>
      </p:dialog>
      
       <!--bankalar tabı için açılan dialog-->
      <p:dialog id="dlgAccountBankProcess" widgetVar="dlg_AccountBankProcess" modal="true" resizable="false" width="50%" focus="dlgAccountBankProcess" responsive="true" dynamic="true" closeOnEscape="true">
          <c:if test="#{marwiz.pageIdOfGoToPage==11 ? accountProcessBean.activeIndex==66 : accountProcessBean.activeIndex==67}"> 
              <ui:include src="/pages/general/account/accountbankprocess.xhtml"/>
          </c:if>
      </p:dialog>

    <!--Print butonuna basınca çalışan kısım-->
    <p:panel id="printerContainer" style="display: none"  >
        <p:panelGrid id="printerPanel" >

        </p:panelGrid>
    </p:panel> 



    <script type="text/javascript">
        function print_page() {
            var divContents = $("#printerPanel").html();
            var printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<div style="text-align:center; font-weight:bold; font-family:sans-serif;">#{marwiz.pageIdOfGoToPage==11 ? loc.accountmovements : loc.employeemovements}</div>');
            printWindow.document.write('<div id="printerDiv">');
            printWindow.document.write(divContents);
            printWindow.document.write('</div>');
            printWindow.document.close();
            printWindow.print();

        }
    </script>
</ui:composition>  
