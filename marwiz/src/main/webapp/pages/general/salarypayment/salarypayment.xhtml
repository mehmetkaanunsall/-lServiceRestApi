<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:include src="/pages/general/common/datagridtoolbardefinition.xhtml" >
        <ui:param name="bean" value="#{salaryPaymentBean}"/> 
        <ui:param name="btnPaySalary" value='#{salaryPaymentBean.getRendered(47, 0)}'/>
        <ui:param name="btnDebiting" value='#{salaryPaymentBean.getRendered(46, 0)}'/>
        <ui:param name="btnPaySalaryAndDebiting" value='#{salaryPaymentBean.getRendered(48, 0)}'/>
        <ui:param name="datatable" value="frmSalaryPayments:dtbSalaryPayments" />
        <ui:param name="widgetvar" value="salaryPaymentsPF" />
        <ui:param name="form" value='frmToolbarSalaryPayments' />
    </ui:include>

    <h:form id="frmSalaryPayments"> 

        <p:dataTable  id="dtbSalaryPayments" var="salaryPayments"  value="#{salaryPaymentBean.listEmpInfo}"  selection="#{salaryPaymentBean.listOfObjects}" widgetVar="salaryPaymentsPF" emptyMessage="#{loc.norecordsfound}"
                      rows="#{sessionBean.user.defualtGridSize}" rowKey="#{salaryPayments.id}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                      rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" 
                      reflow="true" sortBy="#{salaryPayments.account.name}" editable="true" editMode="cell" class="salaryPaymentDatatable" filteredValue="#{salaryPaymentBean.listOfFilteredObjects}" >

            <p:ajax  event="cellEdit" listener="#{salaryPaymentBean.onCellEdit}" oncomplete="updateDatatable()" /> 
            <p:ajax event="toggleSelect" listener="#{salaryPaymentBean.selectRows}" oncomplete="updateDatatable()" />
            <p:ajax event="rowSelectCheckbox" listener="#{salaryPaymentBean.onRowSelect}" oncomplete="updateDatatable()"/>
            <p:ajax event="rowUnselectCheckbox" listener="#{salaryPaymentBean.onRowUnSelect}" oncomplete="updateDatatable()"/>



            <f:facet name="footer" rendered="false" >
                <p:inputText id="globalFilter" value="#{salaryPaymentBean.autoCompleteValue}"  style="display: none"  />
            </f:facet>

            <p:column selectionMode="multiple" style="width:26px;text-align:center;" selectRow="false"/>

            <p:column id="clmEmployee" headerText="#{loc.employee}" sortable="true" sortBy="#{salaryPayments.account.name}"  filterable="true" filterBy="#{salaryPayments.account.name}" filterMatchMode="contains" selectRow="false" >
                <f:facet name="filter">
                    <p:outputLabel   rendered="false" />
                </f:facet> 
                <h:outputText value="#{salaryPayments.account.name}"/>  
            </p:column>

            <p:column id="clmExactSalary" headerText="#{loc.exactsalary}" sortable="true" sortBy="#{salaryPayments.exactsalary}"  selectRow="false" >
                <h:outputText value="#{salaryPayments.exactsalary}" class="Fright">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{sessionBean.user.lastBranch.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
            </p:column>

            <p:column id="clmAgi" headerText="#{loc.agi}" sortable="true" sortBy="#{salaryPayments.agi}" selectRow="false"  >
                <h:outputText value="#{salaryPayments.agi}" class="Fright">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{sessionBean.user.lastBranch.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
            </p:column>

            <p:column id="clmDeficitSurplus" headerText="#{loc.deficitorsurplus}" sortable="true" sortBy="#{salaryPayments.accountMovement.balance}" selectRow="false">
                <h:outputText value="#{salaryPayments.accountMovement.balance}" class="Fright" style="#{salaryPayments.accountMovement.balance == null ? '' : salaryPayments.accountMovement.balance >= 0  ?  'color:#488e48' :  'color:#b54d4d'}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{sessionBean.user.lastBranch.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
            </p:column>

            <p:column id="clmSalaryToBePaid"  headerText="#{loc.salarytobepaid}" sortable="true" sortBy="#{salaryPayments.accountMovement.price}" class="editableinput" selectRow="false" >
                <p:cellEditor>
                    <f:facet name="output">
                        <h:outputText value="#{salaryPayments.accountMovement.price > 0 ? salaryPayments.accountMovement.price : BigDecimal.ZERO}" class="Fright" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{sessionBean.user.lastBranch.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </f:facet>
                    <f:facet name="input">
                        <p:inputNumber value="#{salaryPayments.accountMovement.price}" style="width:96%" class="Fright" minValue="0">
                        </p:inputNumber>
                    </f:facet>
                </p:cellEditor>
            </p:column>

            <p:columnGroup type="footer" class="Fright" >

                <p:row> 
                    <p:column  style="text-align:right;" colspan="6" selectRow="false">
                        <f:facet name="footer">
                            <h:outputText value="#{loc.totalsalarytobepaid} : "  style="font-weight: bold;font-size: 16px"/>
                            <h:outputText  class="Fright FontBold Fs15" style="color: #565656" value="#{salaryPaymentBean.totalPaidSalary}" >
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="currency" value="#{sessionBean.user.lastBranch.currency}"/>
                                <f:attribute name="type" value="currency" />
                            </h:outputText>
                        </f:facet>
                    </p:column> 
                </p:row>    

            </p:columnGroup>  

        </p:dataTable> 
        <p:commandButton id="updateDatatable" style="display: none" process="@this" update="frmSalaryPayments:dtbSalaryPayments frmPopupDialog" global="false"/>
    </h:form>  


    <script>
        function updateDatatable() {
            document.getElementById("frmSalaryPayments:updateDatatable").click();
        }
    </script>

    <p:dialog id="dlgSalaryPayment" widgetVar="dlg_SalaryPayment" resizable="false" width="50%"
              focus="dlgSalaryPayment" modal="true" responsive="true" closeOnEscape="true" class="dialogScroll" >
        <p:ajax event="close" update="frmPopupDialog" global="false" listener="#{salaryPaymentBean.resetDialog()}"  />
        <h:form id="frmPopupDialog" >

            <ui:include src="/pages/general/common/processtoolbar.xhtml" >
                <ui:param name="bean" value='#{salaryPaymentBean}' />
                <ui:param name="outputtext" value=" #{salaryPaymentBean.whichAction == 0 ?  loc.accrueprocess : loc.salarypaymentprocess}" />
                <ui:param name="btnSaveId" value='true' />
                <ui:param name="update" value="frmSalaryPayments:dtbSalaryPayments frmPopupDialog"/>
            </ui:include>  

            <h:panelGroup id="pgrPopupDialog" layout="block"  class="divContent">

                <div class="ui-g">

                    <h:panelGroup rendered="#{salaryPaymentBean.whichAction==0}">
                        <div  class="ui-g-12 ui-md-3 ui-lg-3">
                            <p:outputLabel value="#{loc.processtype}" for="cldPopup2ProcessType" styleClass="Fs12 FontBold" />
                            <p:selectOneMenu  id="cldPopup2ProcessType" value="#{salaryPaymentBean.financingDocument.financingType.id}" required="true" styleClass="Wid97">
                                <f:selectItem itemLabel="#{salaryPaymentBean.debitingtype.nameMap.get(sessionBean.langId).name}" itemValue="#{salaryPaymentBean.debitingtype.id}" /> 
                            </p:selectOneMenu>
                        </div>
                    </h:panelGroup> 

                    <h:panelGroup rendered="#{salaryPaymentBean.whichAction==1 or salaryPaymentBean.whichAction==2}">
                        <div  class="ui-g-12 ui-md-3 ui-lg-3">
                            <p:outputLabel value="#{loc.processtype}" for="cldPopupProcessType" styleClass="Fs12 FontBold" />
                            <p:selectOneMenu  id="cldPopupProcessType" value="#{salaryPaymentBean.financingDocument.financingType.id}" required="true" styleClass="Wid97">
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true"/> 
                                <f:selectItems value="#{salaryPaymentBean.listPaymentType}" var="type" itemLabel="#{type.nameMap.get(sessionBean.langId).name}" itemValue="#{type.id}"  />
                                <p:ajax event="change" update="pgrPopupDialog" process="@this" />
                            </p:selectOneMenu>
                        </div>
                    </h:panelGroup> 

                    <h:panelGroup rendered="#{salaryPaymentBean.whichAction==0 or (salaryPaymentBean.financingDocument.financingType.id != 48 and salaryPaymentBean.financingDocument.financingType.id != 56)}">
                        <div  class="ui-g-12 ui-md-6 ui-lg-3"></div>
                    </h:panelGroup>




                    <!--                            Nakit Ödeme  -->
                    <h:panelGroup rendered="#{salaryPaymentBean.financingDocument.financingType.id==48}">

                        <div  class="ui-g-12 ui-md-6 ui-lg-3">
                            <p:outputLabel value="#{loc.safecodename}"  for="slcCashSafe" styleClass="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcCashSafe" value="#{salaryPaymentBean.safe.id}" required="true" >                 
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true"/> 
                                <f:selectItems value="#{salaryPaymentBean.listSafe}" 
                                               var="safe" itemLabel="#{safe.name}" 
                                               itemValue="#{safe.id}"  itemDisabled="#{!safe.isMposMovement}"/>
                            </p:selectOneMenu>
                        </div>

                    </h:panelGroup>

                    <!--                           Giden Havale  -->
                    <h:panelGroup rendered="#{salaryPaymentBean.financingDocument.financingType.id==56}"> 

                        <div  class="ui-g-12 ui-md-6 ui-lg-3">
                            <p:outputLabel value="#{loc.bankcodename}"  for="slcCreditCardBank" styleClass="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcCreditCardBank" value="#{salaryPaymentBean.bankAccount.id}" required="true" >                 
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true"/> 
                                <f:selectItems value="#{salaryPaymentBean.listBankAccount}" 
                                               var="bankacc" itemLabel="#{bankacc.name}" 
                                               itemValue="#{bankacc.id}" />
                            </p:selectOneMenu>
                        </div>
                    </h:panelGroup> 

                    <div  class="ui-g-12 ui-md-3 ui-lg-3">
                        <p:outputLabel value="#{loc.documentnumber}" for="txtDocumentNumber" styleClass="Fs12 FontBold" />
                        <p:inputText id="txtDocumentNumber" styleClass="Wid97" placeholder="#{loc.documentnumber}"
                                     value="#{salaryPaymentBean.financingDocument.documentNumber}">
                        </p:inputText>
                    </div>

                    <div  class="ui-g-12 ui-md-3 ui-lg-3">
                        <p:outputLabel value="#{loc.documentdate}" for="cldDocDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldDocDate" required="true"
                                     value="#{salaryPaymentBean.financingDocument.documentDate}" 
                                     styleClass="Wid95"  beforeShow="dpClearButton"
                                     pattern="#{sessionBean.user.lastBranch.dateFormat}" 
                                     showOn="button"
                                     showButtonPanel="true" placeholder="#{loc.documentdate}" mask="true" 
                                     navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" 
                                     >
                            <p:ajax event="dateSelect" global="false"/>
                        </p:calendar>
                    </div>

                    <div  class="ui-g-12 ui-md-3 ui-lg-3">    
                        <p:outputLabel value="#{loc.total}" for="txtPrice" styleClass="Fs12 FontBold" />
                        <p:inputNumber id="txtPrice" value="#{salaryPaymentBean.whichAction == 0 ? salaryPaymentBean.totalAccrual : salaryPaymentBean.totalPaidSalary}"  class="Wid97 TexAlRight" placeholder="#{loc.price}"  readonly="true" >
                            <p:ajax event="keyup" update="total" global="false" />
                        </p:inputNumber>
                    </div>

                    <div  class="ui-g-12 ui-md-3 ui-lg-3">
                        <p:outputLabel value="#{loc.currency}" for="currency" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="currency" disabled="#{!sessionBean.lastBranchSetting.isForeignCurrency}">                 
                            <f:selectItem itemLabel="#{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id,0)}" />
                        </p:selectOneMenu>
                    </div>

                   <!--  <h:panelGroup  rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}" > -->
                    <div  class="ui-g-12 ui-md-3 ui-lg-3">
                        <p:outputLabel value="#{loc.exchangerate} #{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id,0)} -> #{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id,0)}" 
                                       styleClass="Fs12 FontBold"  for="exchangerate"/>
                        <p:inputNumber id="exchangerate"  value="1" required="true" readonly="true" />
                    </div>
                    <!--   </h:panelGroup> -->
                  <!--   <h:panelGroup  rendered="#{!sessionBean.lastBranchSetting.isForeignCurrency}" >
                        <div  class="ui-g-12 ui-md-3 ui-lg-3" />
                    </h:panelGroup> -->

                    <div  class="ui-g-12 ui-md-3 ui-lg-3">
                        <p:outputLabel value="#{loc.total}"  styleClass="Fs12 FontBold" for="total"/>
                        <p:inputNumber id="total"  value="#{salaryPaymentBean.whichAction == 0 ? salaryPaymentBean.totalAccrual : salaryPaymentBean.totalPaidSalary}" readonly="true"
                                       decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}" thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol == 1 ? ',': '.'}"
                                       roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" symbol=" #{sessionBean.currencySignOrCode(sessionBean.user.lastBranch.currency.id, 0)}"
                                       symbolPosition="s"
                                       >
                        </p:inputNumber>
                    </div>

                    <div  class="ui-g-12 ui-md-12 ui-lg-12">
                        <p:outputLabel value="#{loc.description}" for="txtAciklama" styleClass="Fs12 FontBold" />
                        <p:inputText id="txtAciklama" styleClass="Wid99"  placeholder="#{loc.description}"
                                     value="#{salaryPaymentBean.financingDocument.description}">
                            <p:ajax event="keyup" global="false"/>
                        </p:inputText>
                    </div>

                </div>
            </h:panelGroup>

        </h:form>
    </p:dialog>


    <p:confirmDialog id="dlgConf" widgetVar="confirmDlg" message="#{salaryPaymentBean.whichAction == 0 ? loc.areyousurewanttoaccrue  : salaryPaymentBean.whichAction == 1 ? loc.areyousureyouwanttopaysalary : loc.areyousurewanttoaccrueandpaysalary}" appendTo="@(body)"  global="true" showEffect="fade" hideEffect="fade">
        <p:commandButton value="#{loc.yes}"  styleClass="ui-confirmdialog-yes" icon="ui-icon-check" actionListener="#{salaryPaymentBean.decideWhichAction()}" />
        <p:commandButton value="#{loc.no}" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" onclick="PF('confirmDlg').hide();" />
    </p:confirmDialog>  


    <style>
        .ui-toolbar .ui-button-text {
            padding: 4px 12px 4px 10px !important;
        }
        .ui-dialog-content > .ui-icon {
            display: none;
        }
    </style>

</ui:composition>