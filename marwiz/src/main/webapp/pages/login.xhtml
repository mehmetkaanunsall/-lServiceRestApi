<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui" contentType="text/html">

    <h:head>
        <title>Marwiz</title>
        <link rel="shortcut icon" type="image/x-icon" href="#{resource['sentinel-layout/images/centrowiz.ico']}"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>

        <h:outputStylesheet name="css/font-icon-layout.css" library="sentinel-layout" />
        <h:outputStylesheet name="css/sentinel-layout.css" library="sentinel-layout" />
        <h:outputStylesheet name="css/core-layout.css" library="sentinel-layout" />

        <style type="text/css">
            .mlbGroup{
                position: absolute;
                top: 0px;
                right: 17%;
                width: 60px;
                height: 110px;
                background-color: #fff;
                border-radius: 0 0 5px 5px;                
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }
            .mlbGroup > img {
                margin: 46px 8px 0px 8px;
                width: 44px;
                height: 58px;
            }

            .marwizLogo{
                border-radius: 0 0 8px 8px;
                margin-left: 26%;
                width: 165px;
                height: 27px;
                padding: 7px 7px 6px 10px;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
                position: relative;
                margin: auto;
            }
            @media (max-width: 1500px){
                .loginText{ margin-left: 5%; max-width: 15%; }
                .mlbGroup{ right: 13%; }
            }
            @media (max-width: 900px){
                .loginText{ margin-top: 60%; text-align: center; max-width: 90%; }
                .mlbGroup{ right: 5%; }
            }
            @media (max-width: 740px){
                .loginText{ margin-top: 80%;}
                .mlbGroup{ right: 0%; }
                .mlbGroup{ display: block; }
            }
            @media (max-width: 540px){
                .loginText{ margin-top: 90%;}
                .mlbGroup{ display: none; }
            }
            @media (max-width: 400px){
                .loginText{ margin-top: 120%;}
            }            
        </style>      

    </h:head>

    <h:body class="fontRegular login-back white-back">

        #{session.invalidate()}
        <div class="Container">   

            <div class="mlbGroup">
                <h:graphicImage name="images/mlb_logo.png" styleClass="Fleft"  library="sentinel-layout"/>  
            </div>
            <!-- LOGIN BOX COVER START -->           
            <div class="Container80 MaxWid500 white-back Fnone MarAuto BordRad10" style="margin-top: 8%;" id="login-box">
                <p:panel id="box" style="border: none;padding: 0 !important;">

                    <div class="Container" style="margin: -5px;">                        
                        <div style="border-bottom: 1px solid #c9c8c8; margin-bottom: 20px;">
                            <div class="MarAuto" style="width: 200px;max-width: 230px;margin: 15px auto 10px auto;">
                                <a href="" style="display: inline-block;">
                                    <h:graphicImage name="images/marwiz_logo_login.png" style="margin-left: -40px;" styleClass="Fleft" library="sentinel-layout"/>
                                </a>
                            </div>
                        </div>

                        <h:form   id="loginForm" prependId="false" onkeypress="if (event.keyCode == 13) {
                                    document.getElementById('submitButton').click();
                                    $('#submitButton').attr('disabled', true);
                                    return false;
                                }"  >
                            <h:inputHidden id="x" value="#{LoginBean.latitude}" />
                            <h:inputHidden id="y" value="#{LoginBean.longitude}" />
                            <div class="Container90 Fnone MarAuto TexAlCenter TabContent OvHidden" id="TAB1">
                                <div class="EmptyBox30"></div>


                                <p:inputText id="j_username" tabindex="1" style="margin-top: -80px;"  value="#{LoginBean.username}" required="true" requiredMessage="Kullanıcı Alanı Boş Bırakılamaz."  placeholder="Username" styleClass="Container80 Fnone MarAuto Fs18 txtLogin">

                                </p:inputText>
                                <p:focus for="j_username"/>
                               
                                <div class="EmptyBox10"></div>

                                <p:password  id="j_password" tabindex="2" value="#{LoginBean.password}" required="true" requiredMessage="#{LoginBean.language_isTR ? 'Şifre Alanı Boş Bırakılamaz.' : 'The Password field can not be left blank.'}" placeholder="Password" styleClass="Container80 Fnone MarAuto Fs18 pwdLogin" feedback="false"/>  
                                <div class="EmptyBox10"></div>

                                <h:graphicImage id="CaptchaImgID" value="/simpleCaptcha.png" style="margin-left: 32px !important;width: 40%;height: 43px; border: 1px solid #c9c8c8 !important;" styleClass="Fleft FontBold" />
                                <p:commandLink id="resfreshCaptcha" title="#{LoginBean.language_isTR ? 'Yenile' : 'Refresh'}"  onclick="refreshCpt()" >
                                    <i class="fa fa-refresh Fs20" style="margin-top: 10px !important;margin-bottom: 10px !important;"></i> 
                                </p:commandLink>
                                <p:inputText id="CaptchaID" tabindex="3"
                                             required="true"  
                                             requiredMessage="#{LoginBean.language_isTR ? 'Doğrulama Kodunu Giriniz!' : 'Enter The Verification Code!'}"
                                             value="#{LoginBean.captchaValue}"
                                             style="width: 30%;height: 23px;margin-right: 32px !important;"
                                             styleClass="Container80 Fnone MarAuto Fs18 txtLogin"
                                             placeholder="Enter The Code"
                                             >
                                </p:inputText>
                                
                             
                                <div class="EmptyBox10"></div>
                              

                                <center>
                                    <h:panelGrid id="grid">
                                        <p:captcha language="tr" id="ctch" label="Captcha" rendered="#{LoginBean.isCaptchaSolved}"  />
                                    </h:panelGrid>
                                </center>
                                <div class="EmptyBox10"></div>
                                <p:commandButton id="submitButton"  update="grid" oncomplete="enableButton();"   value="Log In" styleClass="Fs16 btnLogin" onclick="getVars()"  action="#{LoginBean.login}"/> 
                                <p:growl autoUpdate="true" />
                                <p:blockUI trigger="submitButton" block="submitButton" />  
                                <div class="EmptyBox40"></div>
                            </div>
                            <p:blockUI trigger="submitButton" block="box" />

                            <p:remoteCommand name="enableButton" onstart="$('#submitButton').attr('disabled', false);" delay="1000"/>
                        </h:form>  




                        <div class="Wid100 TexAlCenter Fs14 FontBold MarBot10" style="color: #3fa3db;">v 1.3.9</div>
                    </div>


                </p:panel>
            </div>
            <div class="Container80 MaxWid500 Fnone MarAuto" role="1" style="margin-top: -20px" >                        
                <div class="Container80 Fnone MarAuto FontBold">
                    <div class="marwizLogo">    
                        <h:graphicImage name="images/stawiz_logo_login.png" style="height: 23px;margin-top: 2px;" library="sentinel-layout"/>                                
                    </div>
                </div>

            </div>
        </div>        
        <!-- LOGIN BOX COVER END -->

        <script type="text/javascript">

            function getVars() {
                // ...          
                document.getElementById("x").value = latitude;
                document.getElementById("y").value = longitude;
            }

            var apiGeolocationSuccess = function (position) {

                latitude = position.coords.latitude;
                longitude = position.coords.longitude;
                //   alert("API geolocation success!\n\nlat = " + latitude + "\nlng = " + position.coords.longitude);
                // sendLatLng([{name: 'latitude', value: latitude}, {name: 'longitude', value: longitude}])
            };

            var tryAPIGeolocation = function () {
                jQuery.post("https://www.googleapis.com/geolocation/v1/geolocate?key=AIzaSyBBCAwnVo4Q-zf9Bzt_J4XMHFH8HQz-dnk", function (success) {
                    apiGeolocationSuccess({coords: {latitude: success.location.lat, longitude: success.location.lng}});
                })
                        .fail(function (err) {
                            console.log("API Geolocation error! \n\n" + err);
                        });
            };

            var browserGeolocationSuccess = function (position) {
                latitude = position.coords.latitude;
                longitude = position.coords.longitude;
                //    alert("Browser geolocation success!\n\nlat = " + latitude + "\nlng = " + longitude);

                //  sendLatLng([{name: 'latitude', value: latitude}, {name: 'longitude', value: longitude}])
            };

            var browserGeolocationFail = function (error) {
                switch (error.code) {
                    case error.TIMEOUT:
                        console.log("Browser geolocation error !\n\nTimeout.");
                        break;
                    case error.PERMISSION_DENIED:
                        if (error.message.indexOf("Only secure origins are allowed") == 0) {
                            tryAPIGeolocation();
                        }
                        break;
                    case error.POSITION_UNAVAILABLE:
                        console.log("Browser geolocation error !\n\nPosition unavailable.");
                        break;
                }
            };

            var tryGeolocation = function () {
                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(
                            browserGeolocationSuccess,
                            browserGeolocationFail,
                            {maximumAge: 50000, timeout: 20000, enableHighAccuracy: true});
                }
            };

            tryGeolocation();


            $(function () {
                var loginButtons = $('#login-buttons');
                var loginBox = $('#login-box');
                if (loginBox.length) {
                    var tabHeaders = loginButtons.find('.TabBtn'),
                            tabContents = loginBox.find('.TabContent');

                    tabHeaders.on('click', function (e) {
                        tabHeaders.removeClass('TabBtnActiveLeft TabBtnActiveRight');
                        tabContents.addClass('DispNone');

                        if ($(this).hasClass('qrCodeBtn')) {//karekod                            
                            setIsQr();
                            $(this).addClass('TabBtnActiveLeft');
                            $('#TAB' + $(this).attr('role')).removeClass('DispNone');
                        } else if ($(this).hasClass('loginBtn')) {//login                            
                            $(this).addClass('TabBtnActiveLeft');
                            $('#TAB' + $(this).attr('role')).removeClass('DispNone');
                        } else if ($(this).hasClass('passBtn')) {//şifre                            
                            $(this).addClass('TabBtnActiveLeft');
                            $('#TAB' + $(this).attr('role')).removeClass('DispNone');
                        }

                        e.preventDefault();

                    });
                }
            });



          function refreshCpt() {

                $.ajaxSetup({
                    cache: false
                });

                var timestamp = (new Date()).getTime();


                $("#resfreshCaptcha").click(function () {

                    var timestamp = (new Date()).getTime();
                    var newSrc = $("#CaptchaImgID").attr("src").split("?");
                    newSrc = newSrc[0] + "?" + timestamp;
                    $("#CaptchaImgID").attr("src", newSrc);
                    $("#CaptchaImgID").slideDown("fast");

                });
            };


        </script>





    </h:body>
</html>
