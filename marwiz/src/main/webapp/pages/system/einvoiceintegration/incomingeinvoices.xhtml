<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <ui:include src="/pages/general/common/datagridtoolbarreport.xhtml" >
        <ui:param name="bean" value="#{incomingEInvoicesBean}"/>
        <ui:param name="datatable" value="#{(eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or (eInvoiceIntegrationBean.operationType == 3 and eInvoiceIntegrationBean.archiveOperationType == 1) ? 'frmIncomingEInvoices:dtbIncomingEInvoicesInMarwiz' : 'frmIncomingEInvoices:dtbIncomingEInvoicesGIB'} " />
        <ui:param name="fileName" value="#{loc.einvoiceintegrationprocess}"/>
        <ui:param name="renderedToggler" value='true'/>
        <ui:param name="renderedExcel" value='false'/>
        <ui:param name="renderedPdf" value='false'/>
        <ui:param name="renderedPrint" value='false'/>
        <ui:param name="renderedAddArchive" value='#{eInvoiceIntegrationBean.operationType==2 or eInvoiceIntegrationBean.operationType==1}' />
        <ui:param name="renderedUnArchive" value='#{eInvoiceIntegrationBean.operationType==3}' />
    </ui:include>

    <h:form id="frmIncomingEInvoices">
        <h:panelGroup id="pngIncomingEInvoicesDatatable" >
            <h:panelGroup rendered="#{(eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or (eInvoiceIntegrationBean.operationType == 3 and eInvoiceIntegrationBean.archiveOperationType == 1)}" >


                <p:dataTable  id="dtbIncomingEInvoicesInMarwiz" widgetVar="ieimPF" var="ieInvoiceMarwiz" rowKey="#{ieInvoiceMarwiz.id}" value="#{incomingEInvoicesBean.listOfObjects}" selection="#{incomingEInvoicesBean.listOfSelectedObjects}"  emptyMessage="#{loc.norecordsfound}"
                              rows="#{sessionBean.user.defualtGridSize}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                              rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" reflow="true" lazy="true"  class="salaryPaymentDatatable"   >
                    <p:ajax event="page" global="false"/>
                    <p:ajax event="filter" global="false"/>
                    <p:ajax event="rowSelectCheckbox" global="false"  listener="#{incomingEInvoicesBean.rowSelect}"/>
                    <p:ajax event="rowUnselectCheckbox" global="false" listener="#{incomingEInvoicesBean.rowUnSelect}" />
                    <p:ajax event="rowSelect" global="false"  listener="#{incomingEInvoicesBean.rowSelect}" />
                    <p:ajax event="toggleSelect" global="false" listener="#{incomingEInvoicesBean.toggleSelect}"/>

                    <p:column selectionMode="multiple" style="width:26px; text-align:center;" selectRow="false"/>

                    <p:column id="clmTransactionDate" headerText="#{loc.einvoicecreationdate}"  sortBy="#{ieInvoiceMarwiz.lgei.gibdate}" sortable="true">               
                        <h:outputText value="#{ieInvoiceMarwiz.receivedDate}">
                            <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                        </h:outputText>
                    </p:column>
                    
                    
                    
                     <p:column id="clmInvoiceDate" headerText="#{loc.invoicedate}"  sortBy="#{ieInvoiceMarwiz.lgei.invoicedate}" sortable="true">               
                        <h:outputText value="#{ieInvoiceMarwiz.invoiceDate}">
                            <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                        </h:outputText>
                    </p:column>







                    <p:column id="clmDocumentNo" headerText="#{loc.documentnumber}" sortBy="#{ieInvoiceMarwiz.lgei.gibinvoice}" sortable="true" >
                        <h:outputText value="#{ieInvoiceMarwiz.documentNumber}"/>
                    </p:column> 
                    <p:column id="clmAccountName" headerText="#{loc.currentname}"  >
                        <h:outputText value="#{ieInvoiceMarwiz.account.title}"/>
                    </p:column>

                    <p:column id="clmTaxNo" headerText="#{loc.taxno}" sortBy="#{ieInvoiceMarwiz.lgei.gibtaxno}" sortable="true" >
                        <h:outputText value="#{ieInvoiceMarwiz.account.taxNo}"/>
                    </p:column>

                    <p:column id="clmTotalPrice" headerText="#{loc.totalprice}"  >
                        <h:outputText  style="float:right;" value="#{ieInvoiceMarwiz.totalMoney}" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{ieInvoiceMarwiz.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>

                    <p:column id="clmType" headerText="#{loc.type}"  >
                        <h:outputText value="#{ieInvoiceMarwiz.type.tag}" />
                    </p:column>

                    <p:column id="clmScenarioType" headerText="#{loc.invoicescenario}"   >
                        <h:outputText value="#{ieInvoiceMarwiz.invoiceScenarioId== 1 ? loc.basicinvoice : loc.commercialinvoice}" />
                    </p:column>

                    <p:column id="clmApprovalStatus" headerText="#{loc.approvalstatus}"   >
                        <h:outputText value="#{ ieInvoiceMarwiz.approvalStatusId == 1 ?  loc.waitingforapproval :  ieInvoiceMarwiz.approvalStatusId == 2 ? loc.approved : ieInvoiceMarwiz.approvalStatusId == 3 ? loc.rejected : loc.noapprovalrequired }" />
                    </p:column>

                    <p:column id="clmDetail" style="text-align: center !important; width: 80px;" headerText="#{loc.detail}" >
                        <p:commandLink title="#{loc.detail}" action="#{incomingEInvoicesBean.goToInvoiceDetail()}" resetValues="true" update="dlgEInvoiceItem , pngAccountBook">
                            <i class="fa fa-search Fs16"/>  
                            <f:setPropertyActionListener value="#{ieInvoiceMarwiz}"  target="#{incomingEInvoicesBean.selectedObject}"  />
                        </p:commandLink> 
                    </p:column>

                    <p:column id="clmSave" style="text-align: center !important; width: 80px;" headerText="#{loc.save}"  >
                        <p:commandLink title="#{loc.save}" action="#{incomingEInvoicesBean.goToSave()}" resetValues="true" update="dlgEInvoiceItem" >
                            <i class="fa fa-pencil-square-o Fs16" style="color: #dc3a3a"/>   
                            <f:setPropertyActionListener value="#{ieInvoiceMarwiz}"  target="#{incomingEInvoicesBean.selectedObject}"  />
                        </p:commandLink> 
                    </p:column>

                </p:dataTable>


            </h:panelGroup>      

            <h:panelGroup rendered="#{eInvoiceIntegrationBean.invoiceSourceType == 2 and eInvoiceIntegrationBean.operationType == 1}" >


                <p:dataTable  id="dtbIncomingEInvoicesGIB" widgetVar="ieigibPF" var="ieInvoiceGib" rowKey="#{ieInvoiceGib.id}" value="#{incomingEInvoicesBean.listGibInvoices}" selection="#{incomingEInvoicesBean.listOfSelectedObjects}"  emptyMessage="#{loc.norecordsfound}"
                              rows="#{sessionBean.user.defualtGridSize}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                              rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" reflow="true" class="salaryPaymentDatatable" >

                    <p:ajax event="page" global="false"/>
                    <p:ajax event="filter" global="false"/>
                    <p:ajax event="rowSelectCheckbox" global="false"  />
                    <p:ajax event="rowUnselectCheckbox" global="false" />
                    <p:ajax event="rowSelect" global="false"   />
                    <p:ajax event="toggleSelect" global="false" />

                    <p:column selectionMode="multiple" style="width:26px; text-align:center;" selectRow="false"/>



                    <p:column id="clmTransactionDate" headerText="#{loc.einvoicecreationdate}"  >               
                        <h:outputText value="#{ieInvoiceGib.receivedDate}">
                            <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                        </h:outputText>
                    </p:column>

                    <p:column id="clmInvoiceDate" headerText="#{loc.invoicedate}" >               
                        <h:outputText value="#{ieInvoiceGib.invoiceDate}">
                            <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                        </h:outputText>
                    </p:column>



                    <p:column id="clmDocumentNo" headerText="#{loc.documentnumber}"  >
                        <h:outputText value="#{ieInvoiceGib.documentNumber}"/>
                    </p:column> 
                    <p:column id="clmAccountName" headerText="#{loc.currentname}"  >
                        <h:outputText value="#{ieInvoiceGib.account.title}"/>
                    </p:column>

                    <p:column id="clmTaxNo" headerText="#{loc.taxno}"  >
                        <h:outputText value="#{ieInvoiceGib.account.taxNo}"/>
                    </p:column>

                    <p:column id="clmTotalPrice" headerText="#{loc.totalprice}"  >
                        <h:outputText  style="float:right;" value="#{ieInvoiceGib.totalMoney}" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{ieInvoiceGib.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>

                    <p:column id="clmType" headerText="#{loc.type}"  >
                        <h:outputText value="#{ieInvoiceGib.type.tag}" />
                    </p:column>

                    <p:column id="clmScenarioType" headerText="#{loc.invoicescenario}"   >
                        <h:outputText value="#{ieInvoiceGib.invoiceScenarioId== 1 ? loc.basicinvoice : loc.commercialinvoice}" />
                    </p:column>

                    <p:column id="clmApprovalStatus" headerText="#{loc.approvalstatus}"   >
                        <h:outputText value="#{ ieInvoiceGib.approvalStatusId == 1 ?  loc.waitingforapproval :  ieInvoiceGib.approvalStatusId == 2 ? loc.approved : ieInvoiceGib.approvalStatusId == 3 ? loc.rejected : loc.noapprovalrequired }" />
                    </p:column>

                    <p:column id="clmDetail" style="text-align: center !important; width: 80px;" headerText="#{loc.detail}" >
                        <p:commandLink title="#{loc.detail}" action="#{incomingEInvoicesBean.goToInvoiceDetail()}" resetValues="true" update="dlgEInvoiceItem , pngAccountBook">
                            <i class="fa fa-search Fs16"/>  
                            <f:setPropertyActionListener value="#{ieInvoiceGib}"  target="#{incomingEInvoicesBean.selectedObject}"  />
                        </p:commandLink> 
                    </p:column>

                    <p:column id="clmSave" style="text-align: center !important; width: 80px;" headerText="#{loc.save}"  >
                        <p:commandLink title="#{loc.save}" action="#{incomingEInvoicesBean.goToSave()}" resetValues="true" update="dlgEInvoiceItem" >
                            <i class="fa fa-pencil-square-o Fs16" style="color: #dc3a3a"/>   
                            <f:setPropertyActionListener value="#{ieInvoiceGib}"  target="#{incomingEInvoicesBean.selectedObject}"  />
                        </p:commandLink> 
                    </p:column>

                </p:dataTable>


            </h:panelGroup>   
        </h:panelGroup>
    </h:form>


    <p:dialog  id="dlgEInvoiceItem" widgetVar="dlg_EInvoiceItem" style="max-height: 85%; overflow-y: auto;" width="70%"  resizable="false"  focus="dlgEInvoiceItem" dynamic="true"  responsive="true"  modal="true" closeOnEscape="true">
        <ui:include src="incomingeinvoiceitem.xhtml"/>
        <p:ajax event="close" listener="#{incomingEInvoicesBean.updateObj()}"  update="#{eInvoiceIntegrationBean.invoiceSourceType == 1 ? 'frmIncomingEInvoices:dtbIncomingEInvoicesInMarwiz' : 'frmIncomingEInvoices:dtbIncomingEInvoicesGIB'}"/>
    </p:dialog>

    <p:dialog  id="dlgStockUnit" widgetVar="dlg_StockUnit" style="max-height: 50%; overflow-y: auto;" width="20%"  resizable="false" transient="true" focus="dlgStockUnit" dynamic="true"  responsive="true"  modal="true" closeOnEscape="true">
        <ui:include src="incomingeinvoicestockunitprocess.xhtml"/>
    </p:dialog>

    <p:dialog  id="dlgAccount" widgetVar="dlg_Account" style="max-height: 80%; overflow-y: auto;" width="20%"  resizable="false" transient="true" focus="dlgAccount" dynamic="true"  responsive="true"  modal="true" closeOnEscape="true">
        <ui:include src="incomingeinvoiceaccountmatch.xhtml"/>
    </p:dialog>

    <p:dialog  id="dlgStock" widgetVar="dlg_Stock" style="max-height: 80%; overflow-y: auto;" width="#{incomingEInvoicesBean.selectedObject.isFuel ? '50%' : '20%'}"  resizable="false" transient="true" focus="dlgStock" dynamic="true"  responsive="true"  modal="true" closeOnEscape="true">
        <ui:include src="incomingeinvoicestockmatch.xhtml"/>
    </p:dialog>

    <p:dialog  id="dlgApproval" widgetVar="dlg_Approval" style="max-height: 80%; overflow-y: auto;" width="20%"  resizable="false" transient="true" focus="dlgApproval" dynamic="true"  responsive="true"  modal="true" closeOnEscape="true">
        <ui:include src="incominginvoiceapprovalprocess.xhtml"/>
        <p:ajax event="close" listener="#{incomingEInvoicesBean.closeEvent()}"  />
    </p:dialog>


    <!-- birim içerik adedi eklemek için açılan dialog-->
    <p:dialog id="dlgStockEInvoiceUnitConProc" widgetVar="dlg_stockeinvoiceunitconproc" modal="true" resizable="false" width="35%" focus="dlgStockEInvoiceUnitConProc" responsive="true" dynamic="true" closeOnEscape="true">
        <ui:include src="stockeinvoiceunitconprocess.xhtml">
        </ui:include>

    </p:dialog>

    <p:confirmDialog id="dlgConfirm" global="true"  class="deleteConfirm MaxWid500" widgetVar="dlg_Confirm" showEffect="fade" hideEffect="fade"  closeOnEscape="true" responsive="true">
        <f:facet name="message">
            <h:outputText value="#{incomingEInvoicesBean.approvalMessage}"  style="white-space: pre-wrap;">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
        </f:facet>
        <p:commandButton value="#{loc.yes}" action="#{incomingEInvoicesBean.approvalResponseYes()}" async="true" update="grwProcessMessage dlgApproval"  onclick="PF('dlg_Confirm').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
        <p:commandButton value="#{loc.no}"  action="#{incomingEInvoicesBean.approvalResponseNo()}" onclick="PF('dlg_Confirm').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>


    <p:confirmDialog id="dlgConfirmApproval" global="true" closable="false" class="deleteConfirm MaxWid500" widgetVar="dlg_ConfirmApproval" showEffect="fade" hideEffect="fade"  closeOnEscape="false" responsive="true">
        <f:facet name="message">
            <h:outputText value="#{incomingEInvoicesBean.approvalMessage}"  style="white-space: pre-wrap;">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
        </f:facet>
        <p:commandButton value="#{loc.yes}" action="#{incomingEInvoicesBean.appResponseYes()}" async="true" update="grwProcessMessage dlgApproval"  onclick="PF('dlg_ConfirmApproval').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
        <p:commandButton value="#{loc.no}"  action="#{incomingEInvoicesBean.appResponseNo()}" onclick="PF('dlg_ConfirmApproval').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>

    <p:confirmDialog id="dlgConfirmOK" global="true"  class="deleteConfirm MaxWid500" widgetVar="dlg_ConfirmOK" showEffect="fade" hideEffect="fade"  closeOnEscape="true" responsive="true">
        <f:facet name="message">
            <h:outputText value="#{incomingEInvoicesBean.approvalMessage}"  style="white-space: pre-wrap;">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
        </f:facet>
        <p:commandButton value="#{loc.okey}"  async="true"  action="#{incomingEInvoicesBean.noApprovalResponse()}"  update="grwProcessMessage dlgApproval"  onclick="PF('dlg_ConfirmOK').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
    </p:confirmDialog>


    <p:confirmDialog id="dlgConfirmFuel" global="true" closable="false" class="deleteConfirm MaxWid500" widgetVar="dlg_ConfirmFuel" showEffect="fade" hideEffect="fade"  closeOnEscape="false" responsive="true">
        <f:facet name="message">
            <h:outputText value="#{loc.sincethefuelbillselectionhaschangedproductmatcheswillbemadeagain} #{loc.areyousureyouwanttocontinue}"  style="white-space: pre-wrap;">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
        </f:facet>
        <p:commandButton value="#{loc.yes}" action="#{incomingEInvoicesBean.fuelResponseYes()}" async="true" update="grwProcessMessage"  onclick="PF('dlg_ConfirmFuel').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
        <p:commandButton value="#{loc.no}"  action="#{incomingEInvoicesBean.fuelResponseNo()}" onclick="PF('dlg_ConfirmFuel').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>


</ui:composition>