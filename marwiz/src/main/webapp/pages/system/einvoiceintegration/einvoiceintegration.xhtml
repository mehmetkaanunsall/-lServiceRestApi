<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <h:form id="frmEInvoiceIntegration">


        <ui:include src="/pages/general/common/processtoolbar.xhtml" >
            <ui:param name="outputtext" value="#{loc.einvoiceintegrationprocess}"/>
            <ui:param name="bean" value='#{eInvoiceIntegrationBean}' />
            <ui:param name="update" value=" pgEInvoiceIntegration pgrEInvoiceIntegrationDatatable pgrIncomingInvoicesDatatable" />
            <ui:param name="renderedFindReport" value='#{eInvoiceIntegrationBean.operationType==2 or (eInvoiceIntegrationBean.operationType==1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or eInvoiceIntegrationBean.operationType==3}' />
        </ui:include>



        <h:panelGroup id="pgEInvoiceIntegration" class="divContent" layout="block" >  
            <div class="panelToggle  ui-g">

                <div class="ui-g-12  ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.operationtype}" for="slcEntryExit1" styleClass="Fs12 FontBold"/>
                    <p:selectOneMenu id="slcEntryExit1" value="#{eInvoiceIntegrationBean.operationType}" >
                        <f:selectItem itemValue="1" itemLabel="#{loc.incominginvoices}"  />
                        <f:selectItem itemValue="2" itemLabel="#{loc.outgoinginvoices}"  />
                        <f:selectItem itemValue="3" itemLabel="#{loc.archive}"  />
                        <p:ajax event="change" listener="#{eInvoiceIntegrationBean.changeOperationType}" update=" pgEInvoiceIntegration frmEInvoiceIntegration pgrEInvoiceIntegrationDatatable pgrIncomingInvoicesDatatable "    />
                    </p:selectOneMenu>
                </div>

                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType==3}" >
                    <div class="ui-g-12  ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.invoicetype}" for="slcEntryExit1" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcEntryExit3" value="#{eInvoiceIntegrationBean.archiveOperationType}" >  
                            <f:selectItem itemValue="1" itemLabel="#{loc.incominginvoices}"  />
                            <f:selectItem itemValue="2" itemLabel="#{loc.outgoinginvoices}"  />
                            <p:ajax event="change" listener="#{eInvoiceIntegrationBean.changeOperationType}" update=" pgEInvoiceIntegration frmEInvoiceIntegration pgrEInvoiceIntegrationDatatable pgrIncomingInvoicesDatatable "    />
                        </p:selectOneMenu>
                    </div>
                </h:panelGroup>


                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType==1}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.invoicesource}" for="slcEntryExit2" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcEntryExit2" value="#{eInvoiceIntegrationBean.invoiceSourceType}" >
                            <f:selectItem itemValue="1" itemLabel="#{loc.currenteinvoicesinthemarwizsystem}"  />
                            <f:selectItem itemValue="2" itemLabel="#{loc.newincomingeinvoicesingibsystem}"  />
                            <p:ajax event="change"  listener="#{incomingEInvoicesBean.changeInvoiceSource}" update="frmEInvoiceIntegration pgEInvoiceIntegration pgrIncomingInvoicesDatatable"  />
                        </p:selectOneMenu>
                    </div>
                </h:panelGroup>


                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType==2 or (eInvoiceIntegrationBean.operationType==3 and eInvoiceIntegrationBean.archiveOperationType ==2)}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{eInvoiceIntegrationBean.operationType==2 ? loc.invoicetype : loc.einvoicetype}" for="slcEntryExit" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcEntryExit" value="#{eInvoiceIntegrationBean.processType}" >
                            <f:selectItem itemValue="1" itemLabel="#{loc.einvoice}"  />
                            <f:selectItem itemValue="2" itemLabel="#{loc.earchive}"  />
                            <p:ajax event="change" update=" frmEInvoiceIntegration pgrEInvoiceIntegrationDatatable pgrIncomingInvoicesDatatable pgEInvoiceIntegration"  />
                        </p:selectOneMenu>
                    </div>
                </h:panelGroup>



                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType==2}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.startdate}" for="cldStartDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldStartDate" class="datepicker" value="#{eInvoiceIntegrationBean.beginDate}" required="true" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" timeControlType="select" showOn="button" showButtonPanel="true" placeholder="#{loc.startdate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                            <p:ajax event="change" update="cldStartDate" resetValues="true" global="false" />
                        </p:calendar>
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType==2}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.enddate}" for="cldEndDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldEndDate" class="datepicker" value="#{eInvoiceIntegrationBean.endDate}" required="true" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" timeControlType="select" showOn="button" showButtonPanel="true" placeholder="#{loc.enddate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                            <p:ajax event="change" update="cldEndDate" resetValues="true" global="false"/>
                        </p:calendar>
                    </div>
                </h:panelGroup>



                <h:panelGroup rendered="#{((eInvoiceIntegrationBean.operationType == 1 and sessionBean.getUser().getLastBranchSetting().geteInvoiceIntegrationTypeId() == 2 ) or ( sessionBean.getUser().getLastBranchSetting().geteInvoiceIntegrationTypeId() == 1 and eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1)) or eInvoiceIntegrationBean.operationType == 3}" >


                    <div class="ui-g-12 ui-md-6 ui-lg-2"> 
                        <p:outputLabel value="#{loc.startdate}" for="cldStartDate1" styleClass="Fs12 FontBold" />
                        <p:calendar  id="cldStartDate1" value="#{eInvoiceIntegrationBean.beginDate}" class="datepicker" timeControlType="select"  required="true" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" showOn="button" showButtonPanel="true" placeholder="#{loc.startdate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                            <p:ajax event="change" update="cldStartDate1" resetValues="true" global="false"/>
                        </p:calendar>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.enddate}" for="cldEndDate1" styleClass="Fs12 FontBold" />
                        <p:calendar  id="cldEndDate1" value="#{eInvoiceIntegrationBean.endDate}" class="datepicker" timeControlType="select" required="true" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" showOn="button" showButtonPanel="true" placeholder="#{loc.enddate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                            <p:ajax event="change" update="cldEndDate1" resetValues="true" global="false"/>
                        </p:calendar>
                    </div>

                </h:panelGroup>

                <h:panelGroup rendered="#{(((eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or (eInvoiceIntegrationBean.operationType == 3 and eInvoiceIntegrationBean.archiveOperationType == 1) and sessionBean.getUser().getLastBranchSetting().geteInvoiceIntegrationTypeId() == 2 ) or ( sessionBean.getUser().getLastBranchSetting().geteInvoiceIntegrationTypeId() == 1 and (eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or (eInvoiceIntegrationBean.operationType == 3 and eInvoiceIntegrationBean.archiveOperationType == 1)))}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.datefiltertowhichonetoapply}" for="slcEntryExit" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcDate" value="#{eInvoiceIntegrationBean.dateFilterType}" >
                            <f:selectItem itemValue="1" itemLabel="#{loc.einvoicecreationdate}"  />
                            <f:selectItem itemValue="2" itemLabel="#{loc.invoicedate}"  />
                        </p:selectOneMenu>
                    </div>


                </h:panelGroup>




                <h:panelGroup rendered="#{(eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or eInvoiceIntegrationBean.operationType == 2 or eInvoiceIntegrationBean.operationType==3 }" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2" >
                        <p:outputLabel value="#{loc.invoiceno}" for="txtInvoiceNo" styleClass="Fs12 FontBold"  />
                        <p:inputText id="txtInvoiceNo" value="#{eInvoiceIntegrationBean.invoiceNo}"  placeholder="#{loc.invoiceno}" />
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{(eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 1) or eInvoiceIntegrationBean.operationType == 2 or eInvoiceIntegrationBean.operationType==3}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.current}" for="txtCustomer" styleClass="Fs12 FontBold"/>
                        <p:inputText  id="txtCustomer" onclick="showAccountBook()" value="#{accountBookCheckboxFilterBean.selectedCount}" class="inputPositionForBookFilter" readonly="#{facesContext.currentPhaseId.ordinal ge 4}" placeholder="#{loc.all}">   
                        </p:inputText>
                        <p:commandLink id="btnCustomer" process="@this" update="frmAccountBookFilterCheckbox" actionListener="#{eInvoiceIntegrationBean.openDialog()}" class="commandLinkPositionForBookFilter" oncomplete="PF('olp_accountcheckbox').loadContents();">
                            <i class="fa fa-book Fs16 iconPositionForBookFilter"></i>
                            <p:ajax listener="#{accountBookCheckboxFilterBean.findFilterListLazyLoading([sessionBean.user.lastBranch],'frmAccountBookFilterCheckbox','olp_accountcheckbox', 'eInvoiceCheckBox')}" />
                        </p:commandLink>
                    </div>
                </h:panelGroup>


                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType == 2 or (eInvoiceIntegrationBean.operationType==3 and eInvoiceIntegrationBean.archiveOperationType ==2)}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2" >                   
                        <p:panelGrid id="pnrSend" layout="grid" columns="1" class="pngCheckBoxReport"  >
                            <p:triStateCheckbox itemLabel="#{loc.sent}" value="#{eInvoiceIntegrationBean.isSend}"/>
                        </p:panelGrid>
                    </div> 
                </h:panelGroup>


                <h:panelGroup rendered="#{eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.invoiceSourceType == 2}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:commandButton id="btnInvoiceDownload"   actionListener="#{eInvoiceIntegrationBean.incomingInvoices}"  process="@form" value="#{loc.invoicedownload}" class="bottom"  style="width: 120px; margin-top: 8%" update="pgrIncomingInvoicesDatatable" />   
                    </div>
                </h:panelGroup>

            </div>
        </h:panelGroup>

        <p:remoteCommand name="showAccountBook" process="@this" update="frmAccountBookFilterCheckbox" oncomplete="PF('olp_accountcheckbox').loadContents();" action="#{eInvoiceIntegrationBean.openDialog()}" actionListener="#{accountBookCheckboxFilterBean.findFilterListLazyLoading([sessionBean.user.lastBranch],'frmAccountBookFilterCheckbox','olp_accountcheckbox','eInvoiceCheckBox')}" />


    </h:form>

    <div class="EmptyBox20" />


    <h:panelGroup id="pgrEInvoiceIntegrationDatatable" >

        <c:if test="#{(eInvoiceIntegrationBean.operationType==2 or (eInvoiceIntegrationBean.operationType == 3 and eInvoiceIntegrationBean.archiveOperationType == 2)) and eInvoiceIntegrationBean.isFind and sessionBean.user.lastBranchSetting.isEInvoice}">
            <ui:include src="/pages/general/common/datagridtoolbarreport.xhtml" >
                <ui:param name="bean" value="#{eInvoiceIntegrationBean}"/>
                <ui:param name="datatable" value="frmEInvoiceIntegrationDatatable:dtbEInvoiceIntegration" />
                <ui:param name="fileName" value="#{loc.einvoiceintegrationprocess}"/>
                <ui:param name="renderedToggler" value='true'/>
                <ui:param name="renderedExcel" value='false'/>
                <ui:param name="renderedPdf" value='false'/>
                <ui:param name="renderedPrint" value='false'/>
                <ui:param name="renderedIntegration" value="#{eInvoiceIntegrationBean.isSend != '1'}"/>
                <ui:param name="renderedStatus" value="#{eInvoiceIntegrationBean.operationType == 2 or eInvoiceIntegrationBean.operationType == 3}"/>
                <ui:param name="renderedAddArchive" value='#{eInvoiceIntegrationBean.operationType==2 or eInvoiceIntegrationBean.operationType==1}' />
                <ui:param name="renderedUnArchive" value='#{eInvoiceIntegrationBean.operationType==3}' />
            </ui:include>


            <h:form id="frmEInvoiceIntegrationDatatable" >

                <p:dataTable  id="dtbEInvoiceIntegration"  var="eInvoice"  value="#{eInvoiceIntegrationBean.listOfObject}" selection="#{eInvoiceIntegrationBean.listOfSelectedObjects}"  widgetVar="eInvoicePF" emptyMessage="#{loc.norecordsfound}"
                              rows="#{sessionBean.user.defualtGridSize}" rowKey="#{eInvoice.id}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                              rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" rowSelectMode="add"
                              class="salaryPaymentDatatable" >
                    <p:ajax event="page" global="false"/>
                    <p:ajax event="filter" global="false"/>
                    <p:ajax event="rowSelectCheckbox" global="false" update="dtbEInvoiceIntegration" listener="#{eInvoiceIntegrationBean.rowSelect}"/>
                    <p:ajax event="rowUnselectCheckbox" global="false"  />
                    <p:ajax event="rowSelect" global="false" update="dtbEInvoiceIntegration" listener="#{eInvoiceIntegrationBean.rowSelect}" />
                    <p:ajax event="toggleSelect" global="false" />


                    <p:column selectionMode="multiple" style="width:26px; text-align:center;"  >
                    </p:column>

                    <p:column id="clmTransactionDate"  headerText="#{loc.invoicedate}" sortable="true" sortBy="#{eInvoice.invoiceDate}" rendered="#{eInvoiceIntegrationBean.operationType != 3}" >               
                        <h:outputText value="#{eInvoice.invoiceDate}"  >
                            <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                        </h:outputText>

                        <p:commandLink class="Fright" delay="300" rendered="#{eInvoice.sendEInvoice.isSend and eInvoiceIntegrationBean.operationType != 3}" title="#{loc.putintoanarchive}" action="#{eInvoiceIntegrationBean.addArchiveRecord()}" process="@this" resetValues="true" >
                            <i class="fa fa-archive Fs15 tlbrUploadBtn MarRight5 Fright" style="margin-top: 5px;" />    
                            <f:setPropertyActionListener value="#{eInvoice}"  target="#{eInvoiceIntegrationBean.selectedObject}"  />
                            <p:ajax />
                        </p:commandLink>

                    </p:column>

                    <p:column id="clmTransactionDate1" headerText="#{loc.invoicedate}" rendered="#{eInvoiceIntegrationBean.operationType == 3}" sortable="true" sortBy="#{eInvoice.invoiceDate}" >               
                        <h:outputText value="#{eInvoice.invoiceDate}"  >
                            <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                        </h:outputText>



                        <p:commandLink class="Fright" delay="300" rendered="#{eInvoice.sendEInvoice.isSend and eInvoiceIntegrationBean.operationType == 3}" title="#{loc.unarchive}" action="#{eInvoiceIntegrationBean.unArchiveRecord()}" process="@this" resetValues="true" >
                            <i class="fa fa-undo Fs15 tlbrUploadBtn MarRight5 Fright" style="margin-top: 5px;" /> 
                            <f:setPropertyActionListener value="#{eInvoice}"  target="#{eInvoiceIntegrationBean.selectedInvoice}"  />
                            <p:ajax />
                        </p:commandLink>

                    </p:column>

                    <p:column id="clmDocumentNo" headerText="#{loc.documentnumber}" sortable="true" sortBy="#{eInvoice.documentSerial}#{eInvoice.documentNumber}" >
                        <h:outputText value="#{eInvoice.documentSerial}#{eInvoice.documentNumber}"/>
                    </p:column>

                    <p:column id="clmCurrentName" headerText="#{loc.currentname}"  sortable="true" sortBy="#{eInvoice.account.name}" >
                        <h:outputText value="#{eInvoice.account.name}" />
                    </p:column>

                    <p:column id="clmTaxNo" headerText="#{loc.taxno}"  sortable="true" sortBy="#{eInvoice.account.taxNo}" >
                        <h:outputText value="#{eInvoice.account.taxNo}" />
                    </p:column>

                    <p:column id="clmTotalPrice" headerText="#{loc.totalprice}" sortable="true" sortBy="#{eInvoice.totalMoney}"  >
                        <h:outputText  style="float:right;" value="#{eInvoice.totalMoney}" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{eInvoice.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>

                    <p:column id="clmType" headerText="#{loc.type}" sortable="true" sortBy="#{eInvoice.type.tag}"  >
                        <h:outputText value="#{eInvoice.type.tag}" />
                    </p:column>

                    <p:column id="clmSend" headerText="#{loc.sent}" class="TexAlCenter" sortable="true" sortBy="#{eInvoice.sendEInvoice.isSend}">
                        <p:commandLink global="false" class="MarLeft-5" >
                            <i class="Fs16 #{eInvoice.sendEInvoice.isSend == true ? 'icon-ok green' :'icon-cancel red' } "/>  
                        </p:commandLink>
                    </p:column>

                    <p:column id="clmSendDescription"    headerText="#{loc.shippingdescription}" sortable="true" sortBy="#{eInvoice.sendEInvoice.responseDescription}">
                        <h:outputText value="#{eInvoice.sendEInvoice.responseDescription}" />
                    </p:column>

                    <p:column id="clmSendStatus"    headerText="#{loc.shippingstatus}" >
                        <h:outputText rendered="#{sessionBean.lastBranchSetting.eInvoiceIntegrationTypeId==2}" value="#{eInvoice.sendEInvoice.invoiceStatus == 1000 ? loc.approved : eInvoice.sendEInvoice.invoiceStatus == 1100 ? loc.waitingforapproval : eInvoice.sendEInvoice.invoiceStatus == 1200 ? loc.rejected : eInvoice.sendEInvoice.invoiceStatus == 1300 ? loc.canceled : eInvoice.sendEInvoice.invoiceStatus == 1400 ? loc.earchivecancellation : eInvoice.sendEInvoice.invoiceStatus == 2000 ? loc.error : eInvoice.sendEInvoice.invoiceStatus == 300 ? loc.senttoIOP : eInvoice.sendEInvoice.invoiceStatus == 200 ? loc.intheprocess : eInvoice.sendEInvoice.invoiceStatus == 100 ? loc.inthequeue : eInvoice.sendEInvoice.invoiceStatus == 10 ? loc.canceled  : ' ' }" />
                        <h:outputText rendered="#{sessionBean.lastBranchSetting.eInvoiceIntegrationTypeId==1}" value="#{eInvoice.sendEInvoice.invoiceStatus == 1 ? loc.error : eInvoice.sendEInvoice.invoiceStatus == 2 ? loc.processing : eInvoice.sendEInvoice.invoiceStatus == 3 ? loc.completed : eInvoice.sendEInvoice.invoiceStatus == 4 ? loc.pendingreply : eInvoice.sendEInvoice.invoiceStatus == 5 ? loc.accepted : eInvoice.sendEInvoice.invoiceStatus == 6 ? loc.rejected : ' '}" />
                    </p:column>

                    <p:column id="clmInvoiceNumber"    headerText="#{loc.invoiceno}"  sortable="true" sortBy="#{eInvoice.sendEInvoice.gibInvoice}">
                        <h:outputText value="#{eInvoice.sendEInvoice.gibInvoice}" />
                    </p:column>
                </p:dataTable>  
            </h:form>
        </c:if>

        <h:panelGroup id="pgrIncomingInvoicesDatatable" >
            <c:if test="#{(eInvoiceIntegrationBean.operationType == 3 and eInvoiceIntegrationBean.archiveOperationType == 1 ) or (eInvoiceIntegrationBean.operationType == 1 and eInvoiceIntegrationBean.isIncomingEInvoices) and sessionBean.user.lastBranchSetting.isEInvoice}" >
                <ui:include src="incomingeinvoices.xhtml"/> 
            </c:if>
        </h:panelGroup>

    </h:panelGroup>

    <p:growl id="grwEInvoiceProcessMessage" showDetail="true" globalOnly="true" life="10000"/> 

    <!--Kitaptan cari seçtirmek için açılan overlay panel-->
    <ui:include src="/pages/general/common/accountbookcheckbox.xhtml" >
        <ui:param name="updateBean" value='#{eInvoiceIntegrationBean}' />
        <ui:param name="for" value='frmEInvoiceIntegration:btnCustomer' />
        <ui:param name="type" value='eInvoiceCheckBox' />
        <ui:param name="parameters" value='#{[sessionBean.user.lastBranch]}' /> 
        <ui:param name="columnsize" value='3' /> 
        <ui:param name="form" value='frmAccountBookFilterCheckbox' /> 
        <ui:param name="overlay" value="olp_accountcheckbox" />
    </ui:include>




</ui:composition>