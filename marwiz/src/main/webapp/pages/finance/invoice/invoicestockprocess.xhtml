<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">


    <h:form id="frmInvoiceStokProcess">
        <ui:include src="/pages/general/common/processtoolbar.xhtml" >
            <ui:param name="outputtext" value="#{loc.stockprocess} #{invoiceItemTabBean.isCreateInvFromOrder== true ? '/' : ''} #{invoiceItemTabBean.isCreateInvFromOrder== true ? loc.remainingamount : '' } #{invoiceItemTabBean.isCreateInvFromOrder== true ? ':' : ''} #{invoiceItemTabBean.isCreateInvFromOrder== true ? invoiceItemTabBean.selectedObject.remainingQuantity : ''} #{invoiceItemTabBean.isCreateInvFromOrder== true ? invoiceItemTabBean.selectedObject.stock.unit.sortName : ''}"/>
            <ui:param name="bean" value='#{invoiceItemTabBean}' />
            <ui:param name="update" value="grdInvoiceStokProcess" />
            <ui:param name="btnSaveId" value="#{invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and invoiceItemTabBean.isCreateInvFromCustomerAgreement and (invoiceItemTabBean.processType==1 ? invoiceItemTabBean.getRendered(6, 0) : invoiceItemTabBean.getRendered(324, 0)) and invoiceItemTabBean.isUpdate ?
                                                sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1 ?
                                                (invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.selectedInvoice.isPurchase) ?   (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill or (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill and invoiceItemTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoiceItemTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}" />      
                                                             <!--<ui:param name="btnSaveId" value="#{invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and invoiceItemTabBean.isCreateInvFromCustomerAgreement and invoiceItemTabBean.isUpdate and (invoiceItemTabBean.processType==1 ? invoiceItemTabBean.getRendered(6, 0) : invoiceItemTabBean.getRendered(324, 0))}" />  --> 
            <ui:param name="btnDeleteId" value='false' />
            <ui:param name="pageId" value="340"/>      
            <ui:param name="privateTest" value="true"/>
            <ui:param name="btnDeleteId" value="#{invoiceItemTabBean.processType==2 and invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceItemTabBean.selectedInvoice.isPeriodInvoice and invoiceItemTabBean.getRendered(7, 0) and invoiceItemTabBean.isUpdate ?
                                                  sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ?
                                                  (invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.selectedInvoice.isPurchase) ? (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill or (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill and invoiceItemTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoiceItemTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}" />
            <ui:param name="btnTestBeforeDeleteId" value="true"/>
        </ui:include>
        <h:panelGroup id="grdInvoiceStokProcess" layout="block" class="divContent">
            <div class="ui-g">

                <div class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.type}" for="slcType" styleClass="Fs12 FontBold"/>
                    <p:selectOneMenu id="slcType" required="true" class="Wid95" value="#{invoiceItemTabBean.selectedObject.isService}" >
                        <f:selectItem itemLabel="#{loc.product}" itemValue="false"  />
                        <f:selectItem itemLabel="#{loc.service}" itemValue="true"  />
                        <p:ajax event="change" update="pngStock" global="false" listener="#{invoiceItemTabBean.bringStockType()}" />
                    </p:selectOneMenu>
                </div>  

                <div class="#{invoiceItemTabBean.selectedInvoice.isFuel ? 'ui-g-12 ui-md-6 ui-lg-2' : 'ui-g-12 ui-md-6 ui-lg-3'}">

                    <h:panelGroup id="pngStock" >
                        <h:panelGroup rendered="#{!invoiceItemTabBean.selectedObject.isService}" >
                            <p:outputLabel value="#{loc.stockname}" for="txtStockName"   styleClass="Fs12 FontBold"/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{invoiceItemTabBean.selectedObject.isService}" >
                            <p:outputLabel  value="#{loc.servicename}" for="txtStockName"   styleClass="Fs12 FontBold"/>
                        </h:panelGroup> 
                        <h:panelGroup class="Fright">
                            <p:outputLabel value="#{loc.isfreestock} : " for="isFreeStock" styleClass="Fs12 FontBold"  rendered="#{!invoiceItemTabBean.selectedInvoice.isPeriodInvoice}"/>
                            <p:selectBooleanCheckbox id="isFreeStock" value="#{invoiceItemTabBean.selectedObject.isFree}" style="border-color: #8a5a1b !important;" rendered="#{!invoiceItemTabBean.selectedInvoice.isPeriodInvoice}" disabled="#{invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized}">
                                <p:ajax event="change" global="false" listener="#{invoiceItemTabBean.changeIsFree()}" update="grdInvoiceStokProcess" /> 
                            </p:selectBooleanCheckbox>
                        </h:panelGroup>
                        <p:inputText id="txtStockName" value="#{invoiceItemTabBean.selectedObject.stock.name}" onclick="showBook()" class="inputPositionForBookFilter" required="true" 
                                     readonly="#{facesContext.currentPhaseId.ordinal ge 4}" disabled="#{invoiceItemTabBean.processType==2}"  placeholder="#{invoiceItemTabBean.selectedObject.isService ? loc.servicename :  loc.stockname}" >

                        </p:inputText>
                        <p:commandLink id="btnStock" process="@this" class="commandLinkPositionForBookFilter" oncomplete="PF('olp_stock').loadContents()" rendered="#{invoiceItemTabBean.processType==1}">
                            <i class="fa fa-book Fs16 iconPositionForBookFilter"></i>
                            <p:ajax listener="#{stockBookFilterBean.findFilterListLazyLoading([invoiceItemTabBean.selectedInvoice],'frmStockBookFilter','olp_stock', invoiceItemTabBean.bookType)}" />
                        </p:commandLink>
                    </h:panelGroup>

                </div>


                <h:panelGroup rendered="#{invoiceItemTabBean.selectedInvoice.isFuel and !invoiceItemTabBean.selectedObject.isService  and (invoiceItemTabBean.selectedInvoice.type.id == 59 or (invoiceItemTabBean.selectedInvoice.type.id == 23 and (invoiceItemTabBean.isCreateInvFromWaybill or invoiceItemTabBean.selectedInvoice.isFuel)))}">
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.warehouse}" for="slcWarehouse" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcWarehouse" disabled="#{invoiceItemTabBean.processType==2 or !invoiceItemTabBean.isListFuelWarehouse}" value="#{invoiceItemTabBean.selectedObject.warehouse.id}" required="true" >
                            <f:selectItem itemLabel="#{loc.choose}" itemValue="0"  itemDisabled="true"/>
                            <f:selectItems value="#{invoiceItemTabBean.listOfFuelWarehouse}"  var="warehouse" itemLabel="#{warehouse.name}" itemValue="#{warehouse.id}" />
                        </p:selectOneMenu>
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{invoiceItemTabBean.selectedInvoice.isFuel and invoiceItemTabBean.selectedObject.isService and (invoiceItemTabBean.selectedInvoice.type.id == 59 or (invoiceItemTabBean.selectedInvoice.type.id == 23 and (invoiceItemTabBean.isCreateInvFromWaybill or invoiceItemTabBean.selectedInvoice.isFuel)))}">
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.warehouse}" for="slcWarehouse" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcWarehouse1" disabled="#{invoiceItemTabBean.processType==2}" value="#{invoiceItemTabBean.selectedObject.warehouse.id}" required="true" >
                            <f:selectItem itemLabel="#{loc.choose}" itemValue="0"  itemDisabled="true"/>
                            <f:selectItems value="#{invoiceProcessBean.listWarehouses}"  var="warehouse" itemLabel="#{warehouse.name}" itemValue="#{warehouse.id}" />
                        </p:selectOneMenu>
                    </div>
                </h:panelGroup>


              <!--  <h:panelGroup rendered="#{(invoiceProcessBean.processType==1 and !invoiceProcessBean.selectedObject.isFuel) or invoiceProcessBean.isCreateInvFromOrder }">
                    <div class="ui-g-12 ui-md-2 ui-lg-2">
                        <p:outputLabel value="#{loc.warehouse}" for="slcWareHouse" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcWareHouse" value="#{invoiceProcessBean.selectedObject.warehouse.id}" filter="true" required="true" styleClass="Wid95">
                            <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true" />
                            <f:selectItems value="#{invoiceProcessBean.listWarehouses}"  var="ware" itemLabel="#{ware.name}" itemValue="#{ware.id}" />
                            <p:ajax global="false" />
                        </p:selectOneMenu>
                    </div>
                </h:panelGroup>
                -->

                <div class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.amount}" for="txtStockAmount" styleClass="Fs12 FontBold"/>
                    <p:inputNumber id="txtStockAmount" value="#{invoiceItemTabBean.selectedObject.quantity}" emptyValue="#{null}"
                                   readonly="#{invoiceItemTabBean.selectedInvoice.isPeriodInvoice}"
                                   decimalPlaces="#{invoiceItemTabBean.selectedObject.stock.unit.unitRounding}" minValue="0"
                                   class="Wid95 TexAlRight" required="true"  placeholder="#{loc.amount}" >
                        <p:ajax event="keyup" global="false" process="@this" delay="1" listener="#{invoiceItemTabBean.calculater(1)}" update="txtUnitPrice, txtTotalPrice, txtPrice, txtDiscountRate, txtDiscountPrice, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount"/>
                    </p:inputNumber> 
                </div>

                <div class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.unit}" for="slcUnit" styleClass="Fs12 FontBold"/>
                    <p:selectOneMenu id="slcUnit" required="true" value="#{invoiceItemTabBean.selectedObject.stock.unit.id}" 
                                     styleClass="Wid95" disabled="#{invoiceItemTabBean.processType==2}" >
                        <f:selectItems value="#{invoiceItemTabBean.listOfUnit}" var="unitcon" itemLabel="#{unitcon.unit.name}" itemValue="#{unitcon.unit.id}" />
                        <p:ajax event="change"  listener="#{invoiceItemTabBean.bringUnit()}" global="false" update="txtStockAmount" />
                    </p:selectOneMenu>
                </div>

                <div class="#{invoiceItemTabBean.selectedInvoice.isFuel ? 'ui-g-12 ui-md-6 ui-lg-2' : 'ui-g-12 ui-md-6 ui-lg-3'}">


                    <p:outputLabel value="#{loc.unitprice}" for="txtUnitPrice" styleClass="Fs12 FontBold" />

                    <h:panelGroup class="Fright">
                        <p:outputLabel value="#{loc.istaxincluded} : " for="isTaxInclude" styleClass="Fs12 FontBold"  />
                        <p:selectBooleanCheckbox id="isTaxInclude" value="#{invoiceItemTabBean.selectedObject.isTaxIncluded}" style="border-color: #8a5a1b !important;" disabled="#{invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized}">
                            <p:ajax event="change" global="txfalse" listener="#{invoiceItemTabBean.changeIsTax()}" update="grdInvoiceStokProcess" /> 
                        </p:selectBooleanCheckbox>
                    </h:panelGroup>
                    <p:inputNumber id="txtUnitPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                   thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" emptyValue="#{null}"
                                   symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}"
                                   symbolPosition="s" decimalPlaces="4" minValue="0" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                   readonly="#{(invoiceItemTabBean.selectedInvoice.isPeriodInvoice) or (invoiceItemTabBean.selectedObject.stock.stockInfo.saleMandatoryPrice.doubleValue()!=0 and !invoiceItemTabBean.selectedInvoice.isPurchase) or (invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized)}"
                                   value="#{invoiceItemTabBean.selectedObject.unitPrice}"  class="Wid97 TexAlRight"  placeholder="#{loc.unitprice}" required="true">
                        <p:ajax event="keyup" process="@this" delay="1" global="false" listener="#{invoiceItemTabBean.calculater(1)}" update="txtStockAmount, txtTotalPrice, txtPrice, txtDiscountRate, txtDiscountPrice, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount"/>
                        <p:ajax event="blur" process="@this" delay="1" global="false" listener="#{invoiceItemTabBean.calculateIsFree()}" update="txtStockAmount, txtTotalPrice, txtPrice, txtDiscountRate, txtDiscountPrice, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount"/>
                    </p:inputNumber>
                </div>


                <div class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.currency}" for="slcStockCurrency" styleClass="Fs12 FontBold"/>
                    <p:selectOneMenu id="slcStockCurrency" required="true" class="Wid95" value="#{invoiceItemTabBean.selectedObject.currency.id}"
                                     disabled="#{!sessionBean.lastBranchSetting.isForeignCurrency or invoiceItemTabBean.selectedObject.isFree}">
                        <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true" />
                        <f:selectItems   value="#{sessionBean.currencies}" var="currency" itemLabel="#{currency.nameMap.get(sessionBean.langId).name}" itemValue="#{currency.id}"  />
                        <p:ajax event="change" listener="#{invoiceItemTabBean.bringCurrency()}" update="grdInvoiceStokProcess" global="false" />
                    </p:selectOneMenu>
                </div>  

                <h:panelGroup  rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel id="outExchange" value="#{loc.exchangerate} #{invoiceItemTabBean.exchange}" for="txtExchangeRate" styleClass="Fs12 FontBold"/>
                        <p:inputNumber id="txtExchangeRate" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                       decimalPlaces="4" disabled="#{invoiceItemTabBean.selectedObject.currency.id==invoiceItemTabBean.selectedInvoice.currency.id}"
                                       value="#{invoiceItemTabBean.selectedObject.exchangeRate}"  class="Wid97 TexAlRight"  placeholder="#{loc.exchangerate}" required="true">
                            <p:ajax event="keyup" global="false" />
                        </p:inputNumber>
                    </div>
                </h:panelGroup>
                <h:panelGroup  rendered="#{!sessionBean.lastBranchSetting.isForeignCurrency}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2" />
                </h:panelGroup>

                <div class="ui-g-12  ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.taxfreeamountexcludingdiscount}" for="txtPriceWithDiscount" styleClass="Fs12 FontBold"/>
                    <p:inputNumber id="txtPriceWithDiscount" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                   thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                   decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" readonly="true" 
                                   symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}"
                                   symbolPosition="s" disabled="#{invoiceItemTabBean.selectedObject.totalTax.doubleValue()==0}"
                                   value="#{invoiceItemTabBean.selectedObject.totalPrice+invoiceItemTabBean.selectedObject.discountPrice+invoiceItemTabBean.selectedObject.discountPrice2+invoiceItemTabBean.selectedObject.invoiceDiscountPrice}"  class="Wid95 TexAlRight"  placeholder="#{loc.taxprice}" required="true">
                    </p:inputNumber>
                </div>

                <h:panelGroup  rendered="#{invoiceItemTabBean.selectedObject.isDiscountRate}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.discountrate}1" for="txtDiscountRate" styleClass="Fs12 FontBold"/>
                        <p:commandLink id="cmdDiscountRate" resetValues="true" process="@this" global="false" title="#{loc.discountamount}" actionListener="#{invoiceItemTabBean.discountPriceOrRate(1)}" update="grdInvoiceStokProcess"  >
                            <i class="fa fa-refresh Fs14 tlbrAddBtn"/>                 
                        </p:commandLink>
                        <p:inputNumber id="txtDiscountRate" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}"  disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                       decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"  symbol="%" symbolPosition="s"
                                       value="#{invoiceItemTabBean.selectedObject.discountRate}" maxValue="100" minValue="0" class="Wid95 TexAlRight"  placeholder="#{loc.discountrate}" >
                            <p:ajax event="keyup" process="@this" delay="1" listener="#{invoiceItemTabBean.calculater(1)}" global="false" update="txtTotalPrice, txtPrice, txtDiscountPrice, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount" />
                        </p:inputNumber>

                    </div> 
                </h:panelGroup>
                <h:panelGroup  rendered="#{!invoiceItemTabBean.selectedObject.isDiscountRate}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">

                        <p:outputLabel value="#{loc.discountamount}1" for="txtDiscountPrice" styleClass="Fs12 FontBold"/>
                        <p:commandLink id="cmdDiscountPrice" resetValues="true" process="@this" global="false" title="#{loc.discountrate}" actionListener="#{invoiceItemTabBean.discountPriceOrRate(0)}" update="grdInvoiceStokProcess" class="TextDecNone" >
                            <i class="fa fa-refresh Fs14 tlbrAddBtn"/>                 
                        </p:commandLink>
                        <p:inputNumber id="txtDiscountPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                       decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}" symbolPosition="s"
                                       value="#{invoiceItemTabBean.selectedObject.discountPrice}"  class="Wid95 TexAlRight"  placeholder="#{loc.discountamount}" >
                            <p:ajax event="keyup" process="@this" delay="1" global="false" listener="#{invoiceItemTabBean.calculater(1)}" update="txtTotalPrice, txtPrice, txtDiscountRate, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount"/>
                        </p:inputNumber>
                    </div> 
                </h:panelGroup>
                <h:panelGroup  rendered="#{invoiceItemTabBean.selectedObject.isDiscountRate2}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">
                        <p:outputLabel value="#{loc.discountrate}2" for="txtDiscountRate2" styleClass="Fs12 FontBold"/>
                        <p:commandLink id="cmdDiscountRate2" resetValues="true" process="@this" global="false" title="#{loc.discountamount}2" actionListener="#{invoiceItemTabBean.discountPriceOrRate2(1)}" update="grdInvoiceStokProcess"  >
                            <i class="fa fa-refresh Fs14 tlbrAddBtn"/>                 
                        </p:commandLink>
                        <p:inputNumber id="txtDiscountRate2" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                       decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"  symbol="%" symbolPosition="s"
                                       value="#{invoiceItemTabBean.selectedObject.discountRate2}" maxValue="100" minValue="0" class="Wid95 TexAlRight"  placeholder="#{loc.discountrate}2" >
                            <p:ajax event="keyup" process="@this" delay="1" listener="#{invoiceItemTabBean.calculater(1)}" global="false" update="txtTotalPrice, txtPrice, txtDiscountPrice2, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount" />
                        </p:inputNumber>

                    </div> 
                </h:panelGroup>
                <h:panelGroup  rendered="#{!invoiceItemTabBean.selectedObject.isDiscountRate2}" >
                    <div class="ui-g-12 ui-md-6 ui-lg-2">

                        <p:outputLabel value="#{loc.discountamount}2" for="txtDiscountPrice2" styleClass="Fs12 FontBold"/>
                        <p:commandLink id="cmdDiscountPrice2" resetValues="true" process="@this" global="false" title="#{loc.discountrate}2" actionListener="#{invoiceItemTabBean.discountPriceOrRate2(0)}" update="grdInvoiceStokProcess" class="TextDecNone" >
                            <i class="fa fa-refresh Fs14 tlbrAddBtn"/>                 
                        </p:commandLink>
                        <p:inputNumber id="txtDiscountPrice2" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                       decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}" symbolPosition="s"
                                       value="#{invoiceItemTabBean.selectedObject.discountPrice2}"  class="Wid95 TexAlRight"  placeholder="#{loc.discountamount}2" >
                            <p:ajax event="keyup" process="@this" delay="1" global="false" listener="#{invoiceItemTabBean.calculater(1)}" update="txtTotalPrice, txtPrice, txtDiscountRate2, txtInvoiceDiscountPrice, txtTaxPrice, txtPriceWithDiscount"/>
                        </p:inputNumber>
                    </div> 
                </h:panelGroup>

                <div class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.invoicebaseddiscount}" for="txtInvoiceDiscountPrice" styleClass="Fs12 FontBold"/>
                    <p:inputNumber id="txtInvoiceDiscountPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                   thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}"  readonly="true" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                   decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}" symbolPosition="s"
                                   value="#{invoiceItemTabBean.selectedObject.invoiceDiscountPrice}"  class="Wid95 TexAlRight"  placeholder="#{loc.invoicebaseddiscount}" >
                    </p:inputNumber>
                </div> 

                <div class="ui-g-12 ui-md-6 ui-lg-2">
                    <p:outputLabel value="#{loc.taxfreeamountincludingdiscount}" for="txtPrice" styleClass="Fs12 FontBold"/>
                    <p:inputNumber id="txtPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                   thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                   decimalPlaces="#{(invoiceItemTabBean.selectedObject.stock.stockInfo.saleMandatoryPrice.doubleValue()!=0 and !invoiceItemTabBean.selectedInvoice.isPurchase) or (invoiceItemTabBean.selectedInvoice.isPeriodInvoice) or (invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized) ? sessionBean.user.lastBranch.currencyrounding : 4}" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                   symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}"
                                   symbolPosition="s" readonly="#{(invoiceItemTabBean.selectedObject.stock.stockInfo.saleMandatoryPrice.doubleValue()!=0 and !invoiceItemTabBean.selectedInvoice.isPurchase) or (invoiceItemTabBean.selectedInvoice.isPeriodInvoice) or (invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized)}"
                                   value="#{invoiceItemTabBean.selectedObject.totalPrice}"  class="Wid97 TexAlRight"  placeholder="#{loc.price}" required="true">
                        <c:if test="#{!((invoiceItemTabBean.selectedObject.stock.stockInfo.saleMandatoryPrice.doubleValue()!=0 and !invoiceItemTabBean.selectedInvoice.isPurchase) or (invoiceItemTabBean.selectedInvoice.isPeriodInvoice) or (invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized))}">
                            <p:ajax event="keyup" process="@this"  listener="#{invoiceItemTabBean.changeTotalPrice()}" global="false" update="txtStockAmount, txtTotalPrice, txtDiscountRate,txtInvoiceDiscountPrice, txtTaxPrice, txtUnitPrice, txtPriceWithDiscount"/>
                        </c:if>
                    </p:inputNumber>
                </div>

                <div class="ui-g-12  ui-md-6 ui-lg-3">
                    <p:outputLabel value="#{loc.taxrate}" for="txtTaxRate" styleClass="Fs12 FontBold"/>
                    <p:inputNumber id="txtTaxRate" symbol="%" symbolPosition="s" readonly="true" disabled="#{invoiceItemTabBean.selectedObject.taxRate.doubleValue()==0 and invoiceItemTabBean.selectedObject.isFree}"
                                   value="#{invoiceItemTabBean.selectedObject.taxRate}"  class="Wid95 TexAlRight"  placeholder="#{loc.taxrate}" required="true">
                    </p:inputNumber>
                </div>

                <div class="ui-g-12  ui-md-6 ui-lg-3">
                    <p:outputLabel value="#{loc.taxprice}" for="txtTaxPrice" styleClass="Fs12 FontBold"/>
                    <p:inputNumber id="txtTaxPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                   thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                   decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" readonly="true" 
                                   symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}"
                                   symbolPosition="s" disabled="#{invoiceItemTabBean.selectedObject.totalTax.doubleValue()==0 and invoiceItemTabBean.selectedObject.isFree}"
                                   value="#{invoiceItemTabBean.selectedObject.totalTax}"  class="Wid95 TexAlRight"  placeholder="#{loc.taxprice}" required="true">
                    </p:inputNumber>
                </div>


                <div  class="#{invoiceItemTabBean.selectedInvoice.isFuel ? 'ui-g-12 ui-md-6 ui-lg-2' : 'ui-g-12 ui-md-6 ui-lg-4'}" >
                    <p:outputLabel value="#{loc.totalprice}" for="txtTotalPrice" styleClass="Fs12 FontBold"/> 
                    <p:inputNumber id="txtTotalPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                   thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                   decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                   symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}"
                                   symbolPosition="s" readonly="true" disabled="#{invoiceItemTabBean.selectedObject.isFree}"
                                   value="#{invoiceItemTabBean.selectedObject.totalMoney}"  class="Wid95 TexAlRight"  placeholder="#{loc.totalprice}" required="true">
                    </p:inputNumber>
                </div>



                <div class="ui-g-12  ui-md-12 ui-lg-12">
                    <p:outputLabel value="#{loc.description}" for="txtDescription" styleClass="Fs12 FontBold"/>
                    <p:inputTextarea id="txtDescription" value="#{invoiceItemTabBean.selectedObject.description}" 
                                     rows="3" cols="5" autoResize="false" style="resize: none;" placeholder="#{loc.description}"/>
                </div>
            </div>
        </h:panelGroup>

        <p:remoteCommand name="showBook" process="@this" oncomplete="PF('olp_stock').loadContents()" actionListener="#{stockBookFilterBean.findFilterListLazyLoading([invoiceItemTabBean.selectedInvoice],'frmStockBookFilter','olp_stock',invoiceItemTabBean.bookType)}" />
    </h:form>



</ui:composition>
