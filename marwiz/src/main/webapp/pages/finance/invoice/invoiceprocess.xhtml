<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:outputScript name="js/written-number.js" library="sentinel-layout" />

    <h:form id="frmInvoiceProcess">  
        <ui:include src="/pages/general/common/processtoolbar.xhtml" >
            <ui:param name="outputtext" value="#{invoiceProcessBean.selectedObject.isPurchase ? loc.purchasinginvoiceprocesses : loc.salesinvoiceprocesses}"/>
            <ui:param name="bean" value='#{invoiceProcessBean}' />
            <ui:param name="update" value="pgrInvoiceProcess" />
            <ui:param name="btnSaveId" value="#{sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  and 
                                                !invoiceProcessBean.selectedObject.isPeriodInvoice and invoiceProcessBean.selectedObject.posId == 0 and invoiceProcessBean.processType == 2 and invoiceProcessBean.selectedObject.status.id != 30 and invoiceProcessBean.getRendered(2, 0) ? (invoiceProcessBean.selectedObject.type.id == 59 and invoiceProcessBean.selectedObject.isPurchase) ?   (invoiceProcessBean.selectedObject.sapIsSendWaybill or (invoiceProcessBean.selectedObject.sapIsSendWaybill and invoiceProcessBean.selectedObject.sapLogIsSend)) ? 'false' : 'true' : invoiceProcessBean.selectedObject.sapLogIsSend ? 'false' : 'true' :
                                                !invoiceProcessBean.selectedObject.isPeriodInvoice and invoiceProcessBean.selectedObject.posId == 0 and (invoiceProcessBean.processType == 1 or invoiceProcessBean.selectedObject.status.id != 30) and invoiceProcessBean.getRendered(2, 0)}" />
            <ui:param name="renderback" value='true'/>
            <ui:param name="btnPrinterDesign" value="#{!invoiceProcessBean.isCreateInvFromOrder and invoiceProcessBean.processType==2 and !invoiceProcessBean.isCreateInvFromCustAgreement ? 'true' : 'false'}" /> 
            <ui:param name="btnPrinterDesignFromDevice" value="#{!invoiceProcessBean.isCreateInvFromOrder and invoiceProcessBean.processType==2 and !invoiceProcessBean.isCreateInvFromCustAgreement ? 'true' : 'false'}" /> 
            <ui:param name="target" value="frmInvoicePrinter" /> 
            <c:if test="#{invoiceProcessBean.processType==2}"> 
                <ui:param name="renderSelectedObject" value='true'/>
                <ui:param name="selectedObjectName" value="#{!invoiceProcessBean.isCreateInvFromCustAgreement ? invoiceProcessBean.selectedObject : invoiceProcessBean.selectedObject.account.name} 
                          #{(invoiceProcessBean.selectedObject.isPeriodInvoice and !invoiceProcessBean.isCreateInvFromCustAgreement) or invoiceProcessBean.selectedObject.posId!=0 or invoiceProcessBean.selectedObject.type.id==27 ? ' - ' : ''} 
                          #{(invoiceProcessBean.selectedObject.isPeriodInvoice and !invoiceProcessBean.isCreateInvFromCustAgreement) or invoiceProcessBean.selectedObject.posId!=0 or invoiceProcessBean.selectedObject.type.id==27 ?  invoiceProcessBean.info : ''}"/>
                <ui:param name="btnDeleteId" value="#{!invoiceProcessBean.isCreateInvFromOrder and ((invoiceProcessBean.processType == 2 and invoiceProcessBean.selectedObject.posId==0  and invoiceProcessBean.selectedObject.status.id !=30 and !invoiceProcessBean.isCreateInvFromCustAgreement) or (invoiceProcessBean.selectedObject.isPeriodInvoice and !invoiceProcessBean.isCreateInvFromCustAgreement)) and invoiceProcessBean.getRendered(3, 0) ? 
                                                      sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ? 
                                                      (invoiceProcessBean.selectedObject.type.id == 59 and invoiceProcessBean.selectedObject.isPurchase) ? (invoiceProcessBean.selectedObject.sapIsSendWaybill or (invoiceProcessBean.selectedObject.sapIsSendWaybill and invoiceProcessBean.selectedObject.sapLogIsSend)) ? 'false' : 'true' : invoiceProcessBean.selectedObject.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}" />
                <ui:param name="btnTestBeforeDeleteId" value="#{(invoiceProcessBean.processType == 2 and invoiceProcessBean.selectedObject.posId==0 and invoiceProcessBean.selectedObject.status.id!=30 and !invoiceProcessBean.isCreateInvFromCustAgreement) or (invoiceProcessBean.selectedObject.isPeriodInvoice and !invoiceProcessBean.isCreateInvFromCustAgreement) ? 'true' : 'false'}" />
                <ui:param name="renderOpen" value="#{sessionBean.user.lastBranchSetting.isCentralIntegration and invoiceProcessBean.selectedObject.isPurchase and sessionBean.user.lastBranchSetting.erpIntegrationId == 1 and (sessionBean.user.lastBranchSetting.pastPeriodClosingDate == null ? 'true' : invoiceProcessBean.selectedObject.invoiceDate.compareTo(sessionBean.user.lastBranchSetting.pastPeriodClosingDate) >0) and invoiceProcessBean.getRendered(343, 0) and !invoiceProcessBean.selectedObject.isPeriodInvoice and invoiceProcessBean.selectedObject.posId==0 and invoiceProcessBean.selectedObject.status.id!=30 ?  invoiceProcessBean.selectedObject.sapLogIsSend ? 'true' : 'false' : 'false'}"/>
                <ui:param name="titleOpen" value="#{loc.openedit}" />
            </c:if>
            <ui:param name="btnCreateInvoice" value="#{invoiceProcessBean.isCreateInvFromCustAgreement and invoiceProcessBean.getRendered(2, 0)}"/>
            <ui:param name="createExcelFile" value="#{!invoiceProcessBean.isCreateInvFromOrder and invoiceProcessBean.processType == 2 and !invoiceProcessBean.isCreateInvFromCustAgreement and !invoiceProcessBean.isCreateInvFromWaybill}"/>
            <ui:param name="labelCreateExcelFile" value="#{loc.transfertoexcel}"/>
            <ui:param name="btnChangeInfo" value="#{!invoiceProcessBean.isCreateInvFromOrder and invoiceProcessBean.processType == 2 and !invoiceProcessBean.selectedObject.isPeriodInvoice and !invoiceProcessBean.isCreateInvFromWaybill and invoiceProcessBean.selectedObject.posId == 0 and !invoiceProcessBean.selectedObject.isPayment and invoiceProcessBean.getRendered(4, 0) and invoiceProcessBean.selectedObject.type.id != 26 ?
                                                    sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ?
                                                    (invoiceProcessBean.selectedObject.type.id == 59 and invoiceProcessBean.selectedObject.isPurchase) ? (invoiceProcessBean.selectedObject.sapIsSendWaybill or (invoiceProcessBean.selectedObject.sapIsSendWaybill and invoiceProcessBean.selectedObject.sapLogIsSend)) ? 'false' : 'true' : invoiceProcessBean.selectedObject.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}"/>
            <ui:param name="renderedSapReverse" value="#{!invoiceProcessBean.isCreateInvFromOrder and !invoiceProcessBean.selectedObject.isPeriodInvoice and invoiceProcessBean.selectedObject.posId==0 and invoiceProcessBean.processType==2 and invoiceProcessBean.selectedObject.status.id!=30 and !invoiceProcessBean.selectedObject.isPurchase and sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1 and (sessionBean.user.lastBranchSetting.pastPeriodClosingDate == null ? 'true' : invoiceProcessBean.selectedObject.invoiceDate.compareTo(sessionBean.user.lastBranchSetting.pastPeriodClosingDate) >0) and invoiceProcessBean.getRendered(343, 0) ? invoiceProcessBean.selectedObject.sapLogIsSend ? 'true' : 'false' : 'false'}"/>
            <ui:param name="titleSap" value="#{loc.sendreversepostingtosap}"/>

        </ui:include>

        <div class="divContent ui-g-12">
            <h:panelGroup id="pgrInvoiceProcess" layout="block">  
                <div class="ui-g panelToggle">
                    <h:panelGroup rendered="#{invoiceProcessBean.listOfBranch.size() > 1}">
                        <div class="ui-g-12 ui-md-3 ui-lg-2">
                            <p:outputLabel value="#{loc.branch}" for="slcBranch" styleClass="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcBranch" value="#{invoiceProcessBean.selectedObject.branchSetting.branch.id}" disabled="#{invoiceProcessBean.processType==2}">
                                <f:selectItem itemValue="#{null}" itemLabel="#{loc.choose}" itemDisabled="true"/>
                                <f:selectItems value="#{invoiceProcessBean.listOfBranch}" var="branchSetting" itemValue="#{branchSetting.branch.id}" itemLabel="#{branchSetting.branch.name}" />
                                <p:ajax update="pgrInvoiceProcess" listener="#{invoiceProcessBean.changeBranch()}" process="@this"/>
                            </p:selectOneMenu>
                        </div>
                    </h:panelGroup> 
                    <div class="ui-g-12 ui-md-4 ui-lg-4">
                        <p:outputLabel value="#{loc.current}" for="txtAccountName" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtAccountName" onclick="#{invoiceProcessBean.processType==1 ? 'showBook()' : ''}" value="#{invoiceProcessBean.selectedObject.account.name}" class="inputPositionForBookFilter" required="true" 
                                     readonly="#{facesContext.currentPhaseId.ordinal ge 4}" placeholder="#{loc.currentname}">

                        </p:inputText>
                        <p:commandLink id="btnAccountName" rendered="#{invoiceProcessBean.processType==1}" class="commandLinkPositionForBookFilter" process="@this" oncomplete="PF('olp_account').loadContents();" >
                            <i class="fa fa-book Fs16 softgray iconPositionForBookFilter "/>   
                            <p:ajax listener="#{accountBookFilterBean.findFilterListLazyLoading([invoiceProcessBean.selectedObject.branchSetting.branch],'frmAccountBookFilter','olp_account','invoice')}" global="false" />
                        </p:commandLink>
                    </div>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.currentphone}" for="txtCurrentPhone" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtCurrentPhone" value="#{invoiceProcessBean.selectedObject.account.phone}" readonly="true" placeholder="#{loc.currentphone}" styleClass="Wid95" /> 
                    </div>
                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.currentmail}" for="txtCurrentMail" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtCurrentMail" value="#{invoiceProcessBean.selectedObject.account.email}" readonly="true" placeholder="#{loc.currentmail}" styleClass="Wid95" /> 
                    </div>



                    <h:panelGroup  rendered="#{(!invoiceProcessBean.selectedObject.isPurchase and (invoiceProcessBean.selectedObject.type.id != 26 and invoiceProcessBean.selectedObject.type.id != 27)) and invoiceProcessBean.branchSettingForSelection.isEInvoice or (invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.type.id == 27)}">
                        <div class="#{invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.type.id == 27 and invoiceProcessBean.selectedObject.taxPayerTypeId==1 ? 'ui-g-12 ui-md-4 ui-lg-2' : invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.type.id == 27 and invoiceProcessBean.selectedObject.taxPayerTypeId==2 ? 'ui-g-12 ui-md-4 ui-lg-2' : 'ui-g-12 ui-md-4 ui-lg-1'}">
                            <p:outputLabel value="#{loc.iseinvoice}" for="slcEInvoiceType" class="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcEInvoiceType" value="#{invoiceProcessBean.selectedObject.taxPayerTypeId}" required="true" >
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="#{null}"  />
                                <f:selectItem itemLabel="#{loc.einvoice}" itemValue="1"/>
                                <f:selectItem itemLabel="#{loc.earchive}" itemValue="2"/>
                                <p:ajax event="change" update="pgrInvoiceProcess"  />
                            </p:selectOneMenu>
                        </div>  
                    </h:panelGroup>  



                    <h:panelGroup  rendered="#{invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.type.id !=27 and invoiceProcessBean.branchSettingForSelection.isEInvoice}">
                        <div class="ui-g-12 ui-md-4 ui-lg-2">
                            <p:outputLabel value="#{loc.iseinvoice}" for="slcEInvoiceType1" class="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcEInvoiceType1" value="#{invoiceProcessBean.selectedObject.isEInvoice}" required="true" disabled="true">
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="#{null}"  />
                                <f:selectItem itemLabel="#{loc.einvoice}" itemValue="true"/>
                                <f:selectItem itemLabel="#{loc.normal}" itemValue="false"/>
                            </p:selectOneMenu>
                        </div>  
                    </h:panelGroup>  


                    <h:panelGroup  rendered="#{((!invoiceProcessBean.selectedObject.isPurchase and (invoiceProcessBean.selectedObject.type.id != 26 and invoiceProcessBean.selectedObject.type.id != 27) ) or (invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.type.id == 27 )) and invoiceProcessBean.branchSettingForSelection.isEInvoice and invoiceProcessBean.selectedObject.taxPayerTypeId!=1 }">
                        <div class="ui-g-12 ui-md-4 ui-lg-1">
                            <p:outputLabel value="#{loc.shippingtype}" for="slcShippingType" class="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcShippingType" value="#{invoiceProcessBean.selectedObject.deliveryTypeId}" required="true" >
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="#{null}"  />
                                <f:selectItem itemLabel="#{loc.paper}" itemValue="1"/>
                                <f:selectItem itemLabel="#{loc.electronic}" itemValue="2"/>
                            </p:selectOneMenu>
                        </div>  
                    </h:panelGroup>  

                    <h:panelGroup  rendered="#{!invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.branchSettingForSelection.isEInvoice and invoiceProcessBean.selectedObject.taxPayerTypeId==1 and invoiceProcessBean.selectedObject.type.id !=27 and invoiceProcessBean.selectedObject.type.id !=26}">
                        <div class="ui-g-12 ui-md-4 ui-lg-1">
                            <p:outputLabel value="#{loc.einvoicescenario}" for="slcInvoiceScenario" class="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcInvoiceScenario" value="#{invoiceProcessBean.selectedObject.invoiceScenarioId}" required="true" >
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="#{null}"  />
                                <f:selectItem itemLabel="#{loc.basicinvoice}" itemValue="1"/>
                                <f:selectItem itemLabel="#{loc.commercialinvoice}" itemValue="2"/>
                            </p:selectOneMenu>
                        </div>  
                    </h:panelGroup>  


                    <div class="ui-g-12 ui-md-4 ui-lg-1">
                        <p:outputLabel value="#{loc.invoicetype}" for="slcInvoiceType" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcInvoiceType" value="#{invoiceProcessBean.selectedObject.type.id}" disabled="#{invoiceProcessBean.processType==2}" required="true" styleClass="Wid95">
                            <f:selectItems value="#{sessionBean.getTypes(17)}"  var="type" itemLabel="#{type.nameMap.get(sessionBean.langId).name}" itemValue="#{type.id}" />
                            <p:ajax global="false" update="pgrInvoiceProcess" />
                        </p:selectOneMenu>
                    </div>


                    <div class="ui-g-12 ui-md-4 ui-lg-1">
                        <p:outputLabel value="#{loc.statu}" for="slcStatu" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcStatu" required="true" disabled="#{invoiceProcessBean.processType==1 or invoiceProcessBean.selectedObject.status.id==30}" value="#{invoiceProcessBean.selectedObject.status.id}" styleClass="Wid95" >
                            <f:selectItems value="#{invoiceProcessBean.listOfStatus}"  var="statu" itemLabel="#{statu.nameMap.get(sessionBean.langId).name}" 
                                           itemValue="#{statu.id}"  />
                        </p:selectOneMenu>
                    </div>

                    <h:panelGroup rendered="#{invoiceProcessBean.selectedObject.isPurchase}" >
                        <div class="ui-g-12 ui-md-2 ui-lg-1">
                            <p:outputLabel value="#{loc.serialno}" for="txtDocumentNumber3" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtDocumentNumber3" value="#{invoiceProcessBean.selectedObject.documentSerial}" 
                                         required="true"  styleClass="Wid95" placeholder="#{loc.serialno}"  />
                        </div>
                        <div class="ui-g-12 ui-md-2 ui-lg-1">
                            <p:outputLabel value="#{loc.orderno}" for="txtDocumentNumber" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtDocumentNumber" value="#{invoiceProcessBean.selectedObject.documentNumber}" placeholder="#{loc.number}" required="true" 
                                         styleClass="Wid95"/>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{!invoiceProcessBean.selectedObject.isPurchase}" >
                        <div class="ui-g-12 ui-md-2 ui-lg-1">
                            <p:outputLabel value="#{loc.serialno}" for="slcDocumentNumber" styleClass="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcDocumentNumber" required="true" value="#{invoiceProcessBean.selectedObject.dNumber.id}" 
                                             styleClass="Wid95"  >
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true" />
                                <f:selectItems value="#{invoiceProcessBean.listOfDocumentNumber}"  var="dnumber" itemLabel="#{dnumber.serial}" itemValue="#{dnumber.id}" />
                                <p:ajax listener="#{invoiceProcessBean.bringDocument}" global="false" delay="100" process="@this" update="txtDocumentNumber2" />
                            </p:selectOneMenu>
                        </div>
                        <div class="ui-g-12 ui-md-2 ui-lg-1">
                            <p:outputLabel value="#{loc.orderno}" for="txtDocumentNumber2" styleClass="Fs12 FontBold"/>
                            <p:inputNumber id="txtDocumentNumber2" value="#{invoiceProcessBean.selectedObject.dNumber.actualNumber}" required="true" 
                                           styleClass="Wid95" placeholder="#{loc.number}"
                                           thousandSeparator="" decimalSeparator="." decimalPlaces="0" minValue="0"
                                           />
                        </div>
                    </h:panelGroup>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.documentdate}" for="cldInvoiceDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldInvoiceDate" value="#{invoiceProcessBean.selectedObject.invoiceDate}" required="true" class="datepicker" 
                                     beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" showOn="button" 
                                     showButtonPanel="true" placeholder="#{loc.documentdate}" mask="true" navigator="true" timeControlType="select"
                                     locale="#{sessionBean.locale}" yearRange="c-100:c+20" disabled="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}" >
                            <p:ajax event="change" update="cldInvoiceDate" listener="#{invoiceProcessBean.changeDueDate()}" resetValues="true"/>
                        </p:calendar>
                    </div>

                    <h:panelGroup  rendered="#{invoiceProcessBean.selectedObject.isDiscountRate}" >
                        <div class="ui-g-12 ui-md-4 ui-lg-2">
                            <p:outputLabel value="#{loc.discountrate}" for="txtDiscountRate" styleClass="Fs12 FontBold"/>
                            <p:commandLink id="cmdDiscountRate" resetValues="true" process="@this" title="#{loc.discountamount}" actionListener="#{invoiceProcessBean.discountPriceOrRate(1)}" update="pgrInvoiceProcess"  >
                                <i class="fa fa-refresh Fs14 tlbrAddBtn"/>                 
                            </p:commandLink>
                            <p:inputNumber id="txtDiscountRate" roundMethod="D" symbol="%" symbolPosition="s"  
                                           value="#{invoiceProcessBean.oldDiscountRate}" 
                                           readonly="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30 or invoiceProcessBean.selectedObject.type.id == 26 or invoiceProcessBean.isUpdate}" class=" TexAlRight"  placeholder="#{loc.discountrate}">
                                <p:ajax event="keyup" process="@this" delay="1" listener="#{invoiceProcessBean.calcDiscount()}" update="txtDiscountPrice" global="false" />
                            </p:inputNumber>

                        </div> 
                    </h:panelGroup>

                    <h:panelGroup  rendered="#{!invoiceProcessBean.selectedObject.isDiscountRate}" >
                        <div class="ui-g-12 ui-md-4 ui-lg-2">

                            <p:outputLabel value="#{loc.discountamount}" for="txtDiscountPrice" styleClass="Fs12 FontBold"/>
                            <p:commandLink id="cmdDiscountPrice" resetValues="true" process="@this" title="#{loc.discountrate}" actionListener="#{invoiceProcessBean.discountPriceOrRate(0)}" update="pgrInvoiceProcess" class="TextDecNone" >
                                <i class="fa fa-refresh Fs14 tlbrAddBtn"/>                 
                            </p:commandLink>
                            <p:inputNumber id="txtDiscountPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}"  
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                           roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" symbolPosition="s"
                                           symbol="#{sessionBean.currencySignOrCode(invoiceProcessBean.selectedObject.getCurrency().getId(),0)}"
                                           readonly="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30 or invoiceProcessBean.selectedObject.type.id == 26 or invoiceProcessBean.isUpdate}"
                                           value="#{invoiceProcessBean.oldDiscountPrice}"  class=" TexAlRight"  placeholder="#{loc.discountamount}" >
                                <p:ajax event="keyup" process="@this" delay="1000" listener="#{invoiceProcessBean.calcDiscount()}" update="txtDiscountRate" global="false" />
                            </p:inputNumber>
                        </div> 
                    </h:panelGroup>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel id="outRounding" value="#{loc.roundingprice}" for="txtRounding" styleClass="Fs12 FontBold"/>
                        <p:inputNumber id="txtRounding" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}"  
                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                       minValue="#{-invoiceProcessBean.branchSetting.roundingConstraint}"
                                       maxValue="#{invoiceProcessBean.branchSetting.roundingConstraint}" symbolPosition="s"
                                       symbol="#{sessionBean.currencySignOrCode(invoiceProcessBean.selectedObject.getCurrency().getId(),0)}"
                                       readonly="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}"
                                       roundMethod="D" decimalPlaces="4" disabled="#{invoiceProcessBean.totalPrice==0 or invoiceProcessBean.processType==1}"
                                       value="#{invoiceProcessBean.selectedObject.roundingPrice}"  class="Wid97 TexAlRight"  placeholder="#{loc.roundingprice}" > 
                            <p:ajax event="keyup" process="@this" delay="1" global="false" listener="#{invoiceProcessBean.calcInvoicePrice()}"/>
                        </p:inputNumber>
                    </div>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.currency}" for="slcCurrency" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcCurrency" value="#{invoiceProcessBean.selectedObject.currency.id}" 
                                         disabled="#{invoiceProcessBean.totalPrice>0 
                                                     or invoiceProcessBean.selectedObject.id!=0
                                                     or !sessionBean.lastBranchSetting.isForeignCurrency
                                                     or invoiceProcessBean.selectedObject.isPeriodInvoice}"  required="true" styleClass="Wid95">
                            <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true" />
                            <f:selectItems value="#{sessionBean.currencies}"  var="currency" itemLabel="#{currency.nameMap.get(sessionBean.langId).name}" itemValue="#{currency.id}" />
                            <p:ajax event="change" listener="#{invoiceProcessBean.changeExchange()}" update="outExchange txtExchangeRate" global="false" />
                        </p:selectOneMenu>
                    </div>

                    <h:panelGroup  rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}" >
                        <div class="#{invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.type.id == 27 ? 'ui-g-12 ui-md-4 ui-lg-2' : 'ui-g-12 ui-md-4 ui-lg-2'}" >
                            <p:outputLabel id="outExchange" value="#{loc.exchangerate} #{invoiceProcessBean.exchange}" for="txtExchangeRate" styleClass="Fs12 FontBold"/>
                            <p:inputNumber id="txtExchangeRate" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}"  
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}" 

                                           roundMethod="D" decimalPlaces="4" disabled="#{invoiceProcessBean.totalPrice>0 or invoiceProcessBean.selectedObject.id!=0 or invoiceProcessBean.selectedObject.isPeriodInvoice}"
                                           value="#{invoiceProcessBean.selectedObject.exchangeRate}"  class="Wid97 TexAlRight"  placeholder="#{loc.exchangerate}" required="true"> 
                            </p:inputNumber>
                        </div>
                    </h:panelGroup>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.termdate}" for="cldDueDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldDueDate" value="#{invoiceProcessBean.selectedObject.dueDate}" 
                                     required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" 
                                     showOn="button" showButtonPanel="true" placeholder="#{loc.documentdate}" mask="true" navigator="true" timeControlType="select"
                                     locale="#{sessionBean.locale}" yearRange="c-100:c+20" disabled="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}" >
                            <p:ajax event="change" update="cldDueDate" resetValues="true"/>
                        </p:calendar>
                    </div>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.dispatchdate}" for="cldDispatchDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldDispatchDate" value="#{invoiceProcessBean.selectedObject.dispatchDate}" 
                                     required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" 
                                     showOn="button" showButtonPanel="true" placeholder="#{loc.dispatchdate}" mask="true" navigator="true" timeControlType="select"
                                     locale="#{sessionBean.locale}" yearRange="c-100:c+20" disabled="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}" >
                            <p:ajax event="change" update="cldDispatchDate" resetValues="true" global="false"/>
                        </p:calendar>
                    </div>

                    <div class="ui-g-12 ui-md-4 ui-lg-2">
                        <p:outputLabel value="#{loc.dispatchaddress}" for="txtDispatchAddress" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtDispatchAddress" value="#{invoiceProcessBean.selectedObject.dispatchAddress}" 
                                     placeholder="#{loc.dispatchaddress}" readonly="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}" styleClass="Wid97" /> 
                    </div>

                    <div class="ui-g-12 #{invoiceProcessBean.selectedObject.type.id==59 ? 'ui-md-2 ui-lg-2' : ((invoiceProcessBean.selectedObject.type.id==27) and !invoiceProcessBean.selectedObject.isPurchase) ? 'ui-md-4 ui-lg-8' : (invoiceProcessBean.selectedObject.type.id==26) ? 'ui-md-4 ui-lg-4' : ((invoiceProcessBean.selectedObject.type.id==27) and invoiceProcessBean.selectedObject.isPurchase) ?  'ui-md-4 ui-lg-4' : 'ui-md-4 ui-lg-6'}">
                        <p:outputLabel value="#{loc.description}" for="txtDescription" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtDescription" value="#{invoiceProcessBean.selectedObject.description}"  
                                     placeholder="#{loc.description}" readonly="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}" styleClass="Wid98"/>
                    </div>

                    <h:panelGroup  rendered="#{invoiceProcessBean.selectedObject.type.id==23 and (invoiceProcessBean.isCreateInvFromWaybill or invoiceProcessBean.selectedObject.isFuel)}" >
                    <div class="ui-g-12 ui-md-2 ui-lg-2">
                        <p:outputLabel value="#{loc.fuelinvoice}" styleClass="Fs12 FontBold"/>
                        <p:panelGrid layout="grid" columns="1" class="pngCheckBox" >  
                            <p:selectBooleanCheckbox id="sbcFuelInvoice1"  disabled="#{invoiceProcessBean.processType==2}" value="#{invoiceProcessBean.selectedObject.isFuel}"   class="Fleft" >
                                <p:outputLabel value="#{loc.isfuelinvoice}"  style="margin-left: 2px;"  class="FontNormal"/>
                                <p:ajax global="false" listener="#{invoiceProcessBean.changeFuelInvoice()}" update="pgrInvoiceProcess"  /> 
                            </p:selectBooleanCheckbox>

                        </p:panelGrid> 
                    </div> 
                      </h:panelGroup>
                    <h:panelGroup  rendered="#{invoiceProcessBean.selectedObject.type.id==59}" >
                        <div class="ui-g-12 ui-md-2 ui-lg-2">
                            <p:outputLabel value="#{loc.deliveryperson}" for="txtDeliveryPerson" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtDeliveryPerson" value="#{invoiceProcessBean.selectedObject.deliveryPerson}"  
                                         placeholder="#{loc.deliveryperson}" readonly="#{invoiceProcessBean.selectedObject.status.id==29 or invoiceProcessBean.selectedObject.status.id==30}" styleClass="Wid98"/>
                        </div>

                        <div class="ui-g-12 ui-md-2 ui-lg-2">
                            <p:outputLabel value="#{loc.fuelinvoice}" styleClass="Fs12 FontBold"/>
                            <p:panelGrid layout="grid" columns="1" class="pngCheckBox" >  
                                <p:selectBooleanCheckbox id="sbcFuelInvoice"  disabled="#{invoiceProcessBean.processType==2}" value="#{invoiceProcessBean.selectedObject.isFuel}"   class="Fleft" >
                                    <p:outputLabel value="#{loc.isfuelinvoice}"  style="margin-left: 2px;"  class="FontNormal"/>
                                    <p:ajax global="false" listener="#{invoiceProcessBean.changeFuelInvoice()}" update="pgrInvoiceProcess"  /> 
                                </p:selectBooleanCheckbox>

                            </p:panelGrid> 
                        </div> 

                        <h:panelGroup rendered="#{(invoiceProcessBean.processType==1 and !invoiceProcessBean.selectedObject.isFuel) or invoiceProcessBean.isCreateInvFromOrder }">
                            <div class="ui-g-12 ui-md-2 ui-lg-2">
                                <p:outputLabel value="#{loc.warehouse}" for="slcWareHouse" styleClass="Fs12 FontBold"/>
                                <p:selectOneMenu id="slcWareHouse" value="#{invoiceProcessBean.selectedObject.warehouse.id}" filter="true" required="true" styleClass="Wid95">
                                    <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true" />
                                    <f:selectItems value="#{invoiceProcessBean.listWarehouses}"  var="ware" itemLabel="#{ware.name}" itemValue="#{ware.id}" />
                                    <p:ajax global="false" />
                                </p:selectOneMenu>
                            </div>
                        </h:panelGroup>

                        <h:panelGroup  rendered="#{invoiceProcessBean.processType==2 and !invoiceProcessBean.isCreateInvFromOrder and !invoiceProcessBean.selectedObject.isFuel}">
                            <div class="ui-g-12 ui-md-2 ui-lg-2">
                                <p:outputLabel value="#{loc.warehouse}" for="slcWareHouse2" styleClass="Fs12 FontBold"/>
                                <p:selectCheckboxMenu  id="slcWareHouse2"  value="#{invoiceProcessBean.selectedObject.listOfWarehouse}" required="true" disabled="true" filter="true" filterMatchMode="contains" converter="entityConverter" widgetVar="slc_warehouseCheckBox"  label="#{invoiceProcessBean.warehouseName.equals('') ? loc.choose : invoiceProcessBean.warehouseName}" styleClass="Wid90" >
                                    <f:selectItems value="#{invoiceProcessBean.listWarehouses}" itemLabel="#{warehouse.name}" itemValue="#{warehouse}" var="warehouse" />       
                                    <p:ajax update="slcWareHouse2" oncomplete="PF('slc_warehouseCheckBox').show()" global="false"/>
                                    <p:ajax event="toggleSelect" update="slcWareHouse2" oncomplete="PF('slc_warehouseCheckBox').show()" global="false"/>
                                </p:selectCheckboxMenu>                            
                            </div>
                        </h:panelGroup>

                      





                    </h:panelGroup>





                    <h:panelGroup rendered="#{invoiceProcessBean.selectedObject.type.id==26}">
                        <div class="ui-g-12 ui-md-4 ui-lg-2">
                            <p:outputLabel value="#{loc.invoice}" for="txtConnectedInvoice" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtConnectedInvoice" onclick="#{invoiceProcessBean.processType==1 and invoiceProcessBean.selectedObject.account.id > 0 ? 'showInvoiceBook()' : ''}" value="#{invoiceProcessBean.selectedObject.priceDifferenceInvoice.documentSerial}" class="inputPositionForBookFilter" required="true" 
                                         readonly="#{facesContext.currentPhaseId.ordinal ge 4}" placeholder="#{loc.invoice}">
                            </p:inputText>
                            <p:commandLink id="btnConnectedInvoice" rendered="#{invoiceProcessBean.processType==1 and invoiceProcessBean.selectedObject.account.id > 0}" class="commandLinkPositionForBookFilter" process="@this" oncomplete="PF('olp_invoice').loadContents();" >
                                <i class="fa fa-book Fs16 softgray iconPositionForBookFilter "/>   
                                <p:ajax listener="#{invoiceBookFilterBean.findFilterListLazyLoading([invoiceProcessBean.selectedObject],'frmInvoiceBookFilter','olp_invoice','differencepriceinvoice')}" global="false" />
                            </p:commandLink>
                        </div>
                        <div class="ui-g-12 ui-md-4 ui-lg-2">
                            <p:outputLabel value="#{loc.pricedifferencetype}" for="slcDifferenceType" styleClass="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcDifferenceType" value="#{invoiceProcessBean.selectedObject.isDifferenceDirection}" disabled="#{invoiceProcessBean.processType!=1}" required="true" >
                                <f:selectItem itemLabel="#{loc.increase}" itemValue="true"/>
                                <f:selectItem itemLabel="#{loc.decrease}" itemValue="false"/>
                            </p:selectOneMenu>
                        </div>
                    </h:panelGroup>
                    <h:panelGroup rendered="#{invoiceProcessBean.selectedObject.type.id!=26 and !invoiceProcessBean.selectedObject.isPayment and invoiceProcessBean.selectedObject.isPurchase and invoiceProcessBean.selectedObject.branchSetting.branch.isAgency and invoiceProcessBean.processType==2}">
                        <div class="ui-g-12 ui-md-6 ui-lg-2" >
                            <p:outputLabel value="#{loc.approval}" styleClass="Fs12 FontBold" />
                            <p:panelGrid layout="grid" columns="1" class="pngCheckBox">  
                                <p:selectBooleanCheckbox value="#{invoiceProcessBean.selectedObject.isWait}" itemLabel="#{loc.onstandby}" class="Fleft">
                                    <p:ajax global="false" />
                                </p:selectBooleanCheckbox>
                            </p:panelGrid>
                        </div>
                    </h:panelGroup>
                </div>

            </h:panelGroup>
        </div>
        <div class="EmptyBox10"></div>
        <p:remoteCommand name="showBook" process="@this" oncomplete="PF('olp_account').loadContents();" actionListener="#{accountBookFilterBean.findFilterListLazyLoading([invoiceProcessBean.selectedObject.branchSetting.branch],'frmAccountBookFilter','olp_account','invoice')}" global="false" />
        <p:remoteCommand name="goToRelatedRecord" actionListener="#{invoicePaymentsTabBean.goToRelatedRecord()}" delay="200"/>
        <p:remoteCommand name="saveChangingRecord" actionListener="#{invoiceProcessBean.confirmSave()}" delay="200"/>
        <p:remoteCommand name="showInvoiceBook" process="@this" oncomplete="PF('olp_invoice').loadContents();" actionListener="#{invoiceBookFilterBean.findFilterListLazyLoading([invoiceProcessBean.selectedObject],'frmInvoiceBookFilter','olp_invoice','differencepriceinvoice')}" global="false" />
        <p:remoteCommand name="goToRelatedRecordInvoice" actionListener="#{invoiceProcessBean.goToRelatedRecord()}" delay="200"/>
    </h:form> 


    <p:tabView id="tbvInvoice" activeIndex="#{marwiz.tabIndex}" rendered="#{invoiceProcessBean.processType==2 and (invoiceProcessBean.getRendered(1, 1) or invoiceProcessBean.getRendered(2, 1)
                                              or invoiceProcessBean.getRendered(3, 1) or invoiceProcessBean.getRendered(4, 1))}" scrollable="true" cache="true"  dynamic="true">
        <p:ajax event="tabChange" listener="#{invoiceProcessBean.onTabChange}" update="pngStockBook tbvInvoice"/>

        <p:tab id="tab1" title="#{loc.stocks}" rendered="#{invoiceProcessBean.getRendered(1, 1)}">
            <c:if test="#{invoiceProcessBean.selectedObject.type.id != 26}" >
                <ui:include src="/pages/finance/invoice/invoicestocktab.xhtml"/>
            </c:if>
            <c:if test="#{invoiceProcessBean.selectedObject.type.id == 26}" >
                <ui:include src="/pages/finance/invoice/invoicepricedifferencestocktab.xhtml"/>
            </c:if>
        </p:tab>

        <p:tab id="tab2" title="#{loc.relatedrecords}" rendered="#{invoiceProcessBean.getRendered(2, 1)}">
            <c:if test="#{invoiceProcessBean.activeIndex==2}" >
                <ui:include src="/pages/finance/invoice/relatedrecordstab.xhtml"/>
            </c:if>
        </p:tab>

        <p:tab id="tab3" title="#{invoiceProcessBean.selectedObject.isPurchase==true and invoiceProcessBean.selectedObject.type.id ==26 and invoiceProcessBean.selectedObject.isDifferenceDirection ? loc.payments
                                  : invoiceProcessBean.selectedObject.isPurchase==true and invoiceProcessBean.selectedObject.type.id ==26 and !invoiceProcessBean.selectedObject.isDifferenceDirection ? loc.recoveries
                                  : invoiceProcessBean.selectedObject.isPurchase==false and invoiceProcessBean.selectedObject.type.id ==26 and invoiceProcessBean.selectedObject.isDifferenceDirection ? loc.recoveries
                                  : invoiceProcessBean.selectedObject.isPurchase==false and invoiceProcessBean.selectedObject.type.id ==26 and !invoiceProcessBean.selectedObject.isDifferenceDirection ? loc.payments
                                  : invoiceProcessBean.selectedObject.isPurchase == false and invoiceProcessBean.selectedObject.type.id != 27 ? loc.recoveries 
                                  : invoiceProcessBean.selectedObject.isPurchase == true and invoiceProcessBean.selectedObject.type.id != 27 ? loc.payments 
                                  : invoiceProcessBean.selectedObject.isPurchase == false and invoiceProcessBean.selectedObject.type.id == 27 ? loc.payments
                                  : invoiceProcessBean.selectedObject.isPurchase == true and invoiceProcessBean.selectedObject.type.id == 27 ? loc.recoveries 
                                  : ''}" rendered="#{invoiceProcessBean.getRendered(3, 1)}">
            <c:if test="#{invoiceProcessBean.activeIndex==3}" >
                <ui:include src="/pages/finance/invoice/invoicepaymentstab.xhtml"/>
            </c:if>
        </p:tab>

        <p:tab id="tab4" title="#{loc.history}" rendered="#{invoiceProcessBean.getRendered(4, 1)}">
            <c:if test="#{invoiceProcessBean.activeIndex==4}">
                <ui:include src="/pages/general/common/historydatatable.xhtml" >
                    <ui:param name="bean" value='#{historyTabBean}' />
                    <c:set var="createdPerson" value='#{invoiceProcessBean.selectedObject.userCreated.fullName}- #{invoiceProcessBean.selectedObject.userCreated.username }' scope="request"/>
                    <c:set var="createdTime" value='#{sessionBean.convertDateTime(invoiceProcessBean.selectedObject.dateCreated)}'  scope="request"/>
                    <c:set var="rowId" value="#{invoiceProcessBean.selectedObject.id}" scope="request" /> 
                    <c:set var="tableName" value="finance.invoice" scope="request"/>
                    <c:set var="renderedOutput" value="true" scope="request"/>
                    <c:set var="renderedFilter" value="true" scope="request"/>
                </ui:include> 
            </c:if>
        </p:tab> 
    </p:tabView>


    <h:panelGroup id="pngAccountBook">
        <!-- fatura sayfasında hızlı cari eklemek ve cari değiştirmek için -->
        <ui:include src="/pages/general/common/accountbook.xhtml" >
            <ui:param name="updateBean" value='#{invoiceProcessBean}' />
            <ui:param name="for" value="#{invoiceProcessBean.isChangeInfoDialog ? 'frmChangeInvoiceInfo:btnChangeAccount' : 'frmInvoiceProcess:btnAccountName'}" />
            <ui:param name="type" value='invoice' />
            <ui:param name="parameters" value='#{[invoiceProcessBean.selectedObject.branchSetting.branch]}' /> 
            <ui:param name="columnsize" value='3' /> 
            <ui:param name="form" value='frmAccountBookFilter' /> 
            <ui:param name="overlay" value="olp_account" />
        </ui:include>
    </h:panelGroup>

    <h:panelGroup id="pngStockBook">
        <c:if test="#{invoiceProcessBean.activeIndex==1}" >
            <!-- kitaptan hızlı stok secme ve eklemek için-->
            <ui:include src="/pages/general/common/stockbook.xhtml" >
                <ui:param name="updateBean" value='#{invoiceItemTabBean}' />
                <ui:param name="for" value='frmInvoiceStokProcess:btnStock' />
                <ui:param name="type" value="#{invoiceItemTabBean.bookType}" />
                <ui:param name="parameters" value="#{[invoiceItemTabBean.selectedInvoice]}" /> 
                <ui:param name="columnsize" value="#{invoiceItemTabBean.selectedInvoice.isFuel ? '4' : '5'}"/> 
                <ui:param name="form" value='frmStockBookFilter' /> 
                <ui:param name="overlay" value="olp_stock" />
                <ui:param name="renderedNumberColumn" value="true" />
            </ui:include>
        </c:if>
    </h:panelGroup>

    <!--Stok tabında yeni stok eklemek ve update yapmak için açılan dialog !!! Sadece irsaliyeli faturalar için -->
    <p:dialog id="dlgStockProcess" widgetVar="dlg_StockProcess" resizable="false" focus="dlgStockProcess" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="70%" >
        <ui:include src="invoicestockprocess.xhtml"/>
    </p:dialog> 

    <!--Stok tabında yeni stok eklemek ve update yapmak için açılan dialog -->
    <p:dialog id="dlgPaymentProcess" widgetVar="dlg_PaymentProcess" resizable="false" focus="dlgPaymentProcess" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="70%" >
        <c:if test="#{invoiceProcessBean.activeIndex==3}" >
            <ui:include src="invoicepaymentprocess.xhtml"/>
        </c:if>
    </p:dialog> 

    <!--Stok tabında yeni stok eklemek ve update yapmak için açılan dialog  !!! İrsaliyeli faturalar dışında bu dialog açılır-->
    <p:dialog id="dlgWaybillStock" widgetVar="dlg_waybillstock" resizable="false" focus="dlgWaybillStock" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="40%" >
        <ui:include src="invoicewaybillstockprocess.xhtml"/>
    </p:dialog> 

    <!--Stok tabında fatura e-faturadan gelmiş ise e-fatura stok bilgilerini göstermek için açılan dialog-->
    <p:dialog id="dlgEInvoiceStock" widgetVar="dlg_eInvoiceStock" resizable="false" focus="dlgEInvoiceStock" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="40%" >
        <ui:include src="einvoiceinformation.xhtml"/>
    </p:dialog> 


    <!-- Faturanın TL cinsindeki iskontosu değiştiğinde birim fiyatlarındaki değişiklikleri gösteren dialog -->
    <p:dialog id="dlgDiscountChangeDialog" widgetVar="dlg_discountchangedialog" resizable="false" focus="dlgDiscountChangeDialog" 
              responsive="true" dynamic="true" modal="true" closable="false" closeOnEscape="false" width="50%" >
        <p:ajax event="close" listener="#{invoiceItemTabBean.init()}" global="true"  />
        <h:form id="frmDiscountChangeDialog">
            <p:toolbar>
                <f:facet name="left">
                    <h:outputText value="#{loc.productprocesses}" class="outputTextFont Fleft MarRight8"/>
                </f:facet>

                <f:facet name="right">
                    <p:commandLink id="btnClose" title="#{loc.close}" class="Fright" onclick="PF('dlgDiscountChangeList').show();" >
                        <i class="fa fa-close Fs23 MarTop2 " style="color: #dc1f1f !important;"/>                 
                    </p:commandLink> 
                </f:facet>
                <f:facet name="right">
                    <p:commandLink id="btnSave" title="#{loc.save}" class="Fright" onclick="PF('dlgDiscountChangeSure').show();" oncomplete="PF('dlg_purchasecontrolinformation').hide();" >
                        <i class="fa fa-save Fs20 MarTop5 tlbrSaveBtn" />                 
                    </p:commandLink> 
                </f:facet>
            </p:toolbar>
            <div class="ui-g-12 divContent" >
                <h:panelGrid columns="3" class="MarLeft5">
                    <i class="fa fa-warning Fs18 TexAlLeft MarLeft5" style="color:#125aa7 !important;border: transparent !important;"></i>
                    <h:outputText value="#{loc.warning} :" class="Fs16 FontBold" style="border: transparent !important;"/> <!---->
                    <h:outputText value=" #{loc.changesinprofitabilityweredetermined}" style="border: transparent !important;" />
                </h:panelGrid>
                <p:dataTable id="dtbStock" editable="true" editMode="cell" var="item" value="#{invoiceItemTabBean.listOfObjects}" widgetVar="invoiceItemPF" rowKey="#{item.id}" 
                             emptyMessage="#{loc.norecordsfound}" class="tabDatatable" rows="#{sessionBean.user.defualtGridSize}" 
                             paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                             rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" 
                             >

                    <p:ajax event="cellEdit" listener="#{invoiceItemTabBean.onCellEditPrice}" oncomplete="document.getElementById('frmDiscountChangeDialog:updateDiscountChange').click();" global="false"/> 

                    <p:column  headerText="#{loc.stockname}"   >
                        <h:outputText value="#{item.stock.name}" />
                    </p:column>
                    <p:column  headerText="#{loc.oldpurchaseprice}"  >
                        <h:outputText value="#{item.totalPrice/item.quantity}" style="float: right;">
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{item.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>
                    <p:column headerText="#{loc.newpurchaseprice}"  >
                        <h:outputText value="#{item.unitPrice}" style="float: right;">
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{item.currency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>
                    <p:column  headerText="#{loc.formerprofitability}"  >
                        <h:outputText value="#{item.oldProfitPercentage}" style="float: right;">
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="percent" />
                        </h:outputText>
                    </p:column>
                    <p:column  headerText="#{loc.lastsaleprice}"  >
                        <h:outputText value="#{item.stock.stockInfo.currentSalePrice}" style="float: right;">
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value="#{item.stock.stockInfo.currentSaleCurrency}"/>
                            <f:attribute name="type" value="currency" />
                        </h:outputText>
                    </p:column>
                    <p:column  headerText="#{loc.recomendedsalesprice}" >
                        <p:cellEditor >
                            <f:facet name="output">
                                <h:outputText value="#{item.recommendedPrice}" style="float: right;">
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{item.stock.stockInfo.currentSaleCurrency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputNumber value="#{item.recommendedPrice}" class="editableinput"
                                               decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="0"
                                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                               decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                               roundMethod="D" emptyValue=""/>  
                            </f:facet>
                        </p:cellEditor>
                    </p:column>

                    <p:column  headerText="#{loc.newprofitability}"  >
                        <i class="#{item.newProfitPercentage==item.oldProfitPercentage ? 'fa fa-arrow-right' :(item.newProfitPercentage>item.oldProfitPercentage ? 'fa fa-arrow-up' : 'fa fa-arrow-down')}" 
                           style="#{item.newProfitPercentage==item.oldProfitPercentage ? 'color: black' :(item.newProfitPercentage>item.oldProfitPercentage ? 'color: green' : 'color: red')}">
                        </i>
                        <h:outputText value="#{item.newProfitPercentage}" style="#{item.newProfitPercentage==item.oldProfitPercentage ? 'float: right;color: black;' :(item.newProfitPercentage>item.oldProfitPercentage ? 'float: right;color: green' : 'float: right;color: red')}">
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="percent" />
                        </h:outputText>
                    </p:column>

                </p:dataTable>
                <p:commandButton id="updateDiscountChange" style="display: none"  process="@this" update="frmDiscountChangeDialog:dtbStock" global="false"/>
            </div>
        </h:form>
    </p:dialog> 

    <!-- Önerilen satış fiyatı değiştirildiğinde kaydetmek istiyormusun sorusunu sorar -->
    <p:confirmDialog class="deleteConfirm" global="true" widgetVar="dlgDiscountChangeSure" closable="false" width="20%" showEffect="fade" hideEffect="fade"  responsive="true">
        <f:facet name="message">
            <h:outputText value="#{loc.areyousurewanttoupdatethesalespricelist}">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
        </f:facet>
        <p:commandButton action="#{invoiceItemTabBean.saveNewSalePrice()}" onclick="PF('dlgDiscountChangeSure').hide()"  process="@this" value="#{loc.yes}"  styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white" />
        <p:commandButton value="#{loc.no}" process="@this" onclick="PF('dlgDiscountChangeSure').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>

    <!-- Önerilen satış fiyatı değiştirildiğinde kaydetmek istiyormusun sorusunu sorar -->
    <p:confirmDialog class="deleteConfirm" global="true" widgetVar="dlgDiscountChangeList" closable="false" width="20%" showEffect="fade" hideEffect="fade"  responsive="true">
        <f:facet name="message">
            <h:outputText value="#{loc.areyousureyouwanttoexitwithoutupdatingthesalespricelist}">
                <i class="icon-trash Fs20 tlbrDeleteBtn" /> 
            </h:outputText>
        </f:facet>
        <p:commandButton onclick="PF('dlgDiscountChangeList').hide()" oncomplete="PF('dlg_discountchangedialog').hide()" process="@this" value="#{loc.yes}"  styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white" />
        <p:commandButton value="#{loc.no}" process="@this" onclick="PF('dlgDiscountChangeList').hide()"  styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
    </p:confirmDialog>

    <!--Stok fiyat kontrol diyaloğu-->
    <p:dialog id="dlgPurchaseControlInformation" widgetVar="dlg_purchasecontrolinformation" resizable="false" focus="dlgPurchaseControlInformation" 
              responsive="true" dynamic="true" modal="true" closable="true"
              closeOnEscape="true" width="35%" >
        <p:ajax event="close" global="false" listener="#{invoiceItemTabBean.updateTable()}" />
        <h:form id="frmPurchaseControlInformation">
            <p:toolbar>
                <f:facet name="left">
                    <h:outputText value="#{loc.productinsertionwarning}" class="outputTextFont Fleft MarRight8"/> <!---->
                </f:facet>

            </p:toolbar>
            <div class="ui-g divContent" >
                <h:panelGroup layout="grid" class="MarLeft5" >
                    <i class="fa fa-warning Fs18 TexAlLeft MarLeft5" style="color:#125aa7 !important;border: transparent !important;"></i>
                    <h:outputText value=" " class="Fs16 FontBold" style="border: transparent !important;"/> <!---->
                    <h:outputText value="#{loc.warning} :" class="Fs16 FontBold" style="border: transparent !important;"/> <!---->
                    <h:outputText value=" #{loc.changesinprofitabilityweredetermined}" style="border: transparent !important;" />
                </h:panelGroup>
                <div class="EmptyBox20"></div>

                <h:panelGroup rendered="#{invoiceItemTabBean.isThereCurrentPurchasePrice}">
                    <!-- son alış ve son satış fiyatlarının listelendiği tablo -->
                    <table class="tableUp" >
                        <thead>
                            <tr>
                                <th scope="col" class="Fs14 TexAlCenter" style="background-color: #cfd8dc;"><h:outputText value="#{loc.lastpurchaseprice}(#{loc.withtax})" style="color:#4c4b4b;"/> </th>
                                <th scope="col" class="Fs14 TexAlCenter" style="background-color: #cfd8dc;"><h:outputText value="#{loc.lastsaleprice} (#{loc.withtax})" style="color:#4c4b4b;"/></th>
                                <th scope="col" class="Fs14 TexAlCenter" style="background-color: #cfd8dc;"><h:outputText value="% #{loc.profit}" style="color:#4c4b4b;" /></th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>
                                <td style=" text-align: center;"> <h:outputText value="#{invoiceItemTabBean.purchaseControlStock.stockInfo.currentPurchasePrice}" >
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoiceItemTabBean.purchaseControlStock.stockInfo.currentPurchaseCurrency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </td>
                                <td style=" text-align: center;"> <h:outputText value="#{invoiceItemTabBean.purchaseControlStock.stockInfo.currentSalePrice}">
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoiceItemTabBean.purchaseControlStock.stockInfo.currentSaleCurrency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </td>
                                <td style=" text-align: center;">  <h:outputText value="#{invoiceItemTabBean.currentProfitRate}">
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value=""/>
                                        <f:attribute name="type" value="percent" />
                                    </h:outputText>
                                </td>

                            </tr>
                        </tbody>
                    </table>

                    <div class="EmptyBox10" />
                    <!-- şuanki  alış ve şuanki satış fiyatlarının listelendiği tablo -->
                    <table class="tableUp" >
                        <thead>
                            <tr>
                                <th scope="col" class="Fs14 TexAlCenter" style="background-color: #cfd8dc;"><h:outputText value="#{loc.currentpurchaseprice} (#{loc.withtax})" style="color:#4c4b4b;"/> </th>
                                <th scope="col" class="Fs14 TexAlCenter" style="background-color: #cfd8dc;"><h:outputText value="#{loc.recomendedsalesprice} (#{loc.withtax})" style="color:#4c4b4b;"/></th>
                                <th scope="col" class="Fs14 TexAlCenter" style="background-color: #cfd8dc;"><h:outputText value=" % #{loc.profit}" style="color:#4c4b4b;" /></th>
                            </tr>
                        </thead>

                        <tbody>
                            <tr>

                                <td style=" text-align: center;"> <h:outputText value="#{invoiceItemTabBean.currentPurchasePrice}">
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoiceItemTabBean.selectedObject.currency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </td>
                                <td style=" text-align: center;"> <h:outputText value="#{invoiceItemTabBean.stockRecomendedPrice}" >
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoiceItemTabBean.selectedObject.currency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </td>
                                <td style=" text-align: center;">  <h:outputText value="#{invoiceItemTabBean.currentProfitRate}">
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value=""/>
                                        <f:attribute name="type" value="percent" />
                                    </h:outputText>
                                </td>
                            </tr>
                        </tbody>
                    </table>

                    <div class="EmptyBox20"/>

                </h:panelGroup>

                <h:panelGroup >
                    <div class="ui-g-12" >   
                        <p:toolbar id="tlbUpdateStockPrice">
                            <f:facet name="left">
                                <p:commandLink id="btnAdd" actionListener="#{invoiceItemQuickAddBean.createDialog(invoiceItemTabBean.selectedObject.stock)}" resetValues="true" rendered="#{(invoiceItemTabBean.listOfPriceListItem==null or invoiceItemTabBean.listOfPriceListItem.isEmpty()) and invoiceItemQuickAddBean.getRendered(142, 0)}" 
                                               title="#{loc.new}" class="Fleft" process="@this" >
                                    <i class="icon-plus tlbrAddBtn Fs20"  />
                                </p:commandLink>  
                                <h:outputText value="#{loc.updatesalesunitprice}" class="outputTextFontTab Fleft MarRight8"/> <!---->
                            </f:facet>
                            <f:facet name="right">
                                <p:commandLink id="btnSave" title="#{loc.save}" class="Fright" rendered="#{invoiceItemQuickAddBean.getRendered(143, 0)}"  actionListener="#{invoiceItemQuickAddBean.save()}" oncomplete="PF('dlg_purchasecontrolinformation').hide();" >
                                    <i class="fa fa-save Fs20 MarTop5 tlbrSaveBtn"/>                 
                                </p:commandLink> 
                            </f:facet>
                        </p:toolbar>

                        <p:dataTable id="dtbStock" editable="true" editMode="cell" var="PriceListItem" value="#{invoiceItemTabBean.listOfPriceListItem}"  widgetVar="stockPF"
                                     rowKey="#{PriceListItem.id}" emptyMessage="#{loc.norecordsfound}" class="tabDatatable" resizableColumns="true" 
                                     currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" rowsPerPageTemplate="#{sessionBean.user.gridSize}" rows="#{sessionBean.user.defualtGridSize}">

                            <p:ajax event="cellEdit" listener="#{invoiceItemQuickAddBean.onCellEditPriceList}" oncomplete="updateDatatable()" global="false"/>

                            <p:column id="clmPrice" headerText="#{loc.price}" >
                                <p:cellEditor>
                                    <f:facet name="output">
                                        <h:outputText value="#{PriceListItem.price}" style="float: right" >
                                            <f:converter converterId="currencyConverter" />
                                            <f:attribute name="type" value="" />
                                            <f:attribute name="currency" value="#{sessionBean.user.lastBranch.currency}"/>
                                        </h:outputText>
                                    </f:facet>
                                    <f:facet name="input">
                                        <p:inputNumber value="#{PriceListItem.price}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                                       decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="0"
                                                       thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                                       decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                                       roundMethod="D" emptyValue=""/>  
                                    </f:facet>
                                </p:cellEditor>

                            </p:column>

                            <p:column id="clmCurrency" headerText="#{loc.currency}">

                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{PriceListItem.currency.tag}" /></f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{PriceListItem.currency.id}" style="width:50%">
                                            <f:selectItems value="#{sessionBean.currencies}" var="currency" itemLabel="#{currency.nameMap.get(sessionBean.langId).name}" itemValue="#{currency.id}" />
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>
                            <p:column id="clmIsTaxIncluded" headerText="#{loc.istaxincluded}" sortBy="#{PriceListItem.is_taxIncluded}" sortable="true" filterable="true"  filterBy="#{PriceListItem.is_taxIncluded}" filterMatchMode="contains">
                                <f:facet name="filter">
                                    <p:outputLabel   rendered="false" />
                                </f:facet>
                                <p:cellEditor>
                                    <f:facet name="output"><h:outputText value="#{PriceListItem.is_taxIncluded ? loc.yes : loc.no}" /></f:facet>
                                    <f:facet name="input">
                                        <h:selectOneMenu value="#{PriceListItem.is_taxIncluded}" style="width:50%">
                                            <f:selectItem itemLabel="#{loc.no}" itemValue="false" />
                                            <f:selectItem itemLabel="#{loc.yes}" itemValue="true" />
                                        </h:selectOneMenu>
                                    </f:facet>
                                </p:cellEditor>
                            </p:column>

                            <p:column id="clmProfitRate" headerText="#{loc.profit} - #{loc.damage}" rendered="#{invoiceItemTabBean.isThereCurrentPurchasePrice}">

                                <h:outputText id="deneme" value="% #{PriceListItem.profitRate}" style="float: right" />

                            </p:column>

                        </p:dataTable>
                        <p:commandButton id="updateDatatable" style="display: none"  process="@this" update="frmPurchaseControlInformation" global="false"/>

                    </div>
                </h:panelGroup>
                <div class="EmptyBox20"></div>
            </div>

        </h:form>
    </p:dialog> 

    <!-- Fiyat listesine hızlı ürün eklemek için -->
    <p:dialog id="dlgPriceListProcess" widgetVar="dlg_pricelistprocess" resizable="false" focus="dlgPriceListProcess" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="30%" height="50%">
        <h:form id="frmPriceListStockProcess">
            <ui:include src="/pages/general/common/processtoolbar.xhtml" >
                <ui:param name="outputtext" value="#{loc.pricelistprocesses}"/>
                <ui:param name="bean" value='#{invoiceItemQuickAddBean}' />
                <ui:param name="update" value="grdPriceListProcess" />
                <ui:param name="btnSaveId" value="#{invoiceItemQuickAddBean.getRendered(143, 0)}" />    
            </ui:include>
            <h:panelGroup id="grdPriceListProcess" layout="block">

                <div class="ui-g-12 divContent">
                    <div class="ui-g-12 ui-md-6 ui-lg-3">     
                        <p:outputLabel value="#{loc.stock}" for="txtStock" class="Fs12 FontBold"/>
                        <p:inputText id="txtStock" value="#{invoiceItemQuickAddBean.selectedObject.stock.name}" class="inputPositionForBookFilter" required="true" readonly="#{facesContext.currentPhaseId.ordinal ge 4}"  placeholder="#{loc.stock} ">
                        </p:inputText>
                    </div> 
                    <div class="ui-g-12 ui-md-6 ui-lg-3"> 
                        <p:outputLabel value="#{loc.price}" for="txtPrice" class="Fs12 FontBold"/>
                        <p:inputNumber id="txtPrice" value="#{invoiceItemQuickAddBean.selectedObject.price}" minValue="0"
                                       decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}" thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}" 
                                       roundMethod="D"  symbolPosition="#{sessionBean.locale=='tr' ? 'p': 's'}"
                                       required="true" class="Wid90 TexAlRight" placeholder="#{loc.price}" >                 
                        </p:inputNumber>
                    </div>
                    <div class="ui-g-12 ui-md-6 ui-lg-3">     
                        <p:outputLabel value="#{loc.currency}" for="slcCurrency" class="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcCurrency" value="#{invoiceItemQuickAddBean.selectedObject.currency.id}" required="true" styleClass="Wid95">
                            <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true"/>
                            <f:selectItems value="#{sessionBean.currencies}" var="currency" itemLabel="#{currency.nameMap.get(sessionBean.langId).name}" itemValue="#{currency.id}" />
                            <p:ajax global="false" listener="#{invoiceItemQuickAddBean.bringTagOfCurrency()}"/>
                        </p:selectOneMenu>
                    </div> 
                    <div class="ui-g-12 ui-md-6 ui-lg-3">     
                        <p:outputLabel value="#{loc.istaxincluded}" for="slcIsTaxIncluded" class="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcIsTaxIncluded" value="#{invoiceItemQuickAddBean.selectedObject.is_taxIncluded}" required="true">
                            <f:selectItem itemLabel="#{loc.no}" itemValue="false" />
                            <f:selectItem itemLabel="#{loc.yes}" itemValue="true" />
                        </p:selectOneMenu>
                    </div> 

                </div>
            </h:panelGroup>
        </h:form>
    </p:dialog>

    <!--Hızlı Stok Ekleme Dialogu-->
    <p:dialog id="dlgQuickAddProduct" widgetVar="dlg_quickaddproduct" resizable="false" focus="dlgQuickAddProduct" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="45%" height="50%">
        <h:panelGroup id="frmQuickAddProduct">
            <p:toolbar>
                <f:facet name="left">
                    <h:outputText value="#{loc.quickaddproduct}" class="outputTextFont Fleft MarRight8 MarTop4"/> 
                </f:facet>
                <f:facet name="right">
                    <p:commandLink id="btnSave"  title="#{loc.save}" actionListener="#{invoiceItemTabBean.createInvoiceProductItem()}" rendered="#{invoiceItemTabBean.listOfProduct.size()>0}" class="Fleft MarTop4" >
                        <i class="fa fa-save tlbrSaveBtn Fs20" />
                    </p:commandLink>  
                </f:facet>
            </p:toolbar>


            <div class="ui-g-12 divContent">
                <h:form id="frmSaveData" prependId="false">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <p:defaultCommand target="btnSaveData"/> 
                        <p:focus for="txtStockBarcode"/>

                        <div class="ui-g-6 ui-md-6 ui-lg-4">
                            <p:outputLabel value="#{loc.barcode}" for="txtStockBarcode" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtStockBarcode" tabindex="1"  value="#{invoiceItemTabBean.selectedStock.stock.barcode}" placeholder="#{loc.barcode}">
                            </p:inputText>
                        </div>



                        <div class="ui-g-12 ui-md-6 ui-lg-4">
                            <p:outputLabel value="#{loc.amount}"  for="txtStockAmount" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtStockAmount" tabindex="2" onfocus="this.value = ''" value="#{invoiceItemTabBean.selectedStock.quantity}" class="Wid95"  placeholder="#{loc.amount}">
                                <p:keyFilter regEx ="/[0-9]/"/>
                            </p:inputText> 
                        </div>

                        <h:panelGroup  rendered="#{invoiceItemTabBean.selectedStock.isDiscountRate}" >
                            <div class="ui-g-12 ui-md-6 ui-lg-4">
                                <p:outputLabel value="#{loc.discountrate}" for="txtDiscountRate" styleClass="Fs12 FontBold"/>
                                <p:commandLink id="cmdDiscountRate" resetValues="true" process="@this" global="false" title="#{loc.discountamount}" actionListener="#{invoiceItemTabBean.discountPriceOrRateFromQuickAdd(1)}" update="frmSaveData"  >
                                    <i class="fa fa-refresh Fs14 tlbrAddBtn"/>   
                                    <f:setPropertyActionListener target="#{invoiceItemTabBean.selectedStock.isDiscountRate}" value="false" />
                                </p:commandLink>
                                <p:inputNumber id="txtDiscountRate" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  tabindex="3"
                                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                               roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"  symbol="%" symbolPosition="s"
                                               value="#{invoiceItemTabBean.selectedStock.discountRate}" maxValue="100" minValue="0" class="Wid95 TexAlRight"  placeholder="#{loc.discountrate}" >
                                </p:inputNumber>

                            </div> 
                        </h:panelGroup>
                        <h:panelGroup  rendered="#{!invoiceItemTabBean.selectedStock.isDiscountRate}" >
                            <div class="ui-g-12 ui-md-6 ui-lg-4">

                                <p:outputLabel value="#{loc.discountamount}" for="txtDiscountPrice" styleClass="Fs12 FontBold"/>
                                <p:commandLink id="cmdDiscountPrice" resetValues="true" process="@this" global="false" title="#{loc.discountrate}" actionListener="#{invoiceItemTabBean.discountPriceOrRateFromQuickAdd(0)}" update="frmSaveData" class="TextDecNone" >
                                    <i class="fa fa-refresh Fs14 tlbrAddBtn"/>  
                                    <f:setPropertyActionListener target="#{invoiceItemTabBean.selectedStock.isDiscountRate}" value="true" />
                                </p:commandLink>
                                <p:inputNumber id="txtDiscountPrice" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  tabindex="3"
                                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                               roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}" symbol="#{sessionBean.currencySignOrCode(invoiceItemTabBean.selectedObject.getCurrency().getId(),0)}" symbolPosition="s"
                                               value="#{invoiceItemTabBean.selectedStock.discountPrice}"  class="Wid95 TexAlRight"  placeholder="#{loc.discountamount}" >
                                </p:inputNumber>
                            </div> 
                        </h:panelGroup>


                        <p:commandLink id="btnSaveData"  title="#{loc.save}" style="visibility: hidden;" actionListener="#{invoiceItemTabBean.saveData}" global="false" class="Fleft" >
                            <i class="fa fa-save tlbrAddBtn Fs20" />
                        </p:commandLink>  
                    </div>
                </h:form>


                <h:panelGroup rendered="#{invoiceItemTabBean.listOfProduct.size()>0}" >
                    <div class="#{invoiceItemTabBean.listOfProduct.size()>0 ? 'EmptyBox5': ''}" />
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:form id="frmUpdate">
                            <div style="overflow-y: auto !important;max-height: 300px !important;">
                                <c:forEach items="#{invoiceItemTabBean.listOfProduct}" var="product"> 
                                    <div class="ui-g-12">

                                        <div class="ui-g-12 ui-md-5 ui-lg-2">
                                            <h:outputText value="#{loc.barcode}"  class="outputTextFont Fleft MarRight8"/>
                                            <p:inputText id="txt#{product.id}#{product.stock.id}" disabled="true" onchange="document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();" onkeypress="if (event.keyCode == 13) {
                                                        document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();
                                                        return false;
                                                    }" value="#{product.stock.barcode}"  placeholder="#{loc.barcode}">
                                            </p:inputText>
                                        </div>

                                        <div class="ui-g-12 ui-md-5 ui-lg-3">
                                            <h:outputText value="#{loc.stock}"  class="outputTextFont Fleft MarRight8"/>
                                            <p:inputText id="txtStock#{product.id}#{product.stock.id}" disabled="true" onchange="document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();" onkeypress="if (event.keyCode == 13) {
                                                        document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();
                                                        return false;
                                                    }" value="#{product.stock.name}"  placeholder="#{loc.stock}">
                                            </p:inputText>
                                        </div> 

                                    <!--    <h:panelGroup rendered="#{invoiceItemTabBean.selectedInvoice.isFuel and invoiceItemTabBean.selectedInvoice.type.id == 59}">
                                            <div class="ui-g-12 ui-md-6 ui-lg-2">
                                                <p:outputLabel value="#{loc.warehouse}" for="slcWarehouse" styleClass="Fs12 FontBold"/>
                                                <p:selectOneMenu id="slcWarehouse" disabled="#{invoiceItemTabBean.processType==2 or !invoiceItemTabBean.isListFuelWarehouse}" value="#{product.warehouse.id}" required="true" >
                                                    <f:selectItem itemLabel="#{loc.choose}" itemValue="0"  itemDisabled="true"/>
                                                    <f:selectItems value="#{invoiceItemTabBean.listOfFuelWarehouse}"  var="warehouse" itemLabel="#{warehouse.name}" itemValue="#{warehouse.id}" />
                                                </p:selectOneMenu>
                                            </div>
                                        </h:panelGroup> -->

                                        <div class="ui-g-12 ui-md-5 ui-lg-2">
                                            <h:outputText value="#{loc.amount}"  class="outputTextFont Fleft MarRight8" />
                                            <p:inputText id="txtAmount#{product.id}#{product.stock.id}" onchange="document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();" onkeypress="if (event.keyCode == 13) {
                                                        document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();
                                                        return false;
                                                    }" value="#{product.quantity}" class="Wid95"  placeholder="#{loc.amount}">
                                                <p:keyFilter regEx ="/[0-9]/"/>
                                            </p:inputText> 
                                        </div>



                                        <h:panelGroup id="pgrDiscountRate"  rendered="#{product.isDiscountRate}" >
                                            <div class="ui-g-12 ui-md-6 ui-lg-2">
                                                <p:outputLabel value="#{loc.discountrate}" for="txtDiscountRate" styleClass="outputTextFont Fleft MarRight8"/>
                                                <p:commandLink id="cmdDiscountRate#{product.id}#{product.stock.id}" resetValues="true" process="@this" global="false" title="#{loc.discountamount}" actionListener="#{invoiceItemTabBean.discountPriceOrRateFromQuickAdd(1)}"  >
                                                    <i class="fa fa-refresh Fs14 tlbrAddBtn"/>      
                                                    <f:setPropertyActionListener target="#{product.isDiscountRate}" value="false" />
                                                    <p:ajax global="false" listener="#{invoiceItemTabBean.calcDiscountFromQuickAdd()}"/>
                                                </p:commandLink>   
                                                <p:inputNumber id="txtDiscountRate#{product.id}#{product.stock.id}"  decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                                               roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"  symbol="%" symbolPosition="s" onkeypress="if (event.keyCode == 13) {
                                                                           document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();
                                                                           return false;
                                                                       }"
                                                               value="#{product.discountRate}" class="Wid97 TexAlRight" maxValue="100" minValue="0"  placeholder="#{loc.price}" required="true">
                                                    <p:ajax event="blur" oncomplete="document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();" />
                                                </p:inputNumber>

                                            </div> 
                                        </h:panelGroup>     
                                        <h:panelGroup id="pgrDiscountPrice" rendered="#{!product.isDiscountRate}" >
                                            <div class="ui-g-12 ui-md-6 ui-lg-2">
                                                <p:outputLabel value="#{loc.discountamount}" for="txtDiscountPrice" styleClass="outputTextFont Fleft MarRight8"/>  
                                                <p:commandLink id="cmdDiscountPrice#{product.id}#{product.stock.id}" resetValues="true" process="@this" global="false" title="#{loc.discountrate}" actionListener="#{invoiceItemTabBean.discountPriceOrRateFromQuickAdd(0)}" class="TextDecNone" >
                                                    <i class="fa fa-refresh Fs14 tlbrAddBtn"/>  
                                                    <f:setPropertyActionListener target="#{product.isDiscountRate}" value="true" />
                                                    <p:ajax global="false" listener="#{invoiceItemTabBean.calcDiscountFromQuickAdd()}"/>
                                                </p:commandLink>                                                      
                                                <p:inputNumber id="txtDiscountPrice#{product.id}#{product.stock.id}"  decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                                               roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                                               symbol="#{sessionBean.currencySignOrCode(product.getCurrency().getId(),0)}"
                                                               symbolPosition="s" onkeypress="if (event.keyCode == 13) {
                                                                           document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();
                                                                           return false;
                                                                       }"
                                                               value="#{product.discountPrice}" class="Wid97 TexAlRight"  placeholder="#{loc.price}" required="true">
                                                    <p:ajax event="blur" oncomplete="document.getElementById('frmUpdate:btnUpdate#{product.id}#{product.stock.id}').click();" />
                                                </p:inputNumber>

                                            </div> 
                                        </h:panelGroup>

                                        <div class="ui-g-12 ui-md-5 ui-lg-2">
                                            <h:outputText value="#{loc.price}"  class="outputTextFont Fleft MarRight8"/>
                                            <p:inputNumber id="txtPrice#{product.id}#{product.stock.id}" disabled="#{(!invoiceItemTabBean.selectedInvoice.isPurchase and product.stock.stockInfo.saleMandatoryPrice!=null) or (invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency and !sessionBean.user.isAuthorized)}" decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  
                                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? ',': '.'}" 
                                                           roundMethod="D" decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                                           symbol="#{sessionBean.currencySignOrCode(product.getCurrency().getId(),0)}"
                                                           symbolPosition="s" onkeypress="if (event.keyCode == 13) {
                                                                       document.getElementById('frmUpdate:btnTotalUpdate#{product.id}#{product.stock.id}').click();
                                                                       return false;
                                                                   }"
                                                           value="#{product.totalPrice}" class="Wid97 TexAlRight"  placeholder="#{loc.price}" required="true">
                                                <p:ajax event="blur" oncomplete="document.getElementById('frmUpdate:btnTotalUpdate#{product.id}#{product.stock.id}').click();" />
                                            </p:inputNumber>

                                        </div>


                                        <div class="ui-g-12 ui-md-2 ui-lg-1">
                                            <h:outputText value="ss"  class="outputTextFont Fleft MarRight8" style="visibility: hidden;"/>
                                            <p:commandLink id="btnDelete" disabled="#{product.id>0}"  resetValues="true" global="false" title="#{loc.delete}" update="frmUpdate" action="#{invoiceItemTabBean.deleteRecord(product)}" >
                                                <i class="fa fa-remove Fs25 MarTop30" style="color: #b71717 !important"/>                 
                                            </p:commandLink>
                                        </div>

                                        <p:commandButton  style="visibility: hidden" id="btnUpdate#{product.id}#{product.stock.id}" resetValues="true" global="false" 
                                                          title="#{loc.save}" update="frmUpdate" action="#{invoiceItemTabBean.updateData(product,1)}" >
                                        </p:commandButton>

                                        <p:commandButton  style="visibility: hidden" id="btnTotalUpdate#{product.id}#{product.stock.id}" resetValues="true" global="false" 
                                                          title="#{loc.save}" update="frmUpdate" action="#{invoiceItemTabBean.updateData(product,0)}" >
                                        </p:commandButton>

                                    </div>
                                </c:forEach> 
                            </div>

                        </h:form>

                    </div>
                </h:panelGroup>

            </div>
        </h:panelGroup>
    </p:dialog> 


    <div style="display: none;">
        <!--Fatura Şablonu Printer için -->
        <ui:include src="/pages/finance/invoice/invoiceprint.xhtml" />
    </div>

    <!-- fatura iptale çekileceğinde uyrarı verir. -->
    <p:confirmDialog global="true" class="deleteConfirm controlDelete"  widgetVar="dlgConfirm" width="30%" closable="true" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.invoicecancellation}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.yes}" actionListener="#{invoiceProcessBean.saveYesNo(true)}" async="true" global="true" onclick="PF('dlgConfirm').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.no}"  actionListener="#{invoiceProcessBean.saveYesNo(false)}" update="frmInvoiceProcess" onclick="PF('dlgConfirm').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>

    <!-- Aynı belgeno uyarısı -->
    <p:dialog id="dlgDocumentNumberWarning" widgetVar="dlgDocumentNumberWarning" modal="true" dynamic="true" resizable="false"  responsive="true" closeOnEscape="true" width="26%">
        <h:form id="form" enctype="multipart/form-data" > 
            <p:panelGrid id="pgrfileformat">
                <div>               
                    <table class="tableUp" style="border: 1px solid;border-color: #316996;background-color: #fbfcfd;">
                        <thead>
                            <tr >
                                <th scope="col" colspan="4" class="Fs16 TexAlLeft"><h:outputText value="#{loc.thedocumentnumberyouhaveenteredpreenteredpleasecheck}" style="color: red !important;"/></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.invoicetype}"/></td>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{invoiceProcessBean.duplicateInvoice.type.tag}"/></td>
                            </tr>
                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.invoicedate}"/></td>
                                <td class="TexAlLeft Fs14" colspan="2">
                                    <h:outputText value="#{invoiceProcessBean.duplicateInvoice.invoiceDate}">
                                        <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                                    </h:outputText>
                                </td>
                            </tr>
                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.documentnumber}"/></td>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{invoiceProcessBean.duplicateInvoice.toString()}"/></td>
                            </tr>
                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.currentname}"/></td>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{invoiceProcessBean.duplicateInvoice.account.name}"/></td>
                            </tr>
                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.totalprice}"/></td>
                                <td class="TexAlLeft Fs14" colspan="2">
                                    <h:outputText value="#{invoiceProcessBean.duplicateInvoice.totalMoney}" style="float: right;">
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoiceProcessBean.duplicateInvoice.currency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </td>
                            </tr>
                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.user}"/></td>
                                <td class="TexAlLeft Fs14" colspan="2">
                                    <h:outputText value="#{invoiceProcessBean.duplicateInvoice.userCreated.toString()} - "/>
                                    <h:outputText value="#{invoiceProcessBean.duplicateInvoice.dateCreated}">
                                        <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                                    </h:outputText>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>                    
            </p:panelGrid>
        </h:form>
    </p:dialog>



    <!-- Faturayı silerken çıkan uyarı dilogu -->
    <p:confirmDialog id="dlgConfirmDelete"  class="deleteConfirm controlDelete"  widgetVar="dlgConfirmDelete" closable="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.invoicedelete}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.areyousureyouwanttocontinue}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.yes}" actionListener="#{invoiceProcessBean.delete()}" async="true" global="true" onclick="PF('dlgConfirmDelete').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.no}"  onclick="PF('dlgConfirmDelete').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                    </div>

                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>

    <!-- Rafineri Fiyatı kontrolü -->
    <p:confirmDialog id="dlgConfirmRefineriPrice"  class="deleteConfirm controlDelete"  widgetVar="dlgConfirmRefineriPrice" closable="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.thepurchasepriceoftheproductismorethanthepriceoftherefinery}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.areyousureyouwanttocontinue}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.yes}" actionListener="#{invoiceItemTabBean.cnfrmYes()}" async="true" global="true" onclick="PF('dlgConfirmRefineriPrice').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.no}"  onclick="PF('dlgConfirmRefineriPrice').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>

    <!-- Rafineri Fiyatı kontrolü -->
    <p:confirmDialog id="dlgConfirmRefineriPriceQuickAdd"  class="deleteConfirm controlDelete"  widgetVar="dlgConfirmRefineriPriceQuickAdd" closable="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.thepurchasepriceoftheproductismorethanthepriceoftherefinery}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.areyousureyouwanttocontinue}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.yes}" async="true" global="true" onclick="PF('dlgConfirmRefineriPriceQuickAdd').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.no}"  onclick="PF('dlgConfirmRefineriPriceQuickAdd').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>


    <!-- Faturanın ödemelerini silerken çıkan uyarı dilogu -->
    <p:confirmDialog id="dlgRelatedRecordInfo"  class="deleteConfirm controlDelete"  widgetVar="dlg_RelatedRecordInfo" closable="true" width="20%" responsive="true">
        <c:if test="#{invoiceProcessBean.activeIndex==3}" >
            <f:facet name="message">
                <p:panel class="divContent">
                    <div class="ui-g">
                        <div class="ui-g-12 ui-md-12 ui-lg-12">
                            <h:outputText value="#{invoicePaymentsTabBean.deleteControlMessage}" />
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-12">
                            <h:outputText value="#{invoicePaymentsTabBean.deleteControlMessage1}" />
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                            <h:outputText value="#{invoicePaymentsTabBean.deleteControlMessage2}" class="Fright"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                            <p:commandLink value="#{invoicePaymentsTabBean.relatedRecord}" class="Fleft cmdRelatedRecord" title="#{loc.gotorelatedrecord}" actionListener="#{invoicePaymentsTabBean.goToRelatedRecordBefore()}"/>
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                            <p:commandButton value="#{loc.yes}" actionListener="#{invoicePaymentsTabBean.delete()}" async="true" global="true" onclick="PF('dlg_RelatedRecordInfo').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                        </div>
                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                            <p:commandButton value="#{loc.no}"  onclick="PF('dlg_RelatedRecordInfo').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                        </div>

                    </div>
                </p:panel>
            </f:facet>
        </c:if>
    </p:confirmDialog>

    <!-- Cari ve belge no değiştirme dialogu-->
    <p:dialog id="dlgChangeInvoiceInfo" widgetVar="dlg_ChangeInvoiceInfo" resizable="false" width="50%" focus="dlgChangeInvoiceInfo" responsive="true" dynamic="true" modal="true" closeOnEscape="true" >
        <p:ajax event="close" listener="#{invoiceProcessBean.resetChangingInfoDialog()}" global="false" update="pngAccountBook"/>
        <h:form id="frmChangeInvoiceInfo">
            <ui:include src="/pages/general/common/processtoolbar.xhtml" >
                <ui:param name="outputtext" value="#{loc.invoiceprocesses}"/>
                <ui:param name="bean" value='#{invoiceProcessBean}' />
                <ui:param name="update" value="pgrChangeInvoiceInfo" />
                <ui:param name="btnSaveId" value="true" />    
            </ui:include>
            <h:panelGroup id="pgrChangeInvoiceInfo" layout="block" class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-4 ui-lg-3">
                        <p:outputLabel value="#{loc.current}" for="txtChangeAccount" styleClass="Fs12 FontBold"/>
                        <p:inputText id="txtChangeAccount" onclick="showBookChangeAccount();" value="#{invoiceProcessBean.selectedChangingInvoice.account.name}" class="inputPositionForBookFilter" required="true" 
                                     readonly="#{facesContext.currentPhaseId.ordinal ge 4}" placeholder="#{loc.currentname}">
                        </p:inputText>
                        <p:commandLink id="btnChangeAccount" class="commandLinkPositionForBookFilter" process="@this" oncomplete="PF('olp_account').loadContents();" >
                            <i class="fa fa-book Fs16 softgray iconPositionForBookFilter "/>   
                            <p:ajax listener="#{accountBookFilterBean.findFilterListLazyLoading([invoiceProcessBean.selectedObject.branchSetting.branch],'frmAccountBookFilter','olp_account','invoice')}" global="false" />
                        </p:commandLink>
                    </div>

                    <h:panelGroup rendered="#{invoiceProcessBean.selectedObject.isPurchase}" >
                        <div class="ui-g-12 ui-md-4 ui-lg-3">
                            <p:outputLabel value="#{loc.serialno}" for="txtDocumentNumber3" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtDocumentNumber3" value="#{invoiceProcessBean.selectedChangingInvoice.documentSerial}" 
                                         required="true"  styleClass="Wid95" placeholder="#{loc.serialno}"  />
                        </div>
                        <div class="ui-g-12 ui-md-4 ui-lg-3">
                            <p:outputLabel value="#{loc.orderno}" for="txtDocumentNumber" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtDocumentNumber" value="#{invoiceProcessBean.selectedChangingInvoice.documentNumber}" placeholder="#{loc.number}" required="true" 
                                         styleClass="Wid95"/>
                        </div>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{!invoiceProcessBean.selectedObject.isPurchase}" >
                        <div class="ui-g-12 ui-md-4 ui-lg-3">
                            <p:outputLabel value="#{loc.serialno}" for="slcDocumentNumber" styleClass="Fs12 FontBold"/>
                            <p:selectOneMenu id="slcDocumentNumber" required="true" value="#{invoiceProcessBean.selectedChangingInvoice.dNumber.id}" 
                                             styleClass="Wid95"  >
                                <f:selectItem itemLabel="#{loc.choose}" itemValue="0" itemDisabled="true" />
                                <f:selectItems value="#{invoiceProcessBean.listOfDocumentNumber}"  var="dnumber" itemLabel="#{dnumber.serial}" itemValue="#{dnumber.id}" />
                                <p:ajax listener="#{invoiceProcessBean.bringDocument}" global="false" delay="100" process="@this" update="txtDocumentNumber2" />
                            </p:selectOneMenu>
                        </div>
                        <div class="ui-g-12 ui-md-4 ui-lg-3">
                            <p:outputLabel value="#{loc.orderno}" for="txtDocumentNumber2" styleClass="Fs12 FontBold"/>
                            <p:inputNumber id="txtDocumentNumber2" value="#{invoiceProcessBean.selectedChangingInvoice.dNumber.actualNumber}" required="true" 
                                           styleClass="Wid95" placeholder="#{loc.number}"
                                           thousandSeparator="" decimalSeparator="." decimalPlaces="0" minValue="0"
                                           />
                        </div>
                    </h:panelGroup>
                    <div class="ui-g-12 ui-md-4 ui-lg-3">
                        <p:outputLabel value="#{loc.termdate}" for="cldChangeDueDate" styleClass="Fs12 FontBold"/>
                        <p:calendar  id="cldChangeDueDate" value="#{invoiceProcessBean.selectedChangingInvoice.dueDate}" 
                                     required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" 
                                     showOn="button" showButtonPanel="true" placeholder="#{loc.termdate}" mask="true" navigator="true" timeControlType="select"
                                     locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                            <p:ajax event="change" update="cldChangeDueDate" resetValues="true"/>
                        </p:calendar>
                    </div>
                    <h:panelGroup rendered="#{!invoiceProcessBean.selectedObject.isPurchase}" >
                        <div class="ui-g-12 ui-md-12 ui-lg-12">
                            <p:outputLabel value="#{loc.dispatchaddress}" for="txtChangeDispatchAddress" styleClass="Fs12 FontBold"/>
                            <p:inputText id="txtChangeDispatchAddress" value="#{invoiceProcessBean.selectedChangingInvoice.dispatchAddress}" 
                                         placeholder="#{loc.dispatchaddress}" styleClass="Wid97" /> 
                        </div>
                    </h:panelGroup>                    
                </div>
            </h:panelGroup>
            <p:remoteCommand name="showBookChangeAccount" process="@this" oncomplete="PF('olp_account').loadContents();" update="pngAccountBook" actionListener="#{accountBookFilterBean.findFilterListLazyLoading([invoiceProcessBean.selectedObject.branchSetting.branch],'frmAccountBookFilter','olp_account','invoice')}" global="false" />

        </h:form>
    </p:dialog>

    <!-- Fatura cari ve belge no değiştirme için açılan confirm -->
    <p:confirmDialog id="dlgConfirmChangeInfo"  class="deleteConfirm controlDelete"  widgetVar="dlg_ConfirmChangeInfo" closable="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.invoicewithchangingissaved}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{loc.areyousureyouwanttocontinue}" />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.yes}" actionListener="#{invoiceProcessBean.confirmSaveBefore()}" global="true" onclick="PF('dlg_ConfirmChangeInfo').hide()"   styleClass="ui-confirmdialog-yes" icon="ui-icon-check fa fa-check Fs14 white"   />
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandButton value="#{loc.no}"  onclick="PF('dlg_ConfirmChangeInfo').hide()" styleClass="ui-confirmdialog-no" icon="ui-icon-close fa fa-close Fs14 white" />
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>

    <p:confirmDialog id="dlgRelatedRecordItem" global="true"  class="deleteConfirm controlDelete" severity="alert" widgetVar="dlg_RelatedRecordItem" closeOnEscape="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{invoiceItemTabBean.deleteControlMessage}" style="color:black !important"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{invoiceItemTabBean.deleteControlMessage1}" style="color:black !important"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <h:outputText value="#{invoiceItemTabBean.deleteControlMessage2}" class="Fright"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandLink value="#{invoiceItemTabBean.relatedRecord}" class="Fleft cmdRelatedRecord" title="#{loc.gotorelatedrecord}" actionListener="#{invoiceItemTabBean.goToRelatedRecordBefore()}"/>
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>


    <p:confirmDialog id="dlgRelatedRecordInvoice" global="true"  class="deleteConfirm controlDelete" severity="alert" widgetVar="dlg_RelatedRecordInvoice" closeOnEscape="true" width="20%" responsive="true">
        <f:facet name="message">
            <p:panel class="divContent">
                <div class="ui-g">
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{invoiceProcessBean.deleteControlMessage}" style="color:black !important"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-12">
                        <h:outputText value="#{invoiceProcessBean.deleteControlMessage1}" style="color:black !important"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <h:outputText value="#{invoiceProcessBean.deleteControlMessage2}" class="Fright"/>
                    </div>
                    <div class="ui-g-12 ui-md-12 ui-lg-6">
                        <p:commandLink value="#{invoiceProcessBean.relatedRecord}" class="Fleft cmdRelatedRecord" title="#{loc.gotorelatedrecord}" actionListener="#{invoiceProcessBean.goToRelatedRecordBefore()}"/>
                    </div>
                </div>
            </p:panel>
        </f:facet>
    </p:confirmDialog>


    <!--Stok tabındafiyat farkı faturası için  stok eklemek için açılan dialog  -->
    <p:dialog id="dlgPriceDifferenceStock" widgetVar="dlg_PriceDifferenceStock" resizable="false" focus="dlgPriceDifferenceStock" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="40%" >
        <ui:include src="invoicepricedifferencestockprocess.xhtml"/>
    </p:dialog> 

    <!--Stok tabındafiyat farkı faturası için  stok güncellemek için açılan dialog  -->
    <p:dialog id="dlgPriceDifferenceStockUpdate" widgetVar="dlg_PriceDifferenceStockUpdate" resizable="false" focus="dlgPriceDifferenceStockUpdate" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="25%" >
        <ui:include src="invoicepricedifferencestockupdateprocess.xhtml"/>
    </p:dialog>

    <h:panelGroup >
        <!-- fatura sayfasında fiyat farkı için fatura seçtirme-->
        <ui:include src="/pages/general/common/invoicebook.xhtml" >
            <ui:param name="updateBean" value='#{invoiceProcessBean}' />
            <ui:param name="for" value="frmInvoiceProcess:txtConnectedInvoice" />
            <ui:param name="type" value='differencepriceinvoice' />
            <ui:param name="parameters" value='' /> 
            <ui:param name="columnsize" value='3' /> 
            <ui:param name="form" value='frmInvoiceBookFilter' /> 
            <ui:param name="overlay" value="olp_invoice" />
        </ui:include>
    </h:panelGroup>



    <!-- <p:remoteCommand name="testt" process="@this" update="frmInvoiceProcess" onstart="alert('test')" autoRun="true" global="false" />-->

    <h:form id="formId" >
        <h:inputHidden id="x" value="#{invoiceProcessBean.wordFromNumber}" />
        <p:commandButton style="display: none" id="cmdSubmit" value="submit" onclick="getVars()" global="false" />
        <p:remoteCommand  name="tessst" onstart=" document.getElementById('formId:cmdSubmit').click();" global="false" autoRun="true"/>
    </h:form>
    <div style="display: none">
        <p:outputPanel id="printPanel"  style="width: 22cm;height: 29cm;">
        </p:outputPanel>  
        <script>
            //<![CDATA[
            function updateDatatable() {
                document.getElementById("frmPurchaseControlInformation:updateDatatable").click();
            }

            function getVars() {

                // ...
                var str;
                if ('#{invoiceProcessBean.selectedObject.type.id}' == 26) {
                    str = '#{invoiceProcessBean.selectedObject.priceDifferenceTotalMoney}';
                } else {
                    str = '#{invoiceProcessBean.selectedObject.totalMoney}';
                }
                var x = "";
                str = parseFloat(str).toFixed('#{sessionBean.user.lastBranch.currencyrounding}');
                if (str.includes(".")) {
                    var res = str.split(".")

                    if (str != "") {
                        if (parseInt(res[0]) > 0) {
                            x = writtenNumber(parseInt(res[0]), {lang: '#{sessionBean.user.language.code}'.toLowerCase()}) + ' #{sessionBean.currencySignOrCode(invoiceProcessBean.selectedObject.currency.id, 0)}';
                        }
                        if (res[1].length > 0) {
                            if (parseInt(res[1]) > 0) {
                                var subCurrency = "";
                                if ('#{invoiceProcessBean.selectedObject.currency.id}' == 1) {
                                    subCurrency = '#{loc.kurus}';
                                } else if ('#{invoiceProcessBean.selectedObject.currency.id}' == 2) {
                                    subCurrency = '#{loc.cent}';
                                }
                                if ('#{invoiceProcessBean.selectedObject.currency.id}' == 3) {
                                    subCurrency = '#{loc.cent}';
                                }
                                if ('#{invoiceProcessBean.selectedObject.currency.id}' == 4) {
                                    subCurrency = '#{loc.tetri}';
                                }
                                x = x + ' , ' + writtenNumber(parseInt(res[1]), {lang: '#{sessionBean.user.language.code}'.toLowerCase()}) + ' ' + subCurrency;
                            }
                        }
                    }
                } else {
                    x = writtenNumber(parseInt(str), {lang: '#{sessionBean.user.language.code}'.toLowerCase()}) + ' #{sessionBean.currencySignOrCode(invoiceProcessBean.selectedObject.currency.id, 0)}';
                }
                document.getElementById("formId:x").value = x.toUpperCase();
            }

            /*    function printData()
             {
             var divToPrint = document.getElementById("printPanel");
             newWin = window.open("");
             newWin.document.write(divToPrint.outerHTML);
             newWin.document.close()
             newWin.focus();
             setTimeout(function () { newWin.print(); }, 100);
             setInterval(function () { newWin.close(); }, 200);
             //var writtenNumber = require('written-number');
             
             }*/

            function printData() {

                // var w = window.open();

                //$(w.document.body).html(document.getElementById("printPanel").innerHTML);

                var contents = document.getElementById("printPanel").innerHTML;
                var frame1 = document.createElement('iframe');
                frame1.name = "frame1";
                frame1.style.position = "absolute";
                frame1.style.top = "-1000000px";
                document.body.appendChild(frame1);
                var frameDoc = (frame1.contentWindow) ? frame1.contentWindow : (frame1.contentDocument.document) ? frame1.contentDocument.document : frame1.contentDocument;
                frameDoc.document.open();
                frameDoc.document.write('<html><head><title>DIV Contents</title>');
                frameDoc.document.write('</head><body>');
                frameDoc.document.write(contents);
                frameDoc.document.write('</body></html>');
                frameDoc.document.close();
                setTimeout(function () {
                    window.frames["frame1"].focus();
                    window.frames["frame1"].print();
                    document.body.removeChild(frame1);
                }, 500);
                return false;
            }
            //]]>
        </script>
    </div>

    <style type="text/css">
        .tableUp {
            border-collapse: collapse;
            margin: 0;
            padding: 0;
            width: 98%;
            table-layout: fixed;
            margin-left: 8px;
            font-size: 14px;
        }
        .tableUp tr {
            background-color: #f8f8f8;
            padding: .35em;
        }
        .pgrResponsive{
            border-collapse: collapse;
            margin: 0;
            padding: 0px;
            width: 100%;
            table-layout: auto;
        }



    </style>

</ui:composition>

