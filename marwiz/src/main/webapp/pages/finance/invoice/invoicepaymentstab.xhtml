<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">



    <h:form id="frmInvoicePaymentsTab">
        <div class="ContainerIndent">
            <ui:include src="/pages/general/common/tabgridtoolbar.xhtml">
                <ui:param name="bean" value="#{invoicePaymentsTabBean}"/>
                <ui:param name="btnNewId" value="#{!invoiceProcessBean.isCreateInvFromOrder and invoicePaymentsTabBean.selectedInvoice.status.id==28 and !invoiceProcessBean.isCreateInvFromWaybill and !invoiceProcessBean.isCreateInvFromCustAgreement and invoicePaymentsTabBean.getRendered(8, 0) and !invoicePaymentsTabBean.selectedInvoice.isWait ?
                                                   sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ?
                                                   (invoicePaymentsTabBean.selectedInvoice.type.id == 59 and invoicePaymentsTabBean.selectedInvoice.isPurchase) ? (invoicePaymentsTabBean.selectedInvoice.sapIsSendWaybill or (invoicePaymentsTabBean.selectedInvoice.sapIsSendWaybill and invoicePaymentsTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoicePaymentsTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}"/>
                <ui:param name="update" value="" />
                <ui:param name="outputtext" value="#{invoicePaymentsTabBean.selectedInvoice.isPurchase==true and invoicePaymentsTabBean.selectedInvoice.type.id ==26 and invoicePaymentsTabBean.selectedInvoice.isDifferenceDirection ? loc.payments
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==true and invoicePaymentsTabBean.selectedInvoice.type.id ==26 and !invoicePaymentsTabBean.selectedInvoice.isDifferenceDirection ? loc.recoveries
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==false and invoicePaymentsTabBean.selectedInvoice.type.id ==26 and invoicePaymentsTabBean.selectedInvoice.isDifferenceDirection ? loc.recoveries
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==false and invoicePaymentsTabBean.selectedInvoice.type.id ==26 and !invoicePaymentsTabBean.selectedInvoice.isDifferenceDirection ? loc.payments
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==false and invoicePaymentsTabBean.selectedInvoice.type.id !=27 ? loc.recoveries
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==true and invoicePaymentsTabBean.selectedInvoice.type.id !=27 ? loc.payments
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==false and invoicePaymentsTabBean.selectedInvoice.type.id ==27 ? loc.payments
                                                     : invoicePaymentsTabBean.selectedInvoice.isPurchase==true and invoicePaymentsTabBean.selectedInvoice.type.id ==27 ? loc.recoveries : ''}" />
            </ui:include>

            <p:dataTable id="dtbPayments"  var="invoicePayments" value="#{invoicePaymentsTabBean.listOfObjects}" selectionMode="single" widgetVar="paymentPF"
                         rows="#{sessionBean.user.defualtGridSize}" rowKey="#{invoicePayments.id}" emptyMessage="#{loc.norecordsfound}" selection="#{invoicePaymentsTabBean.selectedObject}"
                         paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                         rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" 
                         reflow="true" frozenRows="0"  scrollWidth="100%" >

                <p:ajax event="#{sessionBean.user.gridRowSelect}" listener="#{invoicePaymentsTabBean.createDialog(2)}"  /> 

                <p:column id="clmType" headerText="#{invoicePaymentsTabBean.selectedInvoice.isPurchase==false?loc.collectiontype:loc.paymenttype}">
                    <h:outputText value="#{invoicePayments.type.tag}" />
                </p:column>

                <p:column id="clmDate" headerText="#{loc.processdate}">
                    <h:outputText value="#{invoicePayments.type.id==19 ? invoicePayments.credit.dueDate : 
                                           ((invoicePayments.type.id==66 or invoicePayments.type.id==69) ? invoicePayments.chequeBill.expiryDate : 
                                           invoicePayments.financingDocument.documentDate)}" >
                        <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss" />
                    </h:outputText>
                </p:column>

                <p:column id="clmPrice" headerText="#{loc.total}">
                    <h:outputText value="#{invoicePayments.price}" style="float: right;" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoicePayments.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>


                <p:columnGroup type="footer" class="Fright">

                    <p:row>
                        <p:column colspan="2" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.invoiceprice} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="1" style="text-align:right; font-weight: bold; ">
                            <f:facet name="footer"  >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoicePaymentsTabBean.selectedInvoice.type.id == 26 ? invoicePaymentsTabBean.selectedInvoice.priceDifferenceTotalMoney : invoicePaymentsTabBean.selectedInvoice.totalMoney}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoicePaymentsTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>

                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.sumpayment} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="1" style="text-align:right; font-weight: bold; ">
                            <f:facet name="footer"  >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoicePaymentsTabBean.sumPayments}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoicePaymentsTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>

                    </p:row>
                    <p:row>
                        <p:column colspan="2" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.remainingpayment} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="1" style="text-align:right; font-weight: bold; ">
                            <f:facet name="footer"  >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoicePaymentsTabBean.selectedInvoice.type.id == 26 ? invoicePaymentsTabBean.selectedInvoice.priceDifferenceTotalMoney-invoicePaymentsTabBean.sumPayments : invoicePaymentsTabBean.selectedInvoice.totalMoney-invoicePaymentsTabBean.sumPayments}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoicePaymentsTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>

                    </p:row>
                </p:columnGroup>

            </p:dataTable>
        </div>
    </h:form>

</ui:composition>
