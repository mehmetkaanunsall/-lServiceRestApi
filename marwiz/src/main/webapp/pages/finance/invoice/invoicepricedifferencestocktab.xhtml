<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <div class="ContainerIndent">     
        <ui:include src="/pages/general/common/datagridtoolbardefinition.xhtml" >
            <ui:param name="bean" value="#{invoicePriceDifferenceStockTabBean}"/>
            <ui:param name="update" value="dlgPriceDifferenceStock"/> 
            <ui:param name="btnNewId" value="#{invoicePriceDifferenceStockTabBean.selectedInvoice.status.id==28 and invoicePriceDifferenceStockTabBean.selectedInvoice.posId==0 and invoicePriceDifferenceStockTabBean.getRendered(5, 0) ? 
                                               sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  and
                                               invoicePriceDifferenceStockTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'false'}"/>
            <ui:param name="datatable" value="tbvInvoice:frmPriceDifferenceTab:dtbPriceDifferenceTab" />
            <ui:param name="widgetvar" value='invoicePriceDiffPF' />
            <ui:param name="form" value='frmToolbarPriceDifference' />
        </ui:include>


        <h:form id="frmPriceDifferenceTab">
            <p:dataTable id="dtbPriceDifferenceTab"  var="invoiceStock" value="#{invoicePriceDifferenceStockTabBean.listOfObjects}" filteredValue="#{invoicePriceDifferenceStockTabBean.listOfFilteredObjects}" selectionMode="single" 
                         selection="#{invoicePriceDifferenceStockTabBean.selectedObject}" widgetVar="invoicePriceDiffPF" rowKey="#{invoiceStock.id}" emptyMessage="#{loc.norecordsfound}" class="tabDatatable600px datatableDraggable"
                         rows="#{sessionBean.user.defualtGridSize}" 
                         paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                         rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" 
                         editable="true" editMode="cell" resizableColumns="true" resizeMode="expand">

                <p:ajax event="#{sessionBean.user.gridRowSelect}" resetValues="true" listener="#{invoicePriceDifferenceStockTabBean.update()}" update="dlgPriceDifferenceStockUpdate"  transient="true" />  
                <p:ajax event="page" global="false"/>
                <p:ajax event="filter" global="false"/>

                <f:facet  name="footer"     >
                    <p:inputText id="globalFilter" value="#{invoicePriceDifferenceStockTabBean.autoCompleteValue}"  style="display: none" />
                </f:facet>

                <p:column id="clmStockBarcode" headerText="#{loc.stockbarcode}" sortBy="#{invoiceStock.stock.barcode}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.barcode}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.barcode}" />
                </p:column>

                <p:column id="clmStockCenterProductCode" headerText="#{loc.centerstockcode}" sortBy="#{invoiceStock.stock.centerProductCode}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.centerProductCode}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.centerProductCode}" />
                </p:column>

                <p:column id="clmStockName" headerText="#{loc.stockname}"  sortBy="#{invoiceStock.stock.name}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.name}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.name}" />
                </p:column>

                <p:column id="clmAmount" headerText="#{loc.amount}"  width="100"  sortBy="#{invoiceStock.quantity}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.quantity}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.quantity}" rendered="#{invoiceStock.quantity>0}" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="unit" value="#{invoiceStock.unit}"/>
                         <f:attribute name="type" value="unit" />
                    </h:outputText>
                    <h:outputText value="-" rendered="#{invoiceStock.quantity==0}"/>
                </p:column>

                <p:column id="clmOldUnitPrice" headerText="#{loc.oldunitprice}"  width="100" sortBy="#{invoiceStock.oldUnitPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.oldUnitPrice}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.oldUnitPrice}" style="float: right;" rendered="#{invoiceStock.oldUnitPrice>0}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.oldUnitPrice==0}"/>
                </p:column>


                <p:column id="clmUnitPrice" headerText="#{loc.unitprice}"  width="100" sortBy="#{invoiceStock.unitPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.unitPrice}" filterMatchMode="contains"  >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.unitPrice}" style="float: right;" rendered="#{invoiceStock.unitPrice>0}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.unitPrice==0}"/>
                </p:column>



                <p:column id="clmTaxRate"  width="100" headerText="#{loc.taxrate}" sortBy="#{invoiceStock.taxRate}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.taxRate}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.taxRate}" style="float: right;" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="percent" />
                    </h:outputText>
                </p:column>

                <p:column id="clmTaxPrice" headerText="#{loc.taxprice}"  width="100" sortBy="#{invoiceStock.totalTax}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalTax}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalTax}" style="float: right;" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>


                <p:column id="clmInterimPrice"  width="100" headerText="#{loc.taxfreeamount}" sortBy="#{invoiceStock.totalPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalPrice}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalPrice}" style="float: right;" rendered="#{invoiceStock.totalPrice>0}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.totalPrice==0}"/>
                </p:column>




                <p:column id="clmPrice" headerText="#{loc.totalprice}"  width="100" sortBy="#{invoiceStock.totalMoney}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalMoney}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalMoney}" style="float: right;">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>


                <p:column id="clmExchangePrice" headerText="#{loc.exchangeprice}" rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}" sortBy="#{invoiceStock.totalMoney * invoiceStock.exchangeRate}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalMoney * invoiceStock.exchangeRate}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalMoney * invoiceStock.exchangeRate}" style="float: right;">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoicePriceDifferenceStockTabBean.selectedInvoice.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>


                <p:columnGroup type="footer" class="Fright">

                    <!-- stokların toplam tutarı -->
                    <p:row>
                        <p:column colspan="3" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.totalamount} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="1" style="text-align:right; font-weight: bold; " priority="1"> 
                            <f:facet name="footer"  >
                                <h:outputText value="#{invoicePriceDifferenceStockTabBean.totalAmountText()}" style="font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 6: 5}" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.subtotal} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column> 
                        <p:column colspan="1" style="text-align:right; font-weight: bold; ">
                            <f:facet name="footer"  >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoicePriceDifferenceStockTabBean.sumTotalPrice()}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoicePriceDifferenceStockTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>

                    </p:row>

                    <p:row>
                        <p:column colspan="7" rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}" style="text-align:right;" priority="1">
                            <f:facet name="footer">
                                <h:outputText value="#{loc.taxamountwithexchange}: #{invoicePriceDifferenceStockTabBean.bringTaxrates()}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 3 : 9}" style="text-align:right;" priority="1">
                            <f:facet name="footer" >
                                <h:outputText value=" #{loc.totaltaxprice}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <!-- toplam vergı -->
                        <p:column colspan="1" style="text-align:right;">
                            <f:facet name="footer" >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoicePriceDifferenceStockTabBean.sumTotalTax()}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoicePriceDifferenceStockTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:row> 

                    <ui:repeat value="#{invoicePriceDifferenceStockTabBean.calcTaxList()}" var="taxs" >
                        <p:row>
                            <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 10 : 9}" style="text-align:right;" priority="1">
                                <f:facet name="footer"  >
                                    <h:outputText value="#{loc.tax}" style="text-align:right; font-weight: bold;" />
                                    <h:outputText value=" (" style="text-align:right; font-weight: bold;" />
                                    <h:outputText value="#{taxs.taxRate}" style="text-align:right; font-weight: bold;" >
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="type" value="percent" />
                                    </h:outputText>
                                    <h:outputText value=") " style="text-align:right; font-weight: bold;" />
                                </f:facet>
                            </p:column>
                            <p:column colspan="1" style="text-align:right;" >
                                <f:facet name="footer" >
                                    <h:outputText  style="text-align:right; font-weight: bold; " value="#{taxs.totalTax}" >
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoicePriceDifferenceStockTabBean.selectedInvoice.currency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </f:facet>
                            </p:column>   
                        </p:row>
                    </ui:repeat> 

                    <!-- ödenecek tutar -->
                    <p:row  >
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 10 : 9}" style="text-align:right;" priority="1">
                            <f:facet name="footer" >
                                <h:outputText value="#{loc.grandtotal} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="1" style="text-align:right;" >
                            <f:facet name="footer" >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoicePriceDifferenceStockTabBean.sumTotalMoney()}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoicePriceDifferenceStockTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:row>


                </p:columnGroup> 



            </p:dataTable>
        </h:form>
    </div>

</ui:composition>
