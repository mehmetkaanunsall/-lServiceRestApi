<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <h:form id="frmInvoiceReport">
        <p:remoteCommand name="showAccountBook" process="@this" update="frmAccountBookFilterCheckbox" oncomplete="PF('olp_accountcheckbox').loadContents();" action="#{invoiceBean.openDialog(0)}" actionListener="#{accountBookCheckboxFilterBean.findFilterListLazyLoading([invoiceBean.searchObject.selectedBranchList.isEmpty() ? invoiceBean.listOfBranch : invoiceBean.searchObject.selectedBranchList],'frmAccountBookFilterCheckbox','olp_accountcheckbox','invoiceCheckBox')}" />
        <p:remoteCommand name="showStockBook" process="@this" update="frmStockBookFilterCheckbox" oncomplete="PF('olp_stockcheckbox').show();" action="#{invoiceBean.openDialog(1)}" actionListener="#{stockBookCheckboxFilterBean.findFilterListLazyLoading([invoiceBean.searchObject.selectedBranchList.isEmpty() ? invoiceBean.listOfBranch : invoiceBean.searchObject.selectedBranchList],'frmStockBookFilterCheckbox','olp_stockcheckbox','invoicePage')}" />

        <h:panelGroup id="pgrAutomationSalesWaybill" layout="block" transient="true">
            <ui:include src="/pages/general/common/toolbarreport.xhtml" >
                <ui:param name="outputtext" value="#{loc.invoices}"/>
                <ui:param name="bean" value='#{invoiceBean}' />
                <ui:param name="update" value="cldStartDate cldEndDate txtCustomer" />
            </ui:include>

            <h:panelGroup id="pgrInvoiceReport" layout="block" transient="true">  
                <div class="ui-g divContent">
                    <div class="panelToggle ui-g-12">
                        <div class="#{invoiceBean.listOfBranch.size() > 1 ? 'ui-g-12 ui-md-12 ui-lg-12' : 'ui-g-12 ui-md-6 ui-lg-7'}" style="padding: 0px !important">
                            <h:panelGroup rendered="#{invoiceBean.listOfBranch.size() > 1}">
                                <div class="ui-g-12 ui-md-6 ui-lg-2">
                                    <p:outputLabel value="#{loc.branch}" for="slcBranchCheckBox" styleClass="Fs12 FontBold"/>
                                    <p:selectCheckboxMenu  id="slcBranchCheckBox" value="#{invoiceBean.searchObject.selectedBranchList}" 
                                                           filter="true" filterMatchMode="contains" converter="entityConverter" widgetVar="slcBranchCheckBox"  
                                                           label="#{invoiceBean.searchObject.selectedBranchList.size()!=0 ? invoiceBean.searchObject.selectedBranchList.size() :loc.all} #{invoiceBean.searchObject.selectedBranchList.size()!=0 ? loc.branch : ''} #{invoiceBean.searchObject.selectedBranchList.size()!=0 ? loc.selected : ''}" styleClass="Wid90" >
                                        <f:selectItems value="#{invoiceBean.listOfBranch}" itemLabel="#{branchSetting.branch.name}" itemValue="#{branchSetting}" var="branchSetting" />       
                                        <p:ajax oncomplete="PF('slcBranchCheckBox').show()" global="false" listener="#{invoiceBean.changeBranch()}" update="frmInvoiceReport:slcBranchCheckBox frmInvoiceReport:txtCustomer frmInvoiceReport:txtStock frmInvoiceReport:btnCustomer frmInvoiceReport:btnStock"/>
                                        <p:ajax event="toggleSelect" listener="#{invoiceBean.changeBranch()}" update="frmInvoiceReport:slcBranchCheckBox frmInvoiceReport:txtCustomer frmInvoiceReport:txtStock frmInvoiceReport:btnCustomer frmInvoiceReport:btnStock"  oncomplete="PF('slcBranchCheckBox').show()" global="false"/>
                                    </p:selectCheckboxMenu>
                                </div>
                            </h:panelGroup>
                            <div class="#{invoiceBean.listOfBranch.size() > 1 ? 'ui-g-12 ui-md-6 ui-lg-2' : 'ui-g-12 ui-md-6 ui-lg-3'}">
                                <p:outputLabel value="#{loc.startdate}" for="cldStartDate" styleClass="Fs12 FontBold"/>
                                <p:calendar  id="cldStartDate" value="#{invoiceBean.searchObject.beginDate}" required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat}" showOn="button" timeControlType="select"  showButtonPanel="true" placeholder="#{loc.startdate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                                    <p:ajax event="change" update="cldStartDate" resetValues="true" global="false"/>
                                </p:calendar>
                            </div>

                            <div class="#{invoiceBean.listOfBranch.size() > 1 ? 'ui-g-12 ui-md-6 ui-lg-2' : 'ui-g-12 ui-md-6 ui-lg-3'}">
                                <p:outputLabel value="#{loc.enddate}" for="cldEndDate" styleClass="Fs12 FontBold"/>
                                <p:calendar  id="cldEndDate" value="#{invoiceBean.searchObject.endDate}" required="true" class="datepicker" beforeShow="dpClearButton" pattern="#{sessionBean.user.lastBranch.dateFormat}" timeControlType="select"  showOn="button" showButtonPanel="true" placeholder="#{loc.enddate}" mask="true" navigator="true" locale="#{sessionBean.locale}" yearRange="c-100:c+20" >
                                    <p:ajax event="change" update="cldEndDate" resetValues="true" global="false"/>
                                </p:calendar>
                            </div>

                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <p:outputLabel value="#{loc.current}" for="txtCustomer" styleClass="Fs12 FontBold"/>
                                <p:inputText  id="txtCustomer" onclick="showAccountBook()" value="#{accountBookCheckboxFilterBean.selectedCount}" class="inputPositionForBookFilter" readonly="#{facesContext.currentPhaseId.ordinal ge 4}" placeholder="#{loc.all}">   

                                </p:inputText>
                                <p:commandLink id="btnCustomer" process="@this" update="frmAccountBookFilterCheckbox" actionListener="#{invoiceBean.openDialog(0)}" class="commandLinkPositionForBookFilter" oncomplete="PF('olp_accountcheckbox').loadContents();">
                                    <i class="fa fa-book Fs16 iconPositionForBookFilter"></i>
                                    <p:ajax listener="#{accountBookCheckboxFilterBean.findFilterListLazyLoading([invoiceBean.searchObject.selectedBranchList.isEmpty() ? invoiceBean.listOfBranch : invoiceBean.searchObject.selectedBranchList],'frmAccountBookFilterCheckbox','olp_accountcheckbox', 'invoiceCheckBox')}" />
                                </p:commandLink>
                            </div>
                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <p:outputLabel value="#{loc.stock}" for="txtStock" styleClass="Fs12 FontBold"/>
                                <p:inputText id="txtStock" value="#{stockBookCheckboxFilterBean.selectedCount}" onclick="showStockBook()" class="inputPositionForBookFilter" readonly="#{facesContext.currentPhaseId.ordinal ge 4}" placeholder="#{loc.all}" >

                                </p:inputText>
                                <p:commandLink id="btnStock" process="@this" update="frmStockBookFilterCheckbox" actionListener="#{invoiceBean.openDialog(1)}" class="commandLinkPositionForBookFilter" oncomplete="PF('olp_stockcheckbox').show();">
                                    <i class="fa fa-book Fs16 iconPositionForBookFilter"></i>
                                    <p:ajax   listener="#{stockBookCheckboxFilterBean.findFilterListLazyLoading([invoiceBean.searchObject.selectedBranchList.isEmpty() ? invoiceBean.listOfBranch : invoiceBean.searchObject.selectedBranchList],'frmStockBookFilterCheckbox','olp_stockcheckbox','invoicePage')}" />
                                </p:commandLink>
                            </div>
                        </div>
                        <div class="#{invoiceBean.listOfBranch.size() > 1 ? 'ui-g-12 ui-md-12 ui-lg-6' : 'ui-g-12 ui-md-6 ui-lg-5'}" style="padding: 0px !important">


                            <div class="ui-g-12 ui-md-6 ui-lg-3" >
                                <p:outputLabel value="#{loc.salesprice} (Min)"  styleClass="Fs12 FontBold"/>
                                <p:inputNumber value="#{invoiceBean.searchObject.salePriceMin}"
                                               decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}" thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}" 
                                               roundMethod="D"  emptyValue="sign" symbolPosition="suffix" class="TexAlRight" placeholder="#{loc.salesprice} (Min)" >
                                </p:inputNumber>
                            </div>

                            <div class="ui-g-12 ui-md-6 ui-lg-3" >
                                <p:outputLabel value="#{loc.salesprice} (Max)"  styleClass="Fs12 FontBold"/> 
                                <p:inputNumber value="#{invoiceBean.searchObject.salePriceMax}"
                                               decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? '.': ','}" thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}" 
                                               roundMethod="D" emptyValue="sign" symbolPosition="suffix" class="TexAlRight" placeholder="#{loc.salesprice} (Max)" >
                                </p:inputNumber>
                            </div>

                            <div class="ui-g-12 ui-md-6 ui-lg-3">
                                <p:outputLabel value="#{loc.tax}" for="slcTax" styleClass="Fs12 FontBold"/>
                                <p:selectOneMenu id="slcTax" value="#{invoiceBean.searchObject.isTaxIncluded}">
                                    <f:selectItem itemLabel="#{loc.istaxincluded}" itemValue="true" />
                                    <f:selectItem itemLabel="#{loc.taxexcluding}" itemValue="false" />
                                </p:selectOneMenu>
                            </div>
                            <div class="ui-g-12 ui-md-6 ui-lg-3" >
                                <p:outputLabel value="#{loc.invoicetype}" for="slcInvoiceType"  styleClass="Fs12 FontBold"/>
                                <p:selectCheckboxMenu id="slcInvoiceType" value="#{invoiceBean.searchObject.listOfInvoiceType}" converter="entityConverter" filter="true" filterMatchMode="contains"
                                                      widgetVar="slc_InvoiceType" label="#{invoiceBean.searchObject.listOfInvoiceType.size()!=0 ? invoiceBean.searchObject.listOfInvoiceType.size() : loc.all} #{invoiceBean.searchObject.listOfInvoiceType.size()!=0 ? loc.salestype :''} #{invoiceBean.searchObject.listOfInvoiceType.size()!=0 ? loc.selected :''}">
                                    <f:selectItems var="type" value="#{sessionBean.getTypes(17)}" itemLabel="#{type.nameMap.get(sessionBean.langId).name}" itemValue="#{type}" />
                                    <p:ajax update="frmInvoiceReport:slcInvoiceType" oncomplete="PF('slc_InvoiceType').show()" global="false"/>
                                    <p:ajax event="toggleSelect" update="frmInvoiceReport:slcInvoiceType" oncomplete="PF('slc_InvoiceType').show()" global="false"/>
                                </p:selectCheckboxMenu>
                            </div>

                        </div>
                    </div>
                </div>

            </h:panelGroup>
        </h:panelGroup>
    </h:form>
    <div class="EmptyBox20"/>
    <ui:include src="/pages/general/common/datagridtoolbar.xhtml" >
        <ui:param name="bean" value="#{invoiceBean}"/>   <!-- Bean -->
        <ui:param name="update" value=""/>  <!-- Yeni butonuna basınca açılacak sayfa  -->
        <ui:param name="btnNewId" value="#{invoiceBean.getRendered(1, 0)}"/>  <!-- buton id yetki kontrolü için  -->
        <ui:param name="datatable" value="frmInvoice:dtbInvoice" />  <!-- datatable  -->
        <ui:param name="dtbWidgetVar" value="invoicePF" />  <!--   datatable WidgetVar  -->
        <ui:param name="fileName" value="#{loc.invoices}"/>
        <ui:param name="renderedFilter" value='true'/>
        <ui:param name="renderedToggler" value='true'/>
        <ui:param name="renderedExel" value='true'/>
        <ui:param name="renderedPdf" value='true'/>
        <ui:param name="renderedAdd" value='true'/>
        <ui:param name="renderedIsPurchase" value='true'/>
    </ui:include>


    <h:form id="frmInvoice">

        <p:dataTable  id="dtbInvoice" var="invoice"  value="#{invoiceBean.listOfObjects}" widgetVar="invoicePF" selection="#{invoiceBean.selectedObject}" selectionMode="single" emptyMessage="#{loc.norecordsfound}"
                      rows="#{sessionBean.user.defualtGridSize}" rowKey="#{Invoice.id}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                      rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}"  reflow="true" lazy="true" >
            <p:ajax event="#{sessionBean.user.gridRowSelect}" listener="#{invoiceBean.goToProcess()}" global="true"/>
            <p:ajax event="sort" listener="#{invoiceBean.sortListener}" />
            <p:ajax event="colReorder" listener="#{invoiceBean.reorder}" update="frmGridToolbar:toggle" />     
            <p:ajax event="colResize"  listener="#{invoiceBean.onResize}" />

            <p:column id="clmBranch" headerText="#{loc.branch}" sortable="true" sortBy="#{invoice.br.name}" visible="#{invoiceBean.toogleList[0]}" exportable="#{invoiceBean.toogleList[0]}">               
                <h:outputText value="#{invoice.branchSetting.branch.name}"  />
            </p:column>
            <p:column id="clmTransactionDate" headerText="#{loc.invoicedate}" sortable="true" sortBy="#{invoice.inv.invoicedate}" visible="#{invoiceBean.toogleList[1]}" exportable="#{invoiceBean.toogleList[1]}">               
                <h:outputText value="#{invoice.invoiceDate}"  >
                    <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                </h:outputText>
            </p:column>
            <p:column id="clmTermDate" headerText="#{loc.termdate}" sortable="true" sortBy="#{invoice.inv.duedate}" visible="#{invoiceBean.toogleList[2]}" exportable="#{invoiceBean.toogleList[2]}">               
                <h:outputText value="#{invoice.dueDate}"  >
                    <f:convertDateTime pattern="#{sessionBean.user.lastBranch.dateFormat} HH:mm:ss"/>
                </h:outputText>
            </p:column>
            <p:column id="clmDocumentNo" headerText="#{loc.documentnumber}" sortable="true" sortBy="#{invoice.inv.documentnumber}" visible="#{invoiceBean.toogleList[3]}" exportable="#{invoiceBean.toogleList[3]}">
                <h:outputText value="#{invoice.documentSerial}#{invoice.documentNumber}"/>
            </p:column>

            <p:column id="clmCurrentName" headerText="#{loc.currentname}" sortable="true" sortBy="#{invoice.acc.name}" visible="#{invoiceBean.toogleList[4]}" exportable="#{invoiceBean.toogleList[4]}">
                <h:outputText value="#{invoice.account.name}" />
            </p:column>

            <p:column id="clmCurrentCode" headerText="#{loc.accountcode}" sortable="true" sortBy="#{invoice.acc.code}" visible="#{invoiceBean.toogleList[5]}" exportable="#{invoiceBean.toogleList[5]}">
                <h:outputText value="#{invoice.account.code}" />
            </p:column>

            <p:column id="clmTotalPrice" headerText="#{loc.totalprice} #{loc.withtax}" sortable="true" sortBy="#{invoice.inv.totalmoney}" visible="#{invoiceBean.toogleList[6]}" exportable="false" >
                <h:outputText  style="float:right;" value="#{invoice.totalMoney}" rendered="#{invoice.type.id !=26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{invoice.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
                <h:outputText  style="float:right;" value="#{invoice.priceDifferenceTotalMoney}" rendered="#{invoice.type.id ==26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{invoice.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
            </p:column>

            <p:column id="clmTotalPricewithouttax" headerText="#{loc.totalprice} #{loc.withouttax}" sortable="true" sortBy="#{invoice.inv.totalprice}" visible="#{invoiceBean.toogleList[7]}" exportable="false" >
                <h:outputText  style="float:right;" value="#{invoice.totalPrice}" rendered="#{invoice.type.id !=26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{invoice.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
                <h:outputText  style="float:right;" value="#{invoice.priceDifferenceTotalPrice}" rendered="#{invoice.type.id ==26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{invoice.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
            </p:column>


            <p:column id="clmProfit" headerText="#{loc.profitprice}" sortable="true" visible="#{invoiceBean.toogleList[8]}" exportable="false" >
                <h:outputText  style="float:right;" value="#{invoice.totalProfit}" rendered="#{invoice.type.id !=26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="currency" value="#{invoice.currency}"/>
                    <f:attribute name="type" value="currency" />
                </h:outputText>
                <h:outputText  style="float:right;" value="-" rendered="#{invoice.type.id ==26}"/>
            </p:column>

             <!--excel pdf çıktısı için-->

            <p:column id="clmTotalPrice2" headerText="#{loc.totalprice} #{loc.withtax}"  visible="false" exportable="#{invoiceBean.toogleList[6]}" toggleable="false" >
                <h:outputText  style="float:right;" value="#{invoice.totalMoney}" rendered="#{invoice.type.id !=26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="type" value="" />
                </h:outputText>
                <h:outputText  style="float:right;" value="#{invoice.priceDifferenceTotalMoney}" rendered="#{invoice.type.id ==26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="type" value="" />
                </h:outputText>
            </p:column>

            <p:column id="clmTotalPricewithouttax2" headerText="#{loc.totalprice} #{loc.withouttax}"  visible="false" exportable="#{invoiceBean.toogleList[7]}" toggleable="false" >
                <h:outputText  style="float:right;" value="#{invoice.totalPrice}" rendered="#{invoice.type.id !=26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="type" value="" />
                </h:outputText>
                <h:outputText  style="float:right;" value="#{invoice.priceDifferenceTotalPrice}" rendered="#{invoice.type.id ==26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="type" value="" />
                </h:outputText>
            </p:column>

            <p:column id="clmProfit2" headerText="#{loc.profitprice}"  visible="false" exportable="#{invoiceBean.toogleList[8]}" toggleable="false" >
                <h:outputText  style="float:right;" value="#{invoice.totalProfit}" rendered="#{invoice.type.id !=26}">
                    <f:converter converterId="currencyConverter" />
                    <f:attribute name="type" value="" />
                </h:outputText>
                <h:outputText  style="float:right;" value="-" rendered="#{invoice.type.id ==26}"/>
            </p:column>


            <p:column id="clmType" headerText="#{loc.type}" sortable="true" sortBy="#{invoice.typd.name}" visible="#{invoiceBean.toogleList[12]}" exportable="#{invoiceBean.toogleList[12]}" >
                <h:outputText value="#{invoice.type.tag}" />
            </p:column>

            <p:column id="clmStatus" headerText="#{loc.statu}" sortable="true" sortBy="#{invoice.sttd.name}" visible="#{invoiceBean.toogleList[13]}" exportable="#{invoiceBean.toogleList[13]}" >
                <h:outputText value="#{invoice.status.tag}" />
            </p:column>

            <p:column id="clmPurchase" headerText="#{loc.ispurchase}" sortable="true" sortBy="#{invoice.inv.is_purchase}" visible="#{invoiceBean.toogleList[14]}" exportable="#{invoiceBean.toogleList[14]}" >
                <h:outputText value="#{invoice.isPurchase ? loc.purchaseinvoice : loc.salesinvoice}" />
            </p:column>
            
           

        </p:dataTable>  
    </h:form>


    <!--Kitaptan cari seçtirmek için açılan overlay panel-->
    <ui:include src="/pages/general/common/accountbookcheckbox.xhtml" >
        <ui:param name="updateBean" value='#{invoiceBean}' />
        <ui:param name="for" value='frmInvoiceReport:btnCustomer' />
        <ui:param name="type" value='invoiceCheckBox' />
        <ui:param name="parameters" value='#{[invoiceBean.searchObject.selectedBranchList.isEmpty() ? invoiceBean.listOfBranch : invoiceBean.searchObject.selectedBranchList]}' /> 
        <ui:param name="columnsize" value='3' /> 
        <ui:param name="form" value='frmAccountBookFilterCheckbox' /> 
        <ui:param name="overlay" value="olp_accountcheckbox" />
    </ui:include>

    <!--Kitaptan stok seçtirmek için açılan overlay panel-->
    <ui:include src="/pages/general/common/stockbookcheckbox.xhtml" >
        <ui:param name="updateBean" value='#{invoiceBean}' />
        <ui:param name="for" value='frmInvoiceReport:btnStock' />
        <ui:param name="type" value='invoicePage' />
        <ui:param name="parameters" value='#{[invoiceBean.searchObject.selectedBranchList.isEmpty() ? invoiceBean.listOfBranch : invoiceBean.searchObject.selectedBranchList]}' /> 
        <ui:param name="columnsize" value='4' /> 
        <ui:param name="form" value='frmStockBookFilterCheckbox' /> 
        <ui:param name="overlay" value="olp_stockcheckbox" />
    </ui:include>


</ui:composition>
