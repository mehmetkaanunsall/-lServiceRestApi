<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <div class="ContainerIndent">
        <ui:include src="/pages/general/common/datagridtoolbardefinition.xhtml" >
            <ui:param name="bean" value="#{invoiceItemTabBean}"/>
            <ui:param name="update" value="frmInvoiceStokProcess"/> 
            <ui:param name="btnNewId" value="#{!invoiceItemTabBean.isCreateInvFromWaybill and !invoiceItemTabBean.selectedInvoice.isPeriodInvoice and invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and invoiceItemTabBean.getRendered(5, 0) ? 
                                               sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ?
                                               (invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.selectedInvoice.isPurchase) ?  (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill or (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill and invoiceItemTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoiceItemTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}"/>



            <ui:param name="datatable" value="tbvInvoice:frmInvoiceStokTab:dtbStock" />
            <ui:param name="widgetvar" value='invoiceItemPF' />
            <ui:param name="form" value='frmToolbarStock' />
            <ui:param name="fileName" value="#{loc.stocks}"/> 
            <ui:param name="btnQuickAdd" value="#{!invoiceItemTabBean.isCreateInvFromOrder and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceItemTabBean.selectedInvoice.isPeriodInvoice and invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.getRendered(5, 0) and !invoiceItemTabBean.selectedInvoice.isWait and !invoiceItemTabBean.selectedInvoice.isFuel ?
                                                  sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ? 
                                                  (invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.selectedInvoice.isPurchase) ? (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill or (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill and invoiceItemTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoiceItemTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}"/>       
            <ui:param name="renderedUpload" value="#{!invoiceItemTabBean.isCreateInvFromOrder and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceItemTabBean.selectedInvoice.isPeriodInvoice and invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.getRendered(5, 0) and !invoiceItemTabBean.selectedInvoice.isWait and !invoiceItemTabBean.selectedInvoice.isFuel ?
                                                     sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ?
                                                     (invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.selectedInvoice.isPurchase) ? (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill or (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill and invoiceItemTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoiceItemTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}" /> 
            <ui:param name="renderedEInvoiceStock" value="#{!invoiceItemTabBean.isCreateInvFromOrder and ((invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.type.id != 27) or (!invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.type.id == 27)) and invoiceItemTabBean.selectedInvoice.isEInvoice and sessionBean.lastBranchSetting.isEInvoice}"/> 
            <ui:param name="txtPriceForWaybill" value="#{invoiceItemTabBean.selectedInvoice.isPurchase ? loc.bringlastpurchaseprice : loc.bringlastsaleprice}"/> 
            <ui:param name="btnPriceForWaybill" value="#{(invoiceItemTabBean.isCreateInvFromWaybill and !(invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency))   or (invoiceItemTabBean.selectedInvoice.type.id == 27 and invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.getRendered(5, 0) and !invoiceItemTabBean.selectedInvoice.isPeriodInvoice and !(invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency))
                                                         or (invoiceItemTabBean.selectedInvoice.type.id == 23 and invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.getRendered(5, 0) and !invoiceItemTabBean.selectedInvoice.isPeriodInvoice and !(invoiceItemTabBean.selectedInvoice.isPurchase and invoiceItemTabBean.selectedInvoice.branchSetting.branch.isAgency)) ?
                                                         sessionBean.user.lastBranchSetting.isCentralIntegration and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  ? (invoiceItemTabBean.selectedInvoice.type.id == 59 and invoiceItemTabBean.selectedInvoice.isPurchase) ?   (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill or (invoiceItemTabBean.selectedInvoice.sapIsSendWaybill and invoiceItemTabBean.selectedInvoice.sapLogIsSend)) ? 'false' : 'true' : invoiceItemTabBean.selectedInvoice.sapLogIsSend ? 'false' : 'true' : 'true' : 'false'}"/> 
        </ui:include>


        <h:form id="frmInvoiceStokTab">
            <p:remoteCommand name="goToRelatedRecord" actionListener="#{invoiceItemTabBean.goToRelatedRecord()}" delay="200"/>
            <p:remoteCommand name="invItemCalculater" global="false" actionListener="#{invoiceItemTabBean.calcInvoicePrice()}" />
            <p:remoteCommand name="sowDiscountChange" global="false" actionListener="#{invoiceItemTabBean.showDiscountChangeDialog()}" />
            <p:commandButton id="updateDatatableForDiscount" process="@this" style="display: none;" ajax="true" global="false"  update="tbvInvoice:frmInvoiceStokTab:dtbStock"></p:commandButton>
            <p:dataTable id="dtbStock"  var="invoiceStock" value="#{invoiceItemTabBean.listOfObjects}" filteredValue="#{invoiceItemTabBean.listOfFilteredObjects}" selectionMode="single" 
                         selection="#{invoiceItemTabBean.selectedObject}" widgetVar="invoiceItemPF" rowKey="#{invoiceItemTabBean.selectedInvoice.isWait or invoiceItemTabBean.isCreateInvFromOrder ? invoiceStock.stock.id : invoiceStock.id}" emptyMessage="#{loc.norecordsfound}" class="tabDatatable600px datatableDraggable"
                         rows="#{sessionBean.user.defualtGridSize}" 
                         paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                         rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}" 
                         editable="true" editMode="cell" resizableColumns="true" resizeMode="expand">

                <p:ajax event="#{sessionBean.user.gridRowSelect}" resetValues="true" listener="#{invoiceItemTabBean.update()}" update="frmInvoiceStokProcess"  transient="true" />  
                <p:ajax event="page" global="false"/>
                <p:ajax event="filter" global="false" oncomplete="updateGrid()"/>
                <p:ajax event="cellEdit" listener="#{invoiceItemTabBean.onCellEditDiscount}" />
                <p:ajax event="colResize"  listener="#{invoiceItemTabBean.onResize}" />

                <f:facet  name="footer"     >
                    <p:inputText id="globalFilter" value="#{invoiceItemTabBean.autoCompleteValue}"  style="display: none" />
                </f:facet>

                <p:column id="clmStockBarcode" headerText="#{loc.stockbarcode}" width="150" sortBy="#{invoiceStock.stock.barcode}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.barcode}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.barcode}" />
                </p:column>

                <p:column id="clmStockCenterProductCode" headerText="#{loc.centerstockcode}" width="150" sortBy="#{invoiceStock.stock.centerProductCode}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.centerProductCode}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.centerProductCode}" />
                </p:column>

                <p:column id="clmStockName" headerText="#{loc.stockname}"  width="150" sortBy="#{invoiceStock.stock.name}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.name}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.name}" />

                </p:column>

                <p:column id="clmType" headerText="#{loc.type}"  width="100" sortBy="#{invoiceStock.isService}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.isService}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.isService ? loc.service : loc.product}" />
                </p:column>

                <p:column id="clmPriceListPrice" headerText="#{loc.saleprice}"  width="100" sortBy="#{invoiceStock.stock.stockInfo.currentSalePrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.stock.stockInfo.currentSalePrice}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.stock.stockInfo.currentSalePrice}" style="float: right;" rendered="#{invoiceStock.stock.stockInfo.currentSalePrice!=null}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.stock.stockInfo.currentSaleCurrency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.stock.stockInfo.currentSalePrice==null}"/>
                </p:column>

                <p:column id="clmAmount" headerText="#{loc.amount}"  width="100" sortBy="#{invoiceStock.quantity}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.quantity}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.quantity}" rendered="#{invoiceStock.quantity>0}" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="unit" value="#{invoiceStock.unit}"/>
                        <f:attribute name="type" value="unit" />
                    </h:outputText>
                    <h:outputText value="-" rendered="#{invoiceStock.quantity==0}"/>
                </p:column>

                <p:column id="clmUnitPrice" headerText="#{loc.unitprice}"  width="100" sortBy="#{invoiceStock.unitPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.unitPrice}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.unitPrice}" style="float: right;" rendered="#{invoiceStock.unitPrice>0}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.unitPrice==0}"/>
                </p:column>


                <p:column id="clmDiscountRate"  headerText="#{loc.discountrate}1"  width="110" sortBy="#{invoiceStock.discountRate}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.discountRate}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <p:cellEditor rendered="#{invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree}">
                        <f:facet name="output">
                            <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountRate==0}" />
                            <h:outputText value="#{invoiceStock.discountRate}" style="float: right;" rendered="#{invoiceStock.discountRate>0}">
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="type" value="percent" />
                            </h:outputText>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{invoiceStock.discountRate}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                           decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="0"
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                           roundMethod="D" emptyValue=""/>  
                        </f:facet>
                    </p:cellEditor>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountRate==0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill)}" />
                    <h:outputText value="#{invoiceStock.discountRate}" style="float: right;" rendered="#{invoiceStock.discountRate>0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree)}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="percent" />
                    </h:outputText>
                </p:column>

                <p:column id="clmDiscountPrice" headerText="#{loc.discountamount}1"  width="110" sortBy="#{invoiceStock.discountPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.discountPrice}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <p:cellEditor rendered="#{invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree}">
                        <f:facet name="output">
                            <h:outputText value="#{invoiceStock.discountPrice}" style="float: right;" rendered="#{invoiceStock.discountPrice>0}" >
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                                <f:attribute name="type" value="currency" />
                            </h:outputText>
                            <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountPrice==0}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{invoiceStock.discountPrice}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                           decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="0"
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                           roundMethod="D" emptyValue=""/>  
                        </f:facet>
                    </p:cellEditor>
                    <h:outputText value="#{invoiceStock.discountPrice}" style="float: right;" rendered="#{invoiceStock.discountPrice>0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree)}" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountPrice==0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill)}"/>
                </p:column>
                <p:column id="clm2DiscountRate"  headerText="#{loc.discountrate}2"  width="110" sortBy="#{invoiceStock.discountRate2}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.discountRate2}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <p:cellEditor rendered="#{invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree}">
                        <f:facet name="output">
                            <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountRate2==0}" />
                            <h:outputText value="#{invoiceStock.discountRate2}" style="float: right;" rendered="#{invoiceStock.discountRate2>0}">
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="type" value="percent" />
                            </h:outputText>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{invoiceStock.discountRate2}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                           decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="0"
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                           roundMethod="D" emptyValue=""/>  
                        </f:facet>
                    </p:cellEditor>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountRate2==0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill)}" />
                    <h:outputText value="#{invoiceStock.discountRate2}" style="float: right;" rendered="#{invoiceStock.discountRate2>0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree)}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="percent" />
                    </h:outputText>
                </p:column>
                <p:column id="clm2DiscountPrice" headerText="#{loc.discountamount}2"  width="110" sortBy="#{invoiceStock.discountPrice2}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.discountPrice2}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <p:cellEditor rendered="#{invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree}">
                        <f:facet name="output">
                            <h:outputText value="#{invoiceStock.discountPrice2}" style="float: right;" rendered="#{invoiceStock.discountPrice2>0}" >
                                <f:converter converterId="currencyConverter" />
                                <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                                <f:attribute name="type" value="currency" />
                            </h:outputText>
                            <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountPrice2==0}"/>
                        </f:facet>
                        <f:facet name="input">
                            <p:inputNumber value="#{invoiceStock.discountPrice2}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                           decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="0"
                                           thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                           decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                           roundMethod="D" emptyValue=""/>  
                        </f:facet>
                    </p:cellEditor>
                    <h:outputText value="#{invoiceStock.discountPrice2}" style="float: right;" rendered="#{invoiceStock.discountPrice2>0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill and !invoiceStock.isFree)}" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.discountPrice2==0 and !(invoiceItemTabBean.selectedInvoice.status.id==28 and invoiceItemTabBean.selectedInvoice.posId==0 and !invoiceProcessBean.isCreateInvFromCustAgreement and invoiceItemTabBean.isCreateInvFromCustomerAgreement and !invoiceItemTabBean.isCreateInvFromWaybill)}"/>
                </p:column>

                <p:column id="clmInvoiceBasedDiscount" headerText="#{loc.invoicebaseddiscount}"  width="150" sortBy="#{invoiceStock.invoiceDiscountPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.invoiceDiscountPrice}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.invoiceDiscountPrice}" style="float: right;" rendered="#{invoiceStock.invoiceDiscountPrice>0}" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.invoiceDiscountPrice==0}"/>
                </p:column>

                <p:column id="clmInterimPrice"  width="100" headerText="#{loc.taxfreeamount}" sortBy="#{invoiceStock.totalPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalPrice}" filterMatchMode="contains" >
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalPrice}" style="float: right;" rendered="#{invoiceStock.totalPrice>0}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.totalPrice==0}"/>
                </p:column>


                <p:column id="clmTaxRate"  width="100" headerText="#{loc.taxrate}" sortBy="#{invoiceStock.taxRate}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.taxRate}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.taxRate}" style="float: right;" rendered="#{invoiceStock.taxRate != null}" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="percent" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.taxRate == null}"/>
                </p:column>

                <p:column id="clmTaxPrice" headerText="#{loc.taxprice}"  width="100" sortBy="#{invoiceStock.totalTax}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalTax}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalTax}" style="float: right;" >
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>

                <p:column id="clmProfitRate" headerText="#{loc.profitpercentage}"  width="100" sortBy="#{invoiceStock.profitPercentage}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.profitPercentage}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.profitPercentage}" style="float: right;" rendered="#{invoiceStock.profitPercentage!=null}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="type" value="percent" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.profitPercentage==null}"/>
                </p:column>
                <p:column id="clmProfitPrice" headerText="#{loc.profitprice}"  width="100" sortBy="#{invoiceStock.profitPrice}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.profitPrice}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.profitPrice}" style="float: right;" rendered="#{invoiceStock.profitPrice!=null}">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                    <h:outputText value="-" style="float: right;" rendered="#{invoiceStock.profitPrice==null}"/>
                </p:column>

                <p:column id="clmPrice" headerText="#{loc.totalprice}"  width="100" sortBy="#{invoiceStock.totalMoney}" sortable="true"  filterable="true"  filterBy="#{invoiceStock.totalMoney}" filterMatchMode="contains">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalMoney}" style="float: right;">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceStock.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>

                <p:column id="clmExchangePrice" headerText="#{loc.exchangeprice}"  width="100" rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}">
                    <f:facet name="filter">
                        <p:outputLabel   rendered="false" />
                    </f:facet>
                    <h:outputText value="#{invoiceStock.totalMoney*invoiceStock.exchangeRate}" style="float: right;">
                        <f:converter converterId="currencyConverter" />
                        <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                        <f:attribute name="type" value="currency" />
                    </h:outputText>
                </p:column>

                <p:columnGroup type="footer" class="Fright">

                    <!-- stokların toplam tutarı -->
                    <p:row>
                        <p:column colspan="4" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.totalamount} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="2" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{invoiceItemTabBean.totalAmountText()}" style="font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 12 : 11}" style="text-align:right; font-weight: bold; " priority="1">
                            <f:facet name="footer"  >
                                <h:outputText value="#{loc.subtotal} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column> 
                        <p:column colspan="1" style="text-align:right; font-weight: bold; ">
                            <f:facet name="footer"  >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.sumTotalPrice()}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>

                    </p:row>

                    <!-- stokların ıskonto toplamı -->
                    <p:row >
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 12 : 11}" style="text-align:right;" priority="1">
                            <f:facet  name="footer" >
                                <h:outputText value="#{loc.invoicebaseddiscount}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="1" style="text-align:right;">
                            <f:facet name="footer" >
                                <h:outputText id="txtInvoiceDiscount" rendered="#{invoiceItemTabBean.selectedInvoice.discountRate==0}" style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.selectedInvoice.discountPrice}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>

                                <h:outputText id="txtInvoiceRate" rendered="#{invoiceItemTabBean.selectedInvoice.discountRate>0}" style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.selectedInvoice.discountRate}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="type" value="percent" />
                                </h:outputText>
                            </f:facet>
                        </p:column> 
                        <p:column colspan="5" style="text-align:right;" priority="1">
                            <f:facet  name="footer" >
                                <h:outputText value="#{loc.penbaseddiscount}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="2" style="text-align:right;">
                            <f:facet name="footer" >
                                <h:outputText id="txtPenDiscount" style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.totalDiscount}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column> 
                        <p:column colspan="2" style="text-align:right;" priority="1">
                            <f:facet  name="footer" >
                                <h:outputText value="#{loc.totaldiscount}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="2" style="text-align:right;">
                            <f:facet name="footer" >
                                <h:outputText id="txtDiscount" style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.totalDiscount+invoiceItemTabBean.selectedInvoice.discountPrice}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column> 
                    </p:row>

                    <!-- vergi oranlarının ayrı ayrı gosterılmesı-->
                    <p:row>
                        <p:column colspan="16" rendered="#{sessionBean.lastBranchSetting.isForeignCurrency}" style="text-align:right;" priority="1">
                            <f:facet name="footer">
                                <h:outputText value="#{loc.taxamountwithexchange}: #{invoiceItemTabBean.taxRates}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 2 : 17}" style="text-align:right;" priority="1">
                            <f:facet name="footer" >
                                <h:outputText value=" #{loc.totaltaxprice}" style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>
                        <!-- toplam vergı -->
                        <p:column colspan="2" style="text-align:right;">
                            <f:facet name="footer" >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.selectedInvoice.totalTax}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:row>
                    <!--Kar Toplamı-->
                    <p:row>
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 18 : 17}" style="text-align:right;" priority="1">
                            <f:facet name="footer" >
                                <h:outputText value="#{loc.totalprofitprice} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="2" style="text-align:right;" >
                            <f:facet name="footer" >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.selectedInvoice.totalProfit}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:row>
                    <!-- yuvarlama miktarı -->
                    <p:row  >
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 18 : 17}" style="text-align:right;" priority="1">
                            <f:facet name="footer" >
                                <h:outputText value="#{loc.roundingprice} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="2" style="text-align:right;" >
                            <f:facet name="footer" >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.selectedInvoice.roundingPrice}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:row>
                    <ui:repeat value="#{invoiceItemTabBean.listOfTaxs}" var="taxs" >
                        <p:row>
                            <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 18 : 17}" style="text-align:right;" priority="1">
                                <f:facet name="footer"  >
                                    <h:outputText value="#{loc.tax}" style="text-align:right; font-weight: bold;" />
                                    <h:outputText value=" (" style="text-align:right; font-weight: bold;" />
                                    <h:outputText value="#{taxs.taxRate}" style="text-align:right; font-weight: bold;" >
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="type" value="percent" />
                                    </h:outputText>
                                    <h:outputText value=") " style="text-align:right; font-weight: bold;" />
                                </f:facet>
                            </p:column>
                            <p:column colspan="2" style="text-align:right;" >
                                <f:facet name="footer" >
                                    <h:outputText  style="text-align:right; font-weight: bold; " value="#{taxs.totalTax}" >
                                        <f:converter converterId="currencyConverter" />
                                        <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                        <f:attribute name="type" value="currency" />
                                    </h:outputText>
                                </f:facet>
                            </p:column>
                        </p:row>
                    </ui:repeat>

                    <!-- ödenecek tutar -->
                    <p:row  >
                        <p:column colspan="#{sessionBean.lastBranchSetting.isForeignCurrency ? 18 : 17}" style="text-align:right;" priority="1">
                            <f:facet name="footer" >
                                <h:outputText value="#{loc.grandtotal} " style="text-align:right; font-weight: bold; " />
                            </f:facet>
                        </p:column>

                        <p:column colspan="2" style="text-align:right;" >
                            <f:facet name="footer" >
                                <h:outputText  style="text-align:right; font-weight: bold; " value="#{invoiceItemTabBean.selectedInvoice.totalMoney}" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="currency" value="#{invoiceItemTabBean.selectedInvoice.currency}"/>
                                    <f:attribute name="type" value="currency" />
                                </h:outputText>
                            </f:facet>
                        </p:column>
                    </p:row>
                </p:columnGroup>


            </p:dataTable>
            <p:remoteCommand name="order" actionListener="#{invoiceItemTabBean.bringOrder('tbvInvoice:frmInvoiceStokTab:dtbStock')}"  autoRun="true"  global="false" />
            <p:remoteCommand name="updateGrid" actionListener="#{invoiceItemTabBean.updateGridProperties('tbvInvoice:frmInvoiceStokTab:dtbStock')}"  global="false" />
        </h:form>
    </div>


    <!--/////////////////////////////////////////////////////////////////////////////////////////////////////// -->

    <p:dialog id="dlgStockFileUpload" widgetVar="dlg_stockfileupload" modal="true" dynamic="true" resizable="false" focus="dlgStockFileUpload"  responsive="true" closeOnEscape="true" width="35%" style="overflow-x: auto !important">
        <h:form id="form" enctype="multipart/form-data" > 
            <p:panelGrid id="pgrfileformat">
                <div>               
                    <table class="tableUp" style="border: 1px solid;border-color: #316996;background-color: #fbfcfd;">
                        <thead>
                            <tr >
                                <th scope="col" colspan="4" class="Fs16 TexAlLeft"><h:outputText value="#{loc.fileformattobeuploaded}" style="color: #303030 !important;"/></th>
                            </tr>
                            <tr >
                                <th scope="col" class="Fs14 TexAlCenter"><h:outputText value="#{loc.barcode}" style="color:#4c4b4b;"/> <h:outputText value=" (#{loc.cell} A)" style="color:#337190" class="Fs12"/><h:outputText value=" (*) "  class="Fs16 fontBold red"/></th>
                                <th scope="col" class="Fs14 TexAlCenter"><h:outputText value="#{loc.quantity}" style="color:#4c4b4b;"/> <h:outputText value=" (#{loc.cell} B)" style="color:#337190" class="Fs12"/><h:outputText value=" (*) "  class="Fs16 fontBold red"/></th>
                                <th scope="col" class="Fs14 TexAlCenter"><h:outputText value="#{loc.unitprice}" style="color:#4c4b4b;"/> <h:outputText value=" (#{loc.cell} C)" style="color:#337190" class="Fs12"/><h:outputText value=" (*) "  class="Fs16 fontBold red"/></th>
                                <th scope="col" class="Fs14 TexAlCenter"><h:outputText value="#{loc.taxinformation}" style="color:#4c4b4b;"/> <h:outputText value=" (#{loc.cell} D)" style="color:#337190" class="Fs12"/><h:outputText value=" (*) "  class="Fs16 fontBold red"/></th>
                            </tr>
                        </thead>
                        <tbody>    
                            <c:forEach items="#{invoiceItemTabBean.sampleList}" var="sample">
                                <tr>
                                    <td class="TexAlCenter Fs14"><h:outputText class="Fs14" value="#{sample.stock.barcode}" /></td>
                                    <td class="TexAlCenter Fs14"><h:outputText class="Fs14" value="#{sample.quantity}" /></td>
                                    <td class="TexAlCenter Fs14"><h:outputText class="Fs14" value="#{sample.unitPrice}" /></td>
                                    <td class="TexAlCenter Fs14"><h:outputText class="Fs14" value="#{sample.isTaxIncluded ? 1:0}" /></td>
                                </tr>
                            </c:forEach>

                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2" rowspan="2"><h:outputText value="#{loc.taxinformation}"/> <h:outputText value=" (#{loc.cell} D)" style="color:#337190" class="Fs12"/></td>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="0 : #{loc.vatexcluded}"/></td>
                            </tr>

                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="1 : #{loc.vatincluded}"/></td>
                            </tr>

                            <tr>
                                <td class="TexAlLeft Fs14" colspan="2" rowspan="1"><h:outputText value="#{loc.iconincolumn} " class="Fs14"/><h:outputText value=" (*) " class="Fs14 fontBold red" style="margin-left: 10px"/></td>
                                <td class="TexAlLeft Fs14" colspan="2"><h:outputText value="#{loc.itismandatorytoenterinformationintothesefields}" class="fontBold"/></td>
                            </tr>
                        </tbody>
                    </table>
                </div>                    
            </p:panelGrid>

            <div class="EmptyBox20" />

            <p:panelGrid  id="pgrFileUpload" class="pgrResponsive">
                <div class="ui-g">
                    <h:panelGroup layout="block">
                        <p:row>
                            <p:column colspan="7" style="font-weight: bold;font-size: 16px"> <h:outputText value="#{loc.fileselectionandtransferoperations}" /></p:column>
                        </p:row>
                        <p:row>
                            <p:column colspan="4">
                                <table style="width: 150px !important;table-layout: fixed;border: none !important;" >
                                    <tbody>
                                        <tr>
                                            <p:fileUpload  update="@this,tbvInvoice:form:btnTransfer ,tbvInvoice:form:btnClose,tbvInvoice:form:txtFileName"  allowTypes="/(\.|\/)(xls|xlsx|xls|xlsm|xlsb|xltx|xltm|xlt|xla|xlw|xlr|)$/" invalidFileMessage="#{loc.invalidfiletype}" invalidSizeMessage="#{loc.filesizecannotbegreaterthan1mb}"
                                                           class="#{invoiceItemTabBean.fileNames.length()==0 ? 'fileUploadEmpty' : 20>invoiceItemTabBean.fileNames.length() ? 'fileUploadSmall'  : 'fileUploadLong'}" label="#{loc.choosefile}" fileLimit="1"  auto="true" sizeLimit="10000000" style="width: 150px;" fileUploadListener="#{invoiceItemTabBean.handleFileUploadFile}"  mode="advanced"  multiple="true" dragDropSupport="false" />
                                        </tr>

                                        <tr>
                                            <td style="width: 100px;border:none !important;"><h:outputText id="txtFileName"  styleClass="wrapLabel" value="#{invoiceItemTabBean.fileNames}" /> </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </p:column> 
                            <p:column  colspan="3">         
                                <p:commandButton id="btnTransfer" icon="fa fa-exchange" process="@this" disabled="#{invoiceItemTabBean.isOpenTransferBtn}" resetValues="true" value="#{loc.transfer}" update="@this,tbvInvoice:form:btnTransfer ,tbvInvoice:form:btnClose,tbvInvoice:form:txtFileName" actionListener="#{invoiceItemTabBean.convertUploadData()}" />
                                <p:commandButton id="btnClose"  icon="fa fa-close" process="@this" disabled="#{invoiceItemTabBean.isOpenCancelBtn}" resetValues="true" value="#{loc.remove}" update="@this,tbvInvoice:form:btnTransfer ,tbvInvoice:form:btnClose,tbvInvoice:form:txtFileName" actionListener="#{invoiceItemTabBean.clear()}" />
                            </p:column>
                        </p:row>
                    </h:panelGroup>
                </div>
            </p:panelGrid> 
        </h:form>
    </p:dialog>



    <p:dialog id="dlgProductView" widgetVar="dlg_productView" showEffect="fade" hideEffect="fade" resizable="false" transient="true" modal="true" closeOnEscape="true" responsive="true" width="60%" class=" overflow-y: auto !important; max-height: 570px;" >
        <p:ajax event="close" update="form:btnTransfer" listener="#{invoiceItemTabBean.clearProducts()}" global="false"/> 
        <h:form id="frmtoolbar" prependId="false">
            <p:toolbar>
                <f:facet name="left">
                    <h:outputText value="#{loc.productstobetransferredfromthefile}" class="outputTextFont Fleft MarRight8" />
                </f:facet>

                <f:facet name="right">
                    <p:commandLink id="btnSave" disabled="#{invoiceItemTabBean.isOpenSaveBtn}" title="#{loc.transfer}" process="@this"  class="Fright" update="tbvInvoice:frmInvoiceStokTab:dtbStock"  actionListener="#{invoiceItemTabBean.saveItem()}"  >
                        <i class="fa fa-save Fs20 MarTop5 tlbrSaveBtn"/>                 
                    </p:commandLink>
                </f:facet>
            </p:toolbar>



            <h:panelGroup id="pgrIsError" >
                <p:separator style="margin-top: 0px !important; margin-bottom: 5px;" class="allCheckSeparator"/>
                <div class="ui-g  allCheckPanelGrid" style="display: block; border-bottom : 0px !important; border-radius: 0px !important; box-shadow: none !important; padding: 0px !important">
                    <p:selectBooleanCheckbox value="#{invoiceItemTabBean.isOpenErrorData}" itemLabel="#{loc.showincorrectrecords}" class="Fleft allcheck" style="margin-top: 2px; margin-left: 5px; padding: 1px 10px !important; font-size: 14px !important">
                        <p:ajax global="false" resetValues="true" listener="#{invoiceItemTabBean.showErrorProductList()}"/>
                    </p:selectBooleanCheckbox>

                    <p:selectBooleanCheckbox value="#{invoiceItemTabBean.isAll}" itemLabel="#{loc.all}" class="Fleft allcheck" style="margin-top: 2px; margin-left: 5px; padding: 1px 10px !important; font-size: 14px !important">
                        <p:ajax global="false" resetValues="true" listener="#{invoiceItemTabBean.allSelect()}"/>
                    </p:selectBooleanCheckbox>

                    <p:commandButton class="btnClear" value="#{loc.clear}" title="#{loc.clearselected}" actionListener="#{invoiceItemTabBean.clearSelected()}" icon="ui-icon-trash"  process="@this" style="margin-top: 2px" />
                </div>

            </h:panelGroup>


        </h:form>

        <!-- Aktar butonuna bastıktan sonra ürünlerin önizleme ile gösterildiği dialogda kaydete basıldıktan sonra bilgileri kontrol edilen ürünlerin kullanıcıya gösterildiği yer -->
        <h:panelGroup>
            <h:form id="frmProductView"> 
                <p:commandButton id="updateDatatable2"   process="@this" style="display: none;" ajax="true" global="false"  update="tbvInvoice:frmProductView"></p:commandButton>
                <p:dataTable  id="dtbProductView" var="viewProduct" editable="true" editMode="cell" value="#{invoiceItemTabBean.excelList}" selection="#{invoiceItemTabBean.listOfSelectedItems}"  widgetVar="viewPdocutPF" emptyMessage="#{loc.norecordsfound}"
                              rows="#{sessionBean.user.defualtGridSize}" rowKey="#{viewProduct.rowId}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                              rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}"  reflow="true"
                              rowSelectMode="checkbox" rowStyleClass="#{viewProduct.excelDataType==-1 or viewProduct.excelDataType==2 or viewProduct.excelDataType==3 or viewProduct.excelDataType==4 or viewProduct.excelDataType==5 or viewProduct.excelDataType==6 or viewProduct.excelDataType==7 or viewProduct.excelDataType==8 ? 'ColumnColorRed' : (viewProduct.invoice.isPurchase and  viewProduct.stock.stockInfo.isFuel and (viewProduct.unitPrice > viewProduct.fuelPrice)) or (viewProduct.stock.stockInfo.saleMandatoryPrice > 0) or (viewProduct.excelUnitPriceTaxExcluded > viewProduct.lastPurchasePrice ) ? 'ColumnColorYellow' : null}" 
                              class="salaryPaymentDatatable"  >

                    <p:ajax event="cellEdit"  listener="#{invoiceItemTabBean.onCellEditPurchaseProfit}" oncomplete="updateDatatable2()" global="false"/>
                    <p:ajax event="page" global="false"/>
                    <p:ajax event="filter" global="false"/>
                    <p:ajax event="rowSelectCheckbox" global="false" update="dtbProductView" listener="#{invoiceItemTabBean.rowSelect}"/>
                    <p:ajax event="rowUnselectCheckbox" global="false"  />
                    <p:ajax event="toggleSelect" global="false" update="dtbProductView" listener="#{invoiceItemTabBean.toggleSelectedCheckbox}"/>


                    <p:column selectionMode="multiple" style="width:26px; text-align:center;" selectRow="false"/>


                    <p:column headerText="#{loc.barcode}" selectRow="false">
                        <h:outputText value="#{viewProduct.stock.barcode}" class="Fright" />
                    </p:column>

                    <p:column headerText="#{loc.quantity}" selectRow="false">
                        <h:outputText value="#{viewProduct.quantity}"  class="Fright" >
                            <f:convertNumber type="number" maxFractionDigits="2" />
                        </h:outputText>
                    </p:column>

                    <p:column id="clmPrice2" selectRow="false" headerText="#{loc.unitprice}"  rendered="#{!invoiceItemTabBean.selectedInvoice.isPurchase}"  >
                        <h:outputText value="#{viewProduct.unitPrice}" style="float: right" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="currency" />
                            <f:attribute name="currency" value="#{viewProduct.currency}"/>
                        </h:outputText>
                    </p:column>

                    <p:column id="clmPrice" selectRow="false" headerText="#{loc.unitprice}"  rendered="#{invoiceItemTabBean.selectedInvoice.isPurchase}"  >
                            <h:outputText value="#{viewProduct.excelUnitPrice}" style="float: right"> <!-- rendered="#{!(viewProduct.unitPrice > viewProduct.fuelPrice)}"-->
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="currency" />
                            <f:attribute name="currency" value="#{viewProduct.currency}"/>
                        </h:outputText>
                    </p:column>

                    <p:column id="clmIsTaxIncluded" selectRow="false" headerText="#{loc.taxinformation}"  >   
                        <h:outputText value="#{viewProduct.excelIsTaxInclued ? loc.vatincluded :loc.vatexcluded}"/>
                    </p:column>

                    <p:column id="clmProfitRate" selectRow="false" headerText="#{loc.profitpercentage}" rendered="#{invoiceItemTabBean.selectedInvoice.isPurchase}" >
                        <h:outputText value="#{viewProduct.profitRate}" style="float: right" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="currency" value=""/>
                            <f:attribute name="type" value="percent" />
                        </h:outputText>
                    </p:column>


                    <p:column id="clmRecommendedSalesPrice" selectRow="false" headerText="#{loc.newsalesprice}" rendered="#{invoiceItemTabBean.selectedInvoice.isPurchase}"  >
                        <p:cellEditor rendered="#{viewProduct.stock.id>0 and invoiceItemTabBean.getRendered(143, 0)}"> 
                            <f:facet name="output" >
                                <h:outputText value="#{viewProduct.recommendedSalesPrice}" style="float: right" >
                                    <f:converter converterId="currencyConverter" />
                                    <f:attribute name="type" value="currency" />
                                    <f:attribute name="currency" value="#{viewProduct.currency}"/>
                                </h:outputText>
                            </f:facet>
                            <f:facet name="input">
                                <p:inputNumber value="#{viewProduct.recommendedSalesPrice}" class="editableinput" onclick="this.setSelectionRange(0, this.value.length)"
                                               decimalSeparator="#{sessionBean.user.lastBranch.decimalsymbol ==1 ? '.': ','}"  minValue="1"
                                               thousandSeparator="#{sessionBean.user.lastBranch.decimalsymbol==1 ? ',': '.'}"
                                               decimalPlaces="#{sessionBean.user.lastBranch.currencyrounding}"
                                               roundMethod="D" emptyValue=""/>  
                            </f:facet>
                        </p:cellEditor>
                        <h:outputText value="#{viewProduct.recommendedSalesPrice}"  style="float: right" rendered="#{!(viewProduct.stock.id>0 and invoiceItemTabBean.getRendered(143, 0))}" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="currency" />
                            <f:attribute name="currency" value="#{viewProduct.currency}"/>
                        </h:outputText>
                    </p:column>  

       <!--             <p:column id="clmMaximumPurchasePrice" headerText="#{loc.maximumpurchaseprice}" rendered="#{invoiceItemTabBean.selectedInvoice.isPurchase}" class="TexAlRight"> 
                        <h:outputText value="#{viewProduct.fuelPrice}" >
                            <f:convertNumber type="number" groupingUsed="true" minFractionDigits="0" maxFractionDigits="2" pattern="#0.00"/>
                        </h:outputText>
                        <h:outputText value=" " />
                        <h:outputText value="#{viewProduct.fuelPrice > 0 ? sessionBean.currencySignOrCode(invoiceItemTabBean.selectedInvoice.currency.id, 0) : ''} "/>
                    </p:column> 
                    -->

                    <p:column id="clmDescription" selectRow="false" headerText="#{loc.description}" rendered="#{invoiceItemTabBean.selectedInvoice.isPurchase}" >
                        <h:outputText value="#{viewProduct.excelDataType == 8 ? loc.sincetheroundingvalueoftheproductsunitis0enteranondecimalvalueinthequantityfield  : viewProduct.excelDataType==6 ? loc.theproductcannotbeaddedbecauseitisdelisted : viewProduct.excelDataType==5 ?  loc.pricedifferentthanrecommendedpurchasepricecannotbeenentered : viewProduct.excelDataType== 4 ? loc.differentstockcannotbeenteredintank : viewProduct.excelDataType== 7 ? loc.sincetheprofitabilitytoleranceisexceededandtheproductisthemandatorysalespricetheproductcannotbeaddedwiththispurchaseprice : (viewProduct.stock.stockInfo.isFuel and (viewProduct.unitPrice > viewProduct.fuelPrice)) ? loc.purchasepriceexceedsmaximumpurchaseprice : (viewProduct.excelUnitPriceTaxExcluded > viewProduct.lastPurchasePrice )? loc.astheunitpriceofthepurchaseischangedtherecommendedsalespricewillbeupdated :viewProduct.stock.id==0 ? loc.stockinformationnotfound   : viewProduct.excelDataType== 3 ?  loc.purchasecannotbeperformedabovethemaximumstocklevel : ''}" class="Fleft" />
                    </p:column>

                    <p:column id="clmMandatoryPrice" selectRow="false" headerText="#{loc.mandatorysaleprice}" rendered="#{!invoiceItemTabBean.selectedInvoice.isPurchase}" class="TexAlRight"> 
                        <h:outputText value="#{viewProduct.stock.stockInfo.saleMandatoryPrice > 0 ? viewProduct.stock.stockInfo.saleMandatoryPrice :''}"  >
                            <f:convertNumber type="number" groupingUsed="true" minFractionDigits="0" maxFractionDigits="2" pattern="#0.00"/>
                        </h:outputText>
                        <h:outputText value=" "    />
                        <h:outputText value="#{viewProduct.stock.stockInfo.saleMandatoryPrice > 0 ? (viewProduct.stock.stockInfo.saleMandatoryCurrency.id>0 ? sessionBean.currencySignOrCode(viewProduct.stock.stockInfo.saleMandatoryCurrency.id, 0) :'') : ''} " />
                    </p:column>

                    <p:column id="clmDescriptionSale" selectRow="false" headerText="#{loc.description}" rendered="#{!invoiceItemTabBean.selectedInvoice.isPurchase}">
                        <h:outputText value="#{viewProduct.stock.stockInfo.saleMandatoryPrice >0 ? loc.theproducthasaforcedsellingprice  : viewProduct.stock.id==0 ? loc.stockinformationnotfound  :  viewProduct.excelDataType== 2 ?  loc.stockcannotdroptonegativebalance  : viewProduct.excelDataType== 4 ? loc.differentstockcannotbeenteredintank : ''}" class="Fleft" />
                    </p:column>    
                </p:dataTable>
            </h:form>
        </h:panelGroup>
    </p:dialog>




    <p:dialog id="dlgProductViewFirst" widgetVar="dlg_productViewFirst" showEffect="fade" hideEffect="fade" resizable="false" transient="true" modal="true" closeOnEscape="true" responsive="true" width="60%" class=" overflow-y: auto !important; max-height: 570px;" >

        <h:form id="frmtoolbarfirst" prependId="false">
            <p:toolbar>
                <f:facet name="left">
                    <h:outputText value="#{loc.productstobetransferredfromthefile}" class="outputTextFont Fleft MarRight8" />
                </f:facet>

                <f:facet name="right">
                    <p:commandLink id="btnSaveFirst" disabled="#{invoiceItemTabBean.isOpenSaveBtn}" title="#{loc.transfer}" process="@this"  class="Fright" update="tbvInvoice:frmInvoiceStokTab:dtbStock"  actionListener="#{invoiceItemTabBean.saveControlItem()}"  >
                        <i class="fa fa-save Fs20 MarTop5 tlbrSaveBtn"/>                 
                    </p:commandLink>
                </f:facet>
            </p:toolbar>

            <h:panelGroup id="pgrIsErrorFirst" >
                <p:separator style="margin-top: 0px !important; margin-bottom: 5px;" class="allCheckSeparator"/>
                <p:panelGrid layout="grid" columns="1" class="allCheckPanelGrid" style="border-radius: 0px !important; border-bottom: 0px !important;">  
                    <p:selectBooleanCheckbox value="#{invoiceItemTabBean.isOpenErrorData}" itemLabel="#{loc.showincorrectrecords}" class="Fleft allcheck" style="margin-top: 2px; margin-left: 5px;">
                        <p:ajax global="false" resetValues="true" listener="#{invoiceItemTabBean.showErrorProductListFirst()}"/>
                    </p:selectBooleanCheckbox>
                </p:panelGrid>
            </h:panelGroup>
        </h:form>

        <!-- Aktar butonuna bastıktan sonra ürünlerin önizleme ile gösterildiği yer  -->
        <h:panelGroup>
            <h:form id="frmProductViewFirst">
                <p:dataTable  id="dtbProductViewFirst" var="viewProductFirst"  value="#{invoiceItemTabBean.excelStockList}"  widgetVar="viewPdocutFirstPF" emptyMessage="#{loc.norecordsfound}"
                              rows="#{sessionBean.user.defualtGridSize}" rowKey="#{viewProductFirst.rowId}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                              rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}"  reflow="true"
                              rowStyleClass="#{viewProductFirst.excelDataType==-1 or viewProductFirst.excelDataType==2 or viewProductFirst.excelDataType==3 or viewProductFirst.excelDataType==4 or viewProductFirst.excelDataType==5 or viewProductFirst.excelDataType==6 ? 'ColumnColorRed' : (viewProductFirst.invoice.isPurchase and  viewProductFirst.stock.stockInfo.isFuel and (viewProductFirst.unitPrice > viewProductFirst.fuelPrice)) or (viewProductFirst.stock.stockInfo.saleMandatoryPrice > 0) or (viewProductFirst.unitPrice > viewProductFirst.lastPurchasePrice ) ? 'ColumnColorYellow' : null}" >


                    <p:column headerText="#{loc.barcode}" selectRow="false">
                        <h:outputText value="#{viewProductFirst.stock.barcode}" class="Fright" />
                    </p:column>

                    <p:column headerText="#{loc.quantity}" selectRow="false">
                        <h:outputText value="#{viewProductFirst.quantity}"  class="Fright" >
                            <f:convertNumber type="number" maxFractionDigits="2" />
                        </h:outputText>
                    </p:column>

                    <p:column id="clmPrice21" headerText="#{loc.unitprice}" rendered="#{!invoiceItemTabBean.selectedInvoice.isPurchase}">
                        <h:outputText value="#{viewProductFirst.unitPrice}" style="float: right" >
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="currency" />
                            <f:attribute name="currency" value="#{viewProductFirst.currency}"/>
                        </h:outputText>
                    </p:column>

                    <p:column id="clmPrice1" headerText="#{loc.unitprice}" rendered="#{invoiceItemTabBean.selectedInvoice.isPurchase}">
                            <h:outputText value="#{viewProductFirst.excelUnitPrice}" style="float: right">  <!-- rendered="#{!(viewProductFirst.unitPrice > viewProductFirst.fuelPrice)}"-->
                            <f:converter converterId="currencyConverter" />
                            <f:attribute name="type" value="currency" />
                            <f:attribute name="currency" value="#{viewProductFirst.currency}"/>
                        </h:outputText>
                    </p:column>

                    <p:column id="clmIsTaxIncluded1" headerText="#{loc.taxinformation}" >   
                        <h:outputText value="#{viewProductFirst.isTaxIncluded ? loc.vatincluded :loc.vatexcluded}"/>
                    </p:column>



                </p:dataTable>
            </h:form>
        </h:panelGroup> 
    </p:dialog>


    <!--Veritabanından hatalı dönen kayıtları görüntüleyen dialog -->
    <p:dialog id="dlgProductErrorView" widgetVar="dlg_productErrorView" showEffect="fade" hideEffect="fade" resizable="false" transient="true" modal="true" closeOnEscape="true" responsive="true" width="40%"  >
        <p:toolbar>
            <f:facet name="left">
                <h:outputText value="#{loc.unsavedincorrectrecords}" class="outputTextFont Fleft MarRight8" />
            </f:facet>
        </p:toolbar>

        <h:panelGroup rendered="#{invoiceItemTabBean.errorList.size()!=0}">
            <h:form id="frmProductErrorView">
                <p:dataTable  id="dtbProductErrorView" var="viewErrorProduct"  value="#{invoiceItemTabBean.errorList}" widgetVar="viewErrorPdocutPF" emptyMessage="#{loc.norecordsfound}"
                              rows="#{sessionBean.user.defualtGridSize}" rowKey="#{viewErrorProduct.id}" paginator="true" paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown} {CurrentPageReport}"
                              rowsPerPageTemplate="#{sessionBean.user.gridSize}" paginatorPosition="bottom" currentPageReportTemplate="{startRecord}-{endRecord} #{loc.intotal} {totalRecords}"  reflow="true"
                              >

                    <p:column headerText="#{loc.barcode}" selectRow="false">
                        <h:outputText value="#{viewErrorProduct.barcode}" />
                    </p:column>

                    <p:column headerText="#{loc.errormessage}" selectRow="false">
                        <h:outputText value="#{viewErrorProduct.errorString}" />
                    </p:column>
                </p:dataTable>
            </h:form>
        </h:panelGroup>
    </p:dialog>


    <style type="text/css">
        .ui-fileupload-buttonbar{
            padding: 0px !important;
            margin-top: -35px !important;
            margin: -20px 2px;
        }

        .fileUploadLong .ui-button{
            margin-top: 65px !important;
            position: relative;
        }
        .fileUploadSmall .ui-button{
            margin-top: 68px !important;
            position: relative;
        }
        .fileUploadEmpty .ui-button{
            margin-top: 46px !important;
            position: relative;
        }
        .wrapLabel{
            word-wrap: break-word !important;
        }
        .tableUp, th, td {
            border: 1px solid #316996;
        }

        .tableUp {
            border-collapse: collapse;
            margin: 0;
            padding: 0;
            width: 100%;
            table-layout: fixed;
        }

        .tableUp tr {
            background-color: #f8f8f8;
            border: 1px solid #ddd;
            padding: .35em;
        }
        .pgrResponsive{
            border-collapse: collapse;
            margin: 0;
            padding: 0px;
            width: 100%;
            table-layout: auto;
        }

        .categoryDiv{
            max-height: 100vh;                                       
        }

        .btnRotate{
            -moz-transition: all 1s linear;
            -webkit-transition: all 1s linear;
            transition: all 1s linear;    
            -webkit-transition-duration: 0.5s; 
            transition-duration: 0.5s;    
            margin-right: 0;
        }

        .btnRotate.down{
            -moz-transform:rotate(180deg);
            -webkit-transform:rotate(180deg);
            transform:rotate(180deg);       
            border-radius: 0 9px 0 0;
            -webkit-border-radius: 0 9px 0 0;
            -moz-border-radius: 0 9px 0 0;            
        }
    </style>

    <script>
        //<![CDATA[
        function updateDatatable2() {
            document.getElementById("tbvInvoice:frmProductView:updateDatatable2").click();
        }
        function updateDatatableForDiscount() {
            document.getElementById("tbvInvoice:frmInvoiceStokTab:updateDatatableForDiscount").click();
        }
        //]]>
    </script>

</ui:composition>
