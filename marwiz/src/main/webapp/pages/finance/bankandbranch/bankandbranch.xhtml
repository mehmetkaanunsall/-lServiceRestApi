<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:include src="/pages/general/common/treetabletoolbar.xhtml" >
        <ui:param name="bean" value="#{bankandBranchBean}"/> 
        <ui:param name="update" value="dlgBankProc"/>
        <ui:param name="btnNewId" value="#{bankandBranchBean.getRendered(192, 0)}"/>
        <ui:param name="datatable" value="frmBankandBranch:ttbBankandBranch" /> 
        <ui:param name="dtbWidgetVar" value="bankbranchPF" /> 
        <ui:param name="renderedFilter" value='false'/>
        <ui:param name="renderedToggler" value='false'/>
        <ui:param name="renderedExel" value='false'/>
        <ui:param name="renderedPdf" value='false'/>
        <ui:param name="renderedExpanded" value="true"/>
        <ui:param name="form" value="frmBankandBranchToolbar"/>

    </ui:include>


    <h:form id="frmBankandBranch">
        <p:treeTable id="ttbBankandBranch"  class="treeHoverIcon treeBankAndBranch" widgetVar="bankbranchPF"  value="#{bankandBranchBean.rootBank}"  var="bankandbranch" selectionMode="single" selection="#{bankandBranchBean.selectedNode}" >    

            <p:ajax event="select" listener="#{bankandBranchBean.update()}"  resetValues="true" update="dlgBankProc,dlgBranchProc" global="false"/>

            <p:column id="clmBankCode"  headerText="#{loc.bankcode}" sortable="true" sortBy="#{bankandbranch.code}">
                <p:commandLink rendered="#{bankandbranch['class'].simpleName eq 'Bank' and bankandBranchBean.getRendered(193, 0)}" class="Fleft #{sessionBean.user.isMobile?'DispInlBlock':''}" action="#{bankandBranchBean.createSubBranch()}" title="#{loc.add}" process="@this" resetValues="true" update="dlgBranchProc"> 
                    <i class="fa fa-plus Fs15 MarRight12 MarLeft10" />
                    <f:setPropertyActionListener value="#{bankandbranch}" target="#{bankandBranchBean.selectedObject}"/>
                </p:commandLink>
                <h:outputText value="#{bankandbranch.code}" />
            </p:column>

            <p:column id="clmBankName" headerText="#{loc.bankname}" sortable="true" sortBy="#{bankandbranch.name}">
                <h:outputText value="#{bankandbranch.name}" />
            </p:column>

            <p:column id="clmTelephone" headerText="#{loc.telephone}" sortable="true" sortBy="#{bankandbranch.phone}">
                <h:outputText value="#{bankandbranch.phone}"  />
            </p:column>

            <p:column id="clmMail" headerText="#{loc.mail}" sortable="true" sortBy="#{bankandbranch.email}" >
                <h:outputText value="#{bankandbranch.email}" />
            </p:column>

            <p:column id="clmCountry" headerText="#{loc.country}" sortable="true" sortBy="#{bankandbranch.country.tag}" >
                <h:outputText value="#{bankandbranch.country.tag}" />
            </p:column>

            <p:column id="clmCity" headerText="#{loc.city}" sortable="true" sortBy="#{bankandbranch.city.tag}">
                <h:outputText value="#{bankandbranch.city.tag}" />
            </p:column>

            <p:column id="clmCounty" headerText="#{loc.county}" sortable="true" sortBy="#{bankandbranch.county.name}">
                <h:outputText value="#{bankandbranch.county.name}" />

            </p:column>

            <p:column id="clmAddress" headerText="#{loc.address}" sortable="true" sortBy="#{bankandbranch.address}" >
                <h:outputText value="#{bankandbranch.address.length() gt 28 ? bankandbranch.address.substring(0,25).concat('...'): bankandbranch.address }" />
            </p:column>

            <p:column id="clmStatus" headerText="#{loc.statu}" sortable="true" sortBy="#{bankandbranch.status.tag}" >
                <h:outputText value="#{bankandbranch.status.tag}" />
            </p:column>
        </p:treeTable>

    </h:form>
    <p:dialog id="dlgBankProc" widgetVar="dlg_bankproc" width="40%" focus="dlgBankProc" resizable="false"  dynamic="true" modal="true"  responsive="true"   closeOnEscape="true">
        <ui:include src="/pages/finance/bankandbranch/bankprocess.xhtml">
            <ui:param name="bean" value='#{bankandBranchBean}' />
        </ui:include>

    </p:dialog>

    <p:dialog id="dlgBranchProc" widgetVar="dlg_branchproc" width="40%" focus="dlgBranchProc" resizable="false"  dynamic="true" modal="true"  responsive="true"   closeOnEscape="true">
        <ui:include src="/pages/finance/bankandbranch/branchprocess.xhtml">
            <ui:param name="bean" value='#{bankandBranchBean}' />
        </ui:include>
    </p:dialog>

    <!--Yetkililer tabında yeni yetkili için açılan dialog-->
    <p:dialog id="dlgResponsibleProc" widgetVar="dlg_responsibleproc" resizable="false" focus="dlgResponsibleProc" responsive="true" dynamic="true" modal="true" closeOnEscape="true" width="55%" >
        <c:if test="#{bankandBranchBean.activeIndex==64}">
            <p:ajax event="close" listener="#{responsibleBean.closeDialog()}"/>
            <ui:include src="/pages/general/responsible/responsibleprocess.xhtml">
                <ui:param name="btnSaveId" value='#{responsibleBean.getRendered(281, 0)}' />
                <ui:param name="btnDeleteId" value='#{responsibleBean.processType==2 and responsibleBean.getRendered(282, 0)}' />
                <ui:param name="tabViewRendered" value="#{responsibleBean.processType==2 and responsibleBean.getRendered(65, 1)}"/>
                <ui:param name="tabRendered" value="#{responsibleBean.getRendered(65, 1)}"/>
                <ui:param name="cifRendered" value="#{responsibleBean.activeIndex==65}"/>
                <ui:param name="tabId" value="tab65"/>
                <ui:param name="btnCommunicationNewId" value="#{responsibleCommunicationBean.getRendered(283, 0)}"/>
                <c:set var="whichPage" value="#{3}" scope="request" />
            </ui:include>
        </c:if>
    </p:dialog> 

    <!--Yetkililer tabında communşcation için açılan dialog-->
    <p:dialog id="dlgResponsibleCommunication" widgetVar="dlg_ResponsibleCommunication" resizable="false" focus="dlgResponsibleCommunication" width="35%" responsive="true" dynamic="true" modal="true" closeOnEscape="true" onHide="Centrowiz.removeVariable()">
        <c:if test="#{bankandBranchBean.activeIndex==64}">
            <h:form id="frmResponsibleCommunication" >
                <ui:include src="/pages/general/common/processtoolbarcommunication.xhtml" > 
                    <ui:param name="outputtext" value="#{loc.communicationprocesses}"/>
                    <ui:param name="bean" value='#{responsibleCommunicationBean}'/>
                    <ui:param name="update" value="grdCommunication tbvResponsibleProc:frmResponsibleCommunicationTab:dtbCommunication" />
                    <ui:param name="btnSaveId" value="#{responsibleCommunicationBean.getRendered(284, 0)}" />
                    <ui:param name="btnDeleteId" value='false' />
                    <ui:param name="dialog" value='dlg_ResponsibleCommunication' />
                    <c:if test="#{responsibleCommunicationBean.communicationProcessType==2}">
                        <ui:param name="btnDeleteId" value="#{responsibleCommunicationBean.getRendered(285, 0)}" />
                    </c:if>
                </ui:include>

                <ui:include src="/pages/general/common/communicationprocess.xhtml">
                    <ui:param name="bean" value='#{responsibleCommunicationBean}'/>  
                    <ui:param name="updateGrid" value="grdCommunication"/> 
                    <ui:param name="form" value="frmResponsibleCommunication"/>
                </ui:include>

            </h:form>
        </c:if>
    </p:dialog> 

</ui:composition>
