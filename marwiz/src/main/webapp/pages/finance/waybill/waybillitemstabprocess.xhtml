<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions" 
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <!-- 
           Açıklama : İrsaliye ürünler tabı dialog tasarımı
           Yazan    : Ali Kurt
           Bean     : WayBillItemTabBean
           Sayfa    : İrsaliye ürünler tabı işlem sayfası
           Tarih    : 06.04.2017
    -->
    <h:form id="frmItemsProcess">
        <ui:include src="/pages/general/common/processtoolbar.xhtml" >
            <ui:param name="outputtext" value="#{loc.stockprocess} #{waybillItemTabBean.isCreateWaybillFromOrder== true ? '/' : ''} #{waybillItemTabBean.isCreateWaybillFromOrder== true ? loc.remainingamount : '' } #{waybillItemTabBean.isCreateWaybillFromOrder== true ? ':' : ''} #{waybillItemTabBean.isCreateWaybillFromOrder== true ? waybillItemTabBean.selectedObject.orderRemainingQuantity : ''} #{waybillItemTabBean.isCreateWaybillFromOrder== true ? waybillItemTabBean.selectedObject.stock.unit.sortName : ''}"/>  
            <ui:param name="bean" value='#{waybillItemTabBean}' />
            <ui:param name="update" value="pgrItemsProcess" />
            <ui:param name="btnSaveId" value="#{waybillItemTabBean.getRendered(16, 0) and (waybillItemTabBean.selectedWaybill.status.id==25 or !waybillItemTabBean.selectedWaybill.isInvoice) ? 
                                                sessionBean.user.lastBranchSetting.isCentralIntegration and waybillItemTabBean.selectedWaybill.isPurchase and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  and sessionBean.user.isAuthorized ? waybillItemTabBean.selectedWaybill.sapLogİsSend ? false : true : true : false}"/>
            <ui:param name="btnDeleteId" value='false' />
            <ui:param name="btnTestBeforeDeleteId" value="true" />
            <ui:param name="pageId" value="#{waybillItemTabBean.selectedWaybill.isPurchase ? 42 : 41}"/>
            <c:if test="#{waybillItemTabBean.processType==2}">
                <ui:param name="btnDeleteId" value="#{waybillItemTabBean.getRendered(17, 0) and (waybillItemTabBean.selectedWaybill.status.id==25 or !waybillItemTabBean.selectedWaybill.isInvoice) ?
                                                      sessionBean.user.lastBranchSetting.isCentralIntegration and waybillItemTabBean.selectedWaybill.isPurchase and sessionBean.user.lastBranchSetting.erpIntegrationId == 1  and sessionBean.user.isAuthorized ? waybillItemTabBean.selectedWaybill.sapLogİsSend ? false : true : true : false}"/>
            </c:if>
        </ui:include>

        <h:panelGroup id="pgrItemsProcess" layout="block">
            <div class="ui-g divContent">
                <div class="ui-g-12 ui-md-4 ui-lg-3">
                    <p:outputLabel value="#{loc.type}" for="slcType" styleClass="Fs12 FontBold"/>
                    <p:selectOneMenu id="slcType" required="true" class="Wid95" value="#{waybillItemTabBean.selectedObject.stock.isService}" >
                        <f:selectItem itemLabel="#{loc.product}" itemValue="false"  />
                        <f:selectItem itemLabel="#{loc.service}" itemValue="true"  />
                        <p:ajax event="change" update="pngStockName" global="false" listener="#{waybillItemTabBean.bringStockType()}" /> 
                    </p:selectOneMenu>
                </div>

                <div class="ui-g-12 ui-md-4 ui-lg-3">
                    <h:panelGroup id="pngStockName">
                        <h:panelGroup rendered="#{!waybillItemTabBean.selectedObject.stock.isService}" >
                            <p:outputLabel value="#{loc.stockname}" for="txtStock"   styleClass="Fs12 FontBold"/>
                        </h:panelGroup>

                        <h:panelGroup rendered="#{waybillItemTabBean.selectedObject.stock.isService}" >
                            <p:outputLabel  value="#{loc.servicename}" for="txtStock"   styleClass="Fs12 FontBold"/>
                        </h:panelGroup> 

                        <p:inputText id="txtStock" class="inputPositionForBookFilter" onclick="showBook()"  value="#{waybillItemTabBean.selectedObject.stock.name}" required="true" 
                                     disabled="#{waybillItemTabBean.processType==2}" readonly="#{facesContext.currentPhaseId.ordinal ge 4}"  placeholder="#{waybillItemTabBean.selectedObject.stock.isService ? loc.servicename : loc.stockname}">   
                        </p:inputText>

                        <p:commandLink id="btnStockName" class="commandLinkPositionForBookFilter" process="@this" oncomplete="PF('olp_stock').loadContents()" rendered="#{waybillItemTabBean.processType==1}" >
                            <i class="fa fa-book Fs16 iconPositionForBookFilter"></i> 
                            <p:ajax listener="#{stockBookFilterBean.findFilterListLazyLoading([waybillItemTabBean.selectedWaybill],'frmStockBookFilter','olp_stock',waybillItemTabBean.bookType)}" />
                        </p:commandLink>
                    </h:panelGroup>
                </div>


                <h:panelGroup rendered="#{waybillItemTabBean.selectedWaybill.isFuel and waybillItemTabBean.selectedWaybill.type.id == 21}">

                    <div class="ui-g-12 ui-md-4 ui-lg-3">
                        <p:outputLabel value="#{loc.warehouse}" for="slcWarehouse" styleClass="Fs12 FontBold"/>
                        <p:selectOneMenu id="slcWarehouse" disabled="#{waybillItemTabBean.processType==2 or !waybillItemTabBean.isListFuelWarehouse}" value="#{waybillItemTabBean.selectedObject.warehouse.id}" required="true" >
                            <f:selectItem itemLabel="#{loc.choose}" itemValue="0"  itemDisabled="true"/>
                            <f:selectItems value="#{waybillItemTabBean.listOfFuelWarehouse}"  var="warehouse" itemLabel="#{warehouse.name}" itemValue="#{warehouse.id}" />
                            <p:ajax listener="#{waybillItemTabBean.changeFuelWarehouse}" global="false"/>

                        </p:selectOneMenu>
                    </div>


                </h:panelGroup>



                <div class="ui-g-12 ui-md-4 ui-lg-3">
                    <p:outputLabel value="#{loc.amount}" for="txtAmount" class="FontBold Fs12"/>
                    <p:inputNumber id="txtAmount" value="#{waybillItemTabBean.selectedObject.quantity}" required="true" class="TexAlRight"
                                   decimalPlaces="#{waybillItemTabBean.selectedObject.stock.unit.unitRounding}"
                                   placeholder="#{loc.amount}" 
                                   />  
                </div>

                <div class="ui-g-12 ui-md-4 ui-lg-3">
                    <p:outputLabel value="#{loc.unit}" for="slcUnit" styleClass="Fs12 FontBold"/>
                    <p:selectOneMenu id="slcUnit" required="true" value="#{waybillItemTabBean.selectedObject.stock.unit.id}" 
                                     styleClass="Wid95" disabled="#{waybillItemTabBean.processType==2}" >
                        <f:selectItems value="#{waybillItemTabBean.listOfUnit}" var="unitcon" itemLabel="#{unitcon.unit.name}" itemValue="#{unitcon.unit.id}" />
                        <p:ajax event="change" listener="#{waybillItemTabBean.bringUnit()}" global="false" update="txtAmount" />
                    </p:selectOneMenu>
                </div>

                <div class="#{waybillItemTabBean.selectedWaybill.isFuel ? 'ui-g-12 ui-md-12 ui-lg-8' : 'ui-g-12 ui-md-12 ui-lg-12'}">
                    <p:outputLabel value="#{loc.description}" for="txtDescription" class="FontBold Fs12"/>
                    <p:inputText id="txtDescription" value="#{waybillItemTabBean.selectedObject.description}" placeholder="#{loc.description}" autocomplete="off" />
                </div>

            </div>
        </h:panelGroup>
        <p:remoteCommand name="showBook" process="@this" oncomplete="PF('olp_stock').loadContents();" actionListener="#{stockBookFilterBean.findFilterListLazyLoading([waybillItemTabBean.selectedWaybill],'frmStockBookFilter','olp_stock',waybillItemTabBean.bookType)}" />
        <p:remoteCommand name="goToRelatedRecord" actionListener="#{waybillItemTabBean.goToRelatedRecord()}" delay="200"/>
    </h:form>
</ui:composition>
